<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beauty App - Sistema de Agendamento</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        body { 
            margin: 0; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; 
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .error-details {
            background: #fee;
            border: 1px solid #fcc;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            font-family: monospace;
            font-size: 0.8rem;
            color: #c33;
        }
        .tab-button {
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }
        .tab-button:hover {
            background-color: #f3f4f6;
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="min-h-screen bg-gradient-to-br from-pink-100 to-purple-100 flex items-center justify-center">
            <div class="text-center">
                <div class="loading mb-4"></div>
                <p>Carregando Beauty App...</p>
            </div>
        </div>
    </div>
    
    <script>
        console.log('üöÄ Iniciando Beauty App...');
        
        // ========================================
        // CONFIGURA√á√ÉO DO SUPABASE
        // ========================================
        
        // ‚úÖ CREDENCIAIS CONFIGURADAS
        const SUPABASE_URL = 'https://ueonkhdbuzujdfyhookt.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVlb25raGRidXp1amRmeWhvb2t0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk0MzI3ODQsImV4cCI6MjA2NTAwODc4NH0.3zX18Z-Gz3tZ4YQti0wuhtStxPIc8jN8m_lrz_W2ikE';
        
        // Verificar se as credenciais foram configuradas
        if (SUPABASE_ANON_KEY === 'SUA_CHAVE_ANON_CORRETA_AQUI') {
            showConfigurationError();
        } else if (typeof window.supabase === 'undefined') {
            console.error('‚ùå Supabase n√£o foi carregado!');
            showLibraryError();
        } else {
            initializeSupabase();
        }
        
        function showConfigurationError() {
            document.getElementById('root').innerHTML = `
                <div class="min-h-screen bg-orange-50 flex items-center justify-center p-4">
                    <div class="bg-white rounded-lg shadow-xl p-8 max-w-2xl">
                        <div class="text-6xl mb-4 text-center">‚öôÔ∏è</div>
                        <h1 class="text-2xl font-bold text-orange-600 mb-4 text-center">Configura√ß√£o Necess√°ria</h1>
                        <div class="space-y-4 text-sm">
                            <p class="text-gray-600">Para usar o Beauty App, voc√™ precisa:</p>
                            <div class="bg-gray-100 p-4 rounded-lg">
                                <h3 class="font-semibold mb-2">1. Criar as tabelas no Supabase:</h3>
                                <p>Execute o script SQL fornecido no SQL Editor do Supabase</p>
                            </div>
                            <div class="bg-gray-100 p-4 rounded-lg">
                                <h3 class="font-semibold mb-2">2. Configurar a chave API:</h3>
                                <p>Substitua <code>SUA_CHAVE_ANON_CORRETA_AQUI</code> pela sua chave anon do Supabase</p>
                            </div>
                            <div class="bg-gray-100 p-4 rounded-lg">
                                <h3 class="font-semibold mb-2">3. Configurar autentica√ß√£o:</h3>
                                <p>No painel do Supabase, v√° em Authentication > Settings e configure o email</p>
                            </div>
                        </div>
                        <button onclick="location.reload()" class="w-full mt-6 bg-orange-500 text-white px-4 py-2 rounded">
                            Recarregar ap√≥s configurar
                        </button>
                    </div>
                </div>
            `;
        }
        
        function showLibraryError() {
            document.getElementById('root').innerHTML = `
                <div class="min-h-screen bg-red-50 flex items-center justify-center p-4">
                    <div class="bg-white rounded-lg shadow-xl p-8 max-w-md text-center">
                        <div class="text-6xl mb-4">üìö</div>
                        <h1 class="text-2xl font-bold text-red-600 mb-4">Erro de Biblioteca</h1>
                        <p class="text-gray-600 mb-4">O Supabase n√£o foi carregado corretamente.</p>
                        <p class="text-sm text-gray-500 mb-4">Verifique sua conex√£o com a internet.</p>
                        <button onclick="location.reload()" class="bg-red-500 text-white px-4 py-2 rounded">
                            Tentar Novamente
                        </button>
                    </div>
                </div>
            `;
        }
        
        function showConnectionError(error) {
            document.getElementById('root').innerHTML = `
                <div class="min-h-screen bg-red-50 flex items-center justify-center p-4">
                    <div class="bg-white rounded-lg shadow-xl p-8 max-w-2xl">
                        <div class="text-6xl mb-4 text-center">‚ö†Ô∏è</div>
                        <h1 class="text-2xl font-bold text-red-600 mb-4 text-center">Erro de Conex√£o</h1>
                        <p class="text-gray-600 mb-4">N√£o foi poss√≠vel conectar ao banco de dados.</p>
                        
                        <div class="error-details">
                            <strong>Detalhes do erro:</strong><br>
                            ${error.message || 'Erro desconhecido'}
                        </div>
                        
                        <div class="space-y-2 text-sm text-gray-600 mb-4">
                            <p><strong>Poss√≠veis causas:</strong></p>
                            <ul class="list-disc list-inside space-y-1">
                                <li>URL do Supabase incorreta</li>
                                <li>Chave anon inv√°lida ou expirada</li>
                                <li>Projeto Supabase pausado</li>
                                <li>Problemas de rede</li>
                            </ul>
                        </div>
                        
                        <button onclick="location.reload()" class="bg-red-500 text-white px-4 py-2 rounded">
                            Tentar Novamente
                        </button>
                    </div>
                </div>
            `;
        }
        
        function initializeSupabase() {
            try {
                window.supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                console.log('‚úÖ Supabase conectado com sucesso!');
                testConnection();
            } catch (error) {
                console.error('‚ùå Erro ao inicializar Supabase:', error);
                showConnectionError(error);
            }
        }
        
        async function testConnection() {
            try {
                const { data, error } = await window.supabaseClient.auth.getSession();
                if (error) {
                    console.warn('‚ö†Ô∏è Aviso na sess√£o:', error.message);
                }
                console.log('üîó Teste de conex√£o OK');
                initApp();
            } catch (error) {
                console.error('‚ùå Erro no teste de conex√£o:', error);
                showConnectionError(error);
            }
        }

        // ========================================
        // BEAUTY APP
        // ========================================
        
        function initApp() {
            const supabase = window.supabaseClient;
            
            class BeautyApp {
                constructor() {
                    this.currentView = 'login';
                    this.currentUser = null;
                    this.userType = '';
                    this.loading = false;
                    this.pendingVerificationEmail = null;
                    this.isAdmin = false;
                    this.selectedServiceId = null;
                    this.selectedBusinessId = null;
                    
                    // Configura√ß√µes do Admin (armazenadas localmente para demonstra√ß√£o)
                    this.adminConfig = {
                        password: localStorage.getItem('admin_password') || 'admin123',
                        email: localStorage.getItem('admin_email') || '',
                        firstLogin: localStorage.getItem('admin_first_login') !== 'false'
                    };
                    
                    // Cache de dados
                    this.businesses = [];
                    this.services = [];
                    this.appointments = [];
                    
                    // Dados administrativos (todos os dados)
                    this.allUsers = [];
                    this.allServices = [];
                    this.allAppointments = [];
                    
                    this.init();
                }
                
                async init() {
                    console.log('üöÄ Inicializando Beauty App...');
                    
                    try {
                        // Verificar se usu√°rio j√° est√° logado
                        const { data: { session }, error } = await supabase.auth.getSession();
                        if (error) {
                            console.error('Erro ao verificar sess√£o:', error);
                        }
                        
                        if (session?.user) {
                            console.log('üë§ Usu√°rio j√° logado:', session.user.email);
                            await this.loadUserData(session.user);
                            this.currentView = this.currentUser?.user_type === 'business' ? 'business-dashboard' : 'client-dashboard';
                        }
                        
                        // Escutar mudan√ßas de autentica√ß√£o
                        supabase.auth.onAuthStateChange(async (event, session) => {
                            console.log('üîÑ Auth state changed:', event);
                            if (event === 'SIGNED_IN' && !this.isAdmin) {
                                await this.loadUserData(session.user);
                                this.currentView = this.currentUser?.user_type === 'business' ? 'business-dashboard' : 'client-dashboard';
                                this.render();
                            } else if (event === 'SIGNED_OUT') {
                                this.currentUser = null;
                                this.isAdmin = false;
                                this.currentView = 'login';
                                this.render();
                            }
                        });
                        
                        await this.loadData();
                        this.render();
                        
                    } catch (error) {
                        console.error('‚ùå Erro na inicializa√ß√£o:', error);
                        this.showMessage('Erro ao inicializar aplica√ß√£o: ' + error.message, 'error');
                        this.renderError(error);
                    }
                }
                
                renderError(error) {
                    const root = document.getElementById('root');
                    root.innerHTML = `
                        <div class="min-h-screen bg-red-50 flex items-center justify-center p-4">
                            <div class="bg-white rounded-lg shadow-xl p-8 max-w-2xl">
                                <div class="text-6xl mb-4 text-center">üí•</div>
                                <h1 class="text-2xl font-bold text-red-600 mb-4 text-center">Erro na Aplica√ß√£o</h1>
                                
                                <div class="error-details">
                                    <strong>Erro:</strong> ${error.message}<br>
                                    <strong>C√≥digo:</strong> ${error.code || 'N/A'}
                                </div>
                                
                                <button onclick="location.reload()" class="bg-red-500 text-white px-4 py-2 rounded">
                                    Recarregar
                                </button>
                            </div>
                        </div>
                    `;
                }
                
                async loadUserData(authUser) {
                    try {
                        const { data, error } = await supabase
                            .from('users')
                            .select('*')
                            .eq('id', authUser.id)
                            .single();
                        
                        if (error) {
                            if (error.code === 'PGRST116') {
                                console.log('üìù Criando registro de usu√°rio...');
                                await this.createUserRecord(authUser);
                                return;
                            }
                            throw error;
                        }
                        this.currentUser = data;
                        console.log('üë§ Usu√°rio carregado:', data);
                    } catch (error) {
                        console.error('‚ùå Erro ao carregar dados do usu√°rio:', error);
                        this.showMessage('Erro ao carregar perfil: ' + error.message, 'error');
                    }
                }
                
                async createUserRecord(authUser) {
                    try {
                        const userData = authUser.user_metadata || {};
                        console.log(`üìù Criando registro para: ${authUser.email} (${userData.user_type})`);
                        
                        const { data, error } = await supabase
                            .from('users')
                            .insert([{
                                id: authUser.id,
                                email: authUser.email,
                                user_type: userData.user_type || 'client',
                                name: userData.name || '',
                                phone: userData.phone || '',
                                address: userData.address || '',
                                email_verified: authUser.email_confirmed_at ? true : false
                            }])
                            .select()
                            .single();
                        
                        if (error) throw error;
                        this.currentUser = data;
                        console.log(`‚úÖ Usu√°rio criado: ${data.name} (${data.user_type})`);
                        
                        // Se √© um neg√≥cio, criar registro na tabela businesses
                        if (userData.user_type === 'business' && userData.name) {
                            console.log('üè¢ Criando estabelecimento para empresa...');
                            await this.createBusinessRecord(data);
                        }
                        
                    } catch (error) {
                        console.error('‚ùå Erro ao criar usu√°rio:', error);
                        this.showMessage('Erro ao criar perfil: ' + error.message, 'error');
                    }
                }
                
                async createBusinessRecord(user) {
                    try {
                        console.log(`üè¢ Criando estabelecimento para: ${user.name}`);
                        const { data, error } = await supabase
                            .from('businesses')
                            .insert([{
                                user_id: user.id,
                                name: user.name,
                                address: user.address || '',
                                phone: user.phone || '',
                                email: user.email,
                                active: true
                            }])
                            .select()
                            .single();
                        
                        if (error) throw error;
                        console.log(`‚úÖ Estabelecimento criado: ${data.name}`);
                        
                        // Atualizar cache de businesses
                        await this.loadData();
                        
                    } catch (error) {
                        console.error('‚ùå Erro ao criar estabelecimento:', error);
                        // N√£o mostrar erro para o usu√°rio aqui, pois ser√° criado automaticamente quando necess√°rio
                    }
                }
                
                async loadData() {
                    try {
                        const { data: businessData } = await supabase
                            .from('businesses')
                            .select('*')
                            .eq('active', true)
                            .order('name');
                        
                        this.businesses = businessData || [];
                        console.log(`üìç ${this.businesses.length} estabelecimentos carregados`);
                        
                        const { data: serviceData } = await supabase
                            .from('services')
                            .select('*')
                            .eq('active', true)
                            .order('name');
                        
                        this.services = serviceData || [];
                        console.log(`üíº ${this.services.length} servi√ßos carregados`);
                        
                        if (this.currentUser) {
                            await this.loadAppointments();
                        }
                    } catch (error) {
                        console.error('‚ùå Erro ao carregar dados:', error);
                        this.showMessage('Erro ao carregar dados: ' + error.message, 'warning');
                    }
                }
                
                async loadAppointments() {
                    try {
                        let query = supabase.from('appointments').select('*');
                        
                        if (this.currentUser.user_type === 'business') {
                            const { data: businessData } = await supabase
                                .from('businesses')
                                .select('id')
                                .eq('user_id', this.currentUser.id)
                                .single();
                            
                            if (businessData) {
                                query = query.eq('business_id', businessData.id);
                            }
                        } else {
                            query = query.eq('client_id', this.currentUser.id);
                        }
                        
                        const { data } = await query.order('appointment_date', { ascending: false });
                        this.appointments = data || [];
                        console.log(`üìÖ ${this.appointments.length} agendamentos carregados`);
                    } catch (error) {
                        console.error('‚ùå Erro ao carregar agendamentos:', error);
                    }
                }
                
                showMessage(message, type = 'info') {
                    const colors = {
                        success: 'bg-green-100 text-green-800 border-green-200',
                        error: 'bg-red-100 text-red-800 border-red-200',
                        info: 'bg-blue-100 text-blue-800 border-blue-200',
                        warning: 'bg-yellow-100 text-yellow-800 border-yellow-200'
                    };
                    
                    const messageDiv = document.createElement('div');
                    messageDiv.className = `fixed top-4 right-4 p-4 rounded-lg border ${colors[type]} z-50 fade-in max-w-md shadow-lg`;
                    messageDiv.innerHTML = `
                        <div class="flex items-start gap-2">
                            <span class="flex-1">${message}</span>
                            <button onclick="this.parentElement.parentElement.remove()" class="text-lg font-bold opacity-70 hover:opacity-100">√ó</button>
                        </div>
                    `;
                    document.body.appendChild(messageDiv);
                    
                    setTimeout(() => {
                        if (messageDiv.parentElement) {
                            messageDiv.remove();
                        }
                    }, 7000);
                }
                
                render() {
                    const root = document.getElementById('root');
                    
                    switch(this.currentView) {
                        case 'login':
                            root.innerHTML = this.renderLogin();
                            break;
                        case 'register':
                            root.innerHTML = this.renderRegister();
                            break;
                        case 'forgot-password':
                            root.innerHTML = this.renderForgotPassword();
                            break;
                        case 'email-sent':
                            root.innerHTML = this.renderEmailSent();
                            break;
                        case 'business-dashboard':
                            root.innerHTML = this.renderBusinessDashboard();
                            break;
                        case 'client-dashboard':
                            root.innerHTML = this.renderClientDashboard();
                            break;
                        case 'admin-dashboard':
                            root.innerHTML = this.renderAdminDashboard();
                            break;
                        default:
                            root.innerHTML = this.renderLogin();
                    }
                    
                    this.attachEvents();
                }

                renderAdminDashboard() {
                    // Calcular estat√≠sticas gerais
                    const totalUsers = this.allUsers?.length || 0;
                    const totalBusinesses = this.businesses?.length || 0;
                    const totalServices = this.allServices?.length || 0;
                    const totalAppointments = this.allAppointments?.length || 0;
                    
                    return `
                        <div class="min-h-screen bg-gray-50">
                            <header class="bg-gray-900 shadow-sm">
                                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                                    <div class="flex justify-between items-center py-4">
                                        <div class="flex items-center gap-3">
                                            <div class="w-10 h-10 bg-gradient-to-r from-yellow-500 to-orange-600 rounded-lg flex items-center justify-center">
                                                <span class="text-white font-bold">üëë</span>
                                            </div>
                                            <div>
                                                <h1 class="text-2xl font-bold text-white">Dashboard Administrativo</h1>
                                                <p class="text-sm text-gray-300">Controle total do Beauty App - ${this.currentUser?.email || 'Admin'}</p>
                                            </div>
                                        </div>
                                        <div class="flex items-center gap-3">
                                            <button
                                                id="admin-settings-btn"
                                                class="bg-gray-700 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition duration-300 flex items-center gap-2"
                                            >
                                                ‚öôÔ∏è Configura√ß√µes
                                            </button>
                                            <button
                                                id="logout-btn"
                                                class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition duration-300"
                                            >
                                                Sair
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </header>

                            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                                <!-- Cards de Estat√≠sticas Gerais -->
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                                    <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg shadow p-6 text-white">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <p class="text-blue-100">Total de Usu√°rios</p>
                                                <p class="text-3xl font-bold">${totalUsers}</p>
                                            </div>
                                            <div class="text-4xl opacity-80">üë•</div>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-lg shadow p-6 text-white">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <p class="text-green-100">Estabelecimentos</p>
                                                <p class="text-3xl font-bold">${totalBusinesses}</p>
                                            </div>
                                            <div class="text-4xl opacity-80">üè¢</div>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-lg shadow p-6 text-white">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <p class="text-purple-100">Total de Servi√ßos</p>
                                                <p class="text-3xl font-bold">${totalServices}</p>
                                            </div>
                                            <div class="text-4xl opacity-80">üíº</div>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-gradient-to-r from-orange-500 to-red-500 rounded-lg shadow p-6 text-white">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <p class="text-orange-100">Agendamentos</p>
                                                <p class="text-3xl font-bold">${totalAppointments}</p>
                                            </div>
                                            <div class="text-4xl opacity-80">üìÖ</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Navega√ß√£o por Abas -->
                                <div class="bg-white rounded-lg shadow">
                                    <div class="border-b border-gray-200">
                                        <nav class="flex">
                                            <button
                                                id="tab-businesses"
                                                class="tab-button px-6 py-3 text-sm font-medium border-b-2 border-blue-500 text-blue-600"
                                            >
                                                üè¢ Estabelecimentos
                                            </button>
                                            <button
                                                id="tab-users"
                                                class="tab-button px-6 py-3 text-sm font-medium text-gray-500 hover:text-gray-700"
                                            >
                                                üë• Usu√°rios
                                            </button>
                                            <button
                                                id="tab-services"
                                                class="tab-button px-6 py-3 text-sm font-medium text-gray-500 hover:text-gray-700"
                                            >
                                                üíº Servi√ßos
                                            </button>
                                            <button
                                                id="tab-appointments"
                                                class="tab-button px-6 py-3 text-sm font-medium text-gray-500 hover:text-gray-700"
                                            >
                                                üìÖ Agendamentos
                                            </button>
                                        </nav>
                                    </div>

                                    <!-- Conte√∫do das Abas -->
                                    <div class="p-6">
                                        <!-- Aba Estabelecimentos -->
                                        <div id="content-businesses" class="tab-content">
                                            <div class="flex justify-between items-center mb-6">
                                                <h3 class="text-lg font-semibold text-gray-900">Estabelecimentos Cadastrados</h3>
                                                <span class="text-sm text-gray-500">${totalBusinesses} total</span>
                                            </div>
                                            
                                            ${this.businesses.length > 0 ? `
                                                <div class="overflow-x-auto">
                                                    <table class="min-w-full divide-y divide-gray-200">
                                                        <thead class="bg-gray-50">
                                                            <tr>
                                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estabelecimento</th>
                                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Propriet√°rio</th>
                                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Servi√ßos</th>
                                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">A√ß√µes</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody class="bg-white divide-y divide-gray-200">
                                                            ${this.businesses.map(business => {
                                                                const owner = this.allUsers?.find(u => u.id === business.user_id);
                                                                const businessServices = this.allServices?.filter(s => s.business_id === business.id) || [];
                                                                return `
                                                                    <tr>
                                                                        <td class="px-6 py-4 whitespace-nowrap">
                                                                            <div>
                                                                                <div class="text-sm font-medium text-gray-900">${business.name}</div>
                                                                                <div class="text-sm text-gray-500">${business.address || 'Endere√ßo n√£o informado'}</div>
                                                                            </div>
                                                                        </td>
                                                                        <td class="px-6 py-4 whitespace-nowrap">
                                                                            <div class="text-sm text-gray-900">${owner?.name || 'N/A'}</div>
                                                                            <div class="text-sm text-gray-500">${owner?.email || ''}</div>
                                                                        </td>
                                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                                                            ${businessServices.length} servi√ßos
                                                                        </td>
                                                                        <td class="px-6 py-4 whitespace-nowrap">
                                                                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${business.active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                                                                ${business.active ? 'Ativo' : 'Inativo'}
                                                                            </span>
                                                                        </td>
                                                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                                            <button
                                                                                onclick="app.toggleBusinessStatus('${business.id}')"
                                                                                class="text-blue-600 hover:text-blue-900 mr-3"
                                                                            >
                                                                                ${business.active ? 'Desativar' : 'Ativar'}
                                                                            </button>
                                                                            <button
                                                                                onclick="app.viewBusinessDetails('${business.id}')"
                                                                                class="text-green-600 hover:text-green-900"
                                                                            >
                                                                                Detalhes
                                                                            </button>
                                                                        </td>
                                                                    </tr>
                                                                `;
                                                            }).join('')}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            ` : `
                                                <div class="text-center py-12">
                                                    <div class="text-6xl mb-4">üè¢</div>
                                                    <h3 class="text-lg font-medium text-gray-900 mb-2">Nenhum estabelecimento cadastrado</h3>
                                                    <p class="text-gray-600">Quando empresas se cadastrarem, aparecer√£o aqui.</p>
                                                </div>
                                            `}
                                        </div>

                                        <!-- Aba Usu√°rios -->
                                        <div id="content-users" class="tab-content hidden">
                                            <div class="flex justify-between items-center mb-6">
                                                <h3 class="text-lg font-semibold text-gray-900">Usu√°rios Cadastrados</h3>
                                                <span class="text-sm text-gray-500">${totalUsers} total</span>
                                            </div>
                                            
                                            ${this.allUsers?.length > 0 ? `
                                                <div class="overflow-x-auto">
                                                    <table class="min-w-full divide-y divide-gray-200">
                                                        <thead class="bg-gray-50">
                                                            <tr>
                                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Usu√°rio</th>
                                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tipo</th>
                                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cadastro</th>
                                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody class="bg-white divide-y divide-gray-200">
                                                            ${this.allUsers.map(user => `
                                                                <tr>
                                                                    <td class="px-6 py-4 whitespace-nowrap">
                                                                        <div>
                                                                            <div class="text-sm font-medium text-gray-900">${user.name}</div>
                                                                            <div class="text-sm text-gray-500">${user.email}</div>
                                                                        </div>
                                                                    </td>
                                                                    <td class="px-6 py-4 whitespace-nowrap">
                                                                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${user.user_type === 'business' ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800'}">
                                                                            ${user.user_type === 'business' ? 'üè¢ Empresa' : 'üë§ Cliente'}
                                                                        </span>
                                                                    </td>
                                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                                                        ${new Date(user.created_at).toLocaleDateString('pt-BR')}
                                                                    </td>
                                                                    <td class="px-6 py-4 whitespace-nowrap">
                                                                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${user.email_verified ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">
                                                                            ${user.email_verified ? 'Verificado' : 'Pendente'}
                                                                        </span>
                                                                    </td>
                                                                </tr>
                                                            `).join('')}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            ` : `
                                                <div class="text-center py-12">
                                                    <div class="text-6xl mb-4">üë•</div>
                                                    <h3 class="text-lg font-medium text-gray-900 mb-2">Nenhum usu√°rio cadastrado</h3>
                                                    <p class="text-gray-600">Os usu√°rios cadastrados aparecer√£o aqui.</p>
                                                </div>
                                            `}
                                        </div>

                                        <!-- Aba Servi√ßos -->
                                        <div id="content-services" class="tab-content hidden">
                                            <div class="flex justify-between items-center mb-6">
                                                <h3 class="text-lg font-semibold text-gray-900">Todos os Servi√ßos</h3>
                                                <span class="text-sm text-gray-500">${totalServices} total</span>
                                            </div>
                                            
                                            ${this.allServices?.length > 0 ? `
                                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                                    ${this.allServices.map(service => {
                                                        const business = this.businesses?.find(b => b.id === service.business_id);
                                                        return `
                                                            <div class="border border-gray-200 rounded-lg p-4">
                                                                <div class="flex justify-between items-start mb-3">
                                                                    <h4 class="font-medium text-gray-900">${service.name}</h4>
                                                                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${service.active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                                                        ${service.active ? 'Ativo' : 'Inativo'}
                                                                    </span>
                                                                </div>
                                                                <p class="text-sm text-gray-600 mb-3">${service.description || 'Sem descri√ß√£o'}</p>
                                                                <div class="space-y-1 text-sm">
                                                                    <p><span class="font-medium">Estabelecimento:</span> ${business?.name || 'N/A'}</p>
                                                                    <p><span class="font-medium">Dura√ß√£o:</span> ${service.duration_minutes} min</p>
                                                                    <p><span class="font-medium">Pre√ßo:</span> R$ ${service.price}</p>
                                                                </div>
                                                            </div>
                                                        `;
                                                    }).join('')}
                                                </div>
                                            ` : `
                                                <div class="text-center py-12">
                                                    <div class="text-6xl mb-4">üíº</div>
                                                    <h3 class="text-lg font-medium text-gray-900 mb-2">Nenhum servi√ßo cadastrado</h3>
                                                    <p class="text-gray-600">Os servi√ßos das empresas aparecer√£o aqui.</p>
                                                </div>
                                            `}
                                        </div>

                                        <!-- Aba Agendamentos -->
                                        <div id="content-appointments" class="tab-content hidden">
                                            <div class="flex justify-between items-center mb-6">
                                                <h3 class="text-lg font-semibold text-gray-900">Todos os Agendamentos</h3>
                                                <span class="text-sm text-gray-500">${totalAppointments} total</span>
                                            </div>
                                            
                                            ${this.allAppointments?.length > 0 ? `
                                                <div class="overflow-x-auto">
                                                    <table class="min-w-full divide-y divide-gray-200">
                                                        <thead class="bg-gray-50">
                                                            <tr>
                                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cliente</th>
                                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estabelecimento</th>
                                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Servi√ßo</th>
                                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data/Hora</th>
                                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody class="bg-white divide-y divide-gray-200">
                                                            ${this.allAppointments.map(appointment => {
                                                                const client = this.allUsers?.find(u => u.id === appointment.client_id);
                                                                const business = this.businesses?.find(b => b.id === appointment.business_id);
                                                                const service = this.allServices?.find(s => s.id === appointment.service_id);
                                                                return `
                                                                    <tr>
                                                                        <td class="px-6 py-4 whitespace-nowrap">
                                                                            <div class="text-sm font-medium text-gray-900">${client?.name || 'N/A'}</div>
                                                                            <div class="text-sm text-gray-500">${client?.email || ''}</div>
                                                                        </td>
                                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                                                            ${business?.name || 'N/A'}
                                                                        </td>
                                                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                                                            ${service?.name || 'N/A'}
                                                                        </td>
                                                                        <td class="px-6 py-4 whitespace-nowrap">
                                                                            <div class="text-sm text-gray-900">${appointment.appointment_date}</div>
                                                                            <div class="text-sm text-gray-500">${appointment.appointment_time}</div>
                                                                        </td>
                                                                        <td class="px-6 py-4 whitespace-nowrap">
                                                                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${
                                                                                appointment.status === 'confirmed' ? 'bg-green-100 text-green-800' :
                                                                                appointment.status === 'pending' ? 'bg-yellow-100 text-yellow-800' :
                                                                                appointment.status === 'cancelled' ? 'bg-red-100 text-red-800' :
                                                                                'bg-gray-100 text-gray-800'
                                                                            }">
                                                                                ${appointment.status === 'confirmed' ? 'Confirmado' :
                                                                                appointment.status === 'pending' ? 'Pendente' :
                                                                                appointment.status === 'cancelled' ? 'Cancelado' : 'Conclu√≠do'}
                                                                            </span>
                                                                        </td>
                                                                    </tr>
                                                                `;
                                                            }).join('')}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            ` : `
                                                <div class="text-center py-12">
                                                    <div class="text-6xl mb-4">üìÖ</div>
                                                    <h3 class="text-lg font-medium text-gray-900 mb-2">Nenhum agendamento encontrado</h3>
                                                    <p class="text-gray-600">Os agendamentos aparecer√£o aqui conforme forem feitos.</p>
                                                </div>
                                            `}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                renderLogin() {
                    return `
                        <div class="min-h-screen bg-gradient-to-br from-pink-100 to-purple-100 flex items-center justify-center p-4">
                            <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md fade-in">
                                <div class="text-center mb-8">
                                    <h1 class="text-3xl font-bold text-gray-800 mb-2">üíÑ Beauty App</h1>
                                    <p class="text-gray-600">Sistema de agendamento para sal√µes de beleza</p>
                                </div>

                                <div class="space-y-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                        <input
                                            id="email"
                                            type="email"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition duration-200"
                                            placeholder="seu@email.com"
                                        />
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                                        <input
                                            id="password"
                                            type="password"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition duration-200"
                                            placeholder="Sua senha"
                                        />
                                    </div>

                                    <button
                                        id="login-btn"
                                        class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition duration-300 transform hover:scale-105"
                                    >
                                        Entrar
                                    </button>
                                </div>

                                <!-- Login Administrativo -->
                                <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                                    <h3 class="text-sm font-medium text-gray-700 mb-3">üëë Acesso Administrativo</h3>
                                    <button
                                        id="admin-login-btn"
                                        class="w-full bg-gray-800 text-white py-2 rounded-lg hover:bg-gray-900 transition duration-300 text-sm"
                                    >
                                        Login como Administrador
                                    </button>
                                </div>

                                <div class="mt-6 text-center">
                                    <p class="text-gray-600 mb-4">N√£o tem uma conta?</p>
                                    <div class="space-y-3">
                                        <button
                                            id="register-client-btn"
                                            class="w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 transition duration-300 transform hover:scale-105"
                                        >
                                            üë§ Cadastrar como Cliente
                                        </button>
                                        <button
                                            id="register-business-btn"
                                            class="w-full bg-green-500 text-white py-2 rounded-lg hover:bg-green-600 transition duration-300 transform hover:scale-105"
                                        >
                                            üè¢ Cadastrar como Empresa
                                        </button>
                                    </div>
                                </div>

                                <div class="mt-6 text-center">
                                    <p class="text-xs text-gray-500">
                                        ‚úÖ Beauty App v4.1 - Isolamento Completo + Admin Avan√ßado + Agendamentos Detalhados
                                    </p>
                                </div>
                            </div>

                            <!-- Modal de Login Admin -->
                            <div id="admin-login-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
                                <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md mx-4">
                                    <div class="text-center mb-6">
                                        <h2 id="admin-modal-title" class="text-2xl font-bold text-gray-900">üëë Login Administrativo</h2>
                                        <p id="admin-modal-subtitle" class="text-gray-600 mt-2">Acesso completo ao sistema</p>
                                    </div>

                                    <!-- Configura√ß√£o Inicial -->
                                    <div id="admin-first-setup" class="space-y-4" style="display: none;">
                                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                                            <h3 class="text-sm font-medium text-blue-800 mb-2">üîß Configura√ß√£o Inicial</h3>
                                            <p class="text-sm text-blue-700">Configure suas credenciais de administrador pela primeira vez.</p>
                                        </div>

                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Email do Administrador</label>
                                            <input
                                                id="admin-email-setup"
                                                type="email"
                                                required
                                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                placeholder="admin@exemplo.com"
                                            />
                                        </div>

                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Nova Senha de Administrador</label>
                                            <input
                                                id="admin-new-password"
                                                type="password"
                                                required
                                                minlength="6"
                                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                placeholder="M√≠nimo 6 caracteres"
                                            />
                                        </div>

                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Confirmar Nova Senha</label>
                                            <input
                                                id="admin-confirm-password"
                                                type="password"
                                                required
                                                minlength="6"
                                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                placeholder="Digite a senha novamente"
                                            />
                                        </div>

                                        <div class="flex gap-3">
                                            <button
                                                id="admin-setup-confirm"
                                                class="flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition duration-300"
                                            >
                                                ‚öôÔ∏è Configurar Admin
                                            </button>
                                            <button
                                                id="admin-setup-cancel"
                                                class="px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition duration-300"
                                            >
                                                Cancelar
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Login Normal -->
                                    <div id="admin-normal-login" class="space-y-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Senha de Administrador</label>
                                            <input
                                                id="admin-password"
                                                type="password"
                                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-500 focus:border-transparent"
                                                placeholder="Digite a senha de administrador"
                                            />
                                        </div>

                                        <div class="flex gap-3">
                                            <button
                                                id="admin-login-confirm"
                                                class="flex-1 bg-gray-800 text-white py-3 rounded-lg hover:bg-gray-900 transition duration-300"
                                            >
                                                Entrar
                                            </button>
                                            <button
                                                id="admin-login-cancel"
                                                class="px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition duration-300"
                                            >
                                                Cancelar
                                            </button>
                                        </div>

                                        <div class="text-center">
                                            <button
                                                id="admin-change-password-btn"
                                                class="text-sm text-gray-600 hover:text-gray-800 underline"
                                            >
                                                Alterar senha de administrador
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Altera√ß√£o de Senha -->
                                    <div id="admin-change-password" class="space-y-4" style="display: none;">
                                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">
                                            <h3 class="text-sm font-medium text-yellow-800 mb-2">üîê Altera√ß√£o de Senha</h3>
                                            <p class="text-sm text-yellow-700">Digite a senha atual e defina uma nova senha.</p>
                                        </div>

                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Senha Atual</label>
                                            <input
                                                id="admin-current-password"
                                                type="password"
                                                required
                                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
                                                placeholder="Senha atual"
                                            />
                                        </div>

                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Nova Senha</label>
                                            <input
                                                id="admin-new-password-change"
                                                type="password"
                                                required
                                                minlength="6"
                                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
                                                placeholder="Nova senha (m√≠n. 6 caracteres)"
                                            />
                                        </div>

                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Confirmar Nova Senha</label>
                                            <input
                                                id="admin-confirm-new-password"
                                                type="password"
                                                required
                                                minlength="6"
                                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
                                                placeholder="Confirme a nova senha"
                                            />
                                        </div>

                                        <div class="flex gap-3">
                                            <button
                                                id="admin-password-change-confirm"
                                                class="flex-1 bg-yellow-600 text-white py-3 rounded-lg hover:bg-yellow-700 transition duration-300"
                                            >
                                                üîê Alterar Senha
                                            </button>
                                            <button
                                                id="admin-password-change-cancel"
                                                class="px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition duration-300"
                                            >
                                                Cancelar
                                            </button>
                                        </div>
                                    </div>

                                    <div class="mt-4 text-xs text-gray-500 text-center">
                                        <span id="admin-info-text">Sistema de administra√ß√£o seguro</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                renderRegister() {
                    return `
                        <div class="min-h-screen bg-gradient-to-br from-pink-100 to-purple-100 flex items-center justify-center p-4">
                            <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md fade-in">
                                <div class="text-center mb-8">
                                    <h1 class="text-3xl font-bold text-gray-800 mb-2">
                                        ${this.userType === 'business' ? 'üè¢ Cadastro de Empresa' : 'üë§ Cadastro de Cliente'}
                                    </h1>
                                    <p class="text-gray-600">Preencha os dados abaixo</p>
                                </div>

                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            ${this.userType === 'business' ? 'Nome da Empresa' : 'Nome Completo'}
                                        </label>
                                        <input
                                            id="reg-name"
                                            type="text"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition duration-200"
                                            placeholder="${this.userType === 'business' ? 'Sal√£o Beleza Total' : 'Jo√£o Silva'}"
                                        />
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                        <input
                                            id="reg-email"
                                            type="email"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition duration-200"
                                            placeholder="seu@email.com"
                                        />
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Telefone</label>
                                        <input
                                            id="reg-phone"
                                            type="tel"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition duration-200"
                                            placeholder="(48) 99999-9999"
                                        />
                                    </div>

                                    ${this.userType === 'business' ? `
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Endere√ßo</label>
                                        <input
                                            id="reg-address"
                                            type="text"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition duration-200"
                                            placeholder="Rua das Flores, 123"
                                        />
                                    </div>
                                    ` : ''}

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                                        <input
                                            id="reg-password"
                                            type="password"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition duration-200"
                                            minlength="6"
                                            placeholder="M√≠nimo 6 caracteres"
                                        />
                                        <p class="text-xs text-gray-500 mt-1">M√≠nimo 6 caracteres</p>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Confirmar Senha</label>
                                        <input
                                            id="reg-confirm-password"
                                            type="password"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition duration-200"
                                            placeholder="Digite a senha novamente"
                                        />
                                    </div>

                                    <button
                                        id="register-btn"
                                        class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition duration-300 transform hover:scale-105"
                                    >
                                        Cadastrar
                                    </button>
                                </div>

                                <div class="mt-6 text-center">
                                    <button
                                        id="back-to-login"
                                        class="text-pink-600 hover:text-pink-700 font-medium transition duration-200"
                                    >
                                        Voltar ao Login
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                renderForgotPassword() {
                    return `
                        <div class="min-h-screen bg-gradient-to-br from-pink-100 to-purple-100 flex items-center justify-center p-4">
                            <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md fade-in">
                                <div class="text-center mb-8">
                                    <h1 class="text-3xl font-bold text-gray-800 mb-2">üîë Recuperar Senha</h1>
                                    <p class="text-gray-600">Digite seu email para receber as instru√ß√µes</p>
                                </div>

                                <div class="space-y-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                        <input
                                            id="forgot-email"
                                            type="email"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition duration-200"
                                            placeholder="seu@email.com"
                                        />
                                    </div>

                                    <button
                                        id="send-reset-btn"
                                        class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition duration-300 transform hover:scale-105"
                                    >
                                        Enviar Instru√ß√µes
                                    </button>
                                </div>

                                <div class="mt-6 text-center">
                                    <button
                                        id="back-to-login-forgot"
                                        class="text-pink-600 hover:text-pink-700 font-medium transition duration-200"
                                    >
                                        Voltar ao Login
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                renderEmailSent() {
                    return `
                        <div class="min-h-screen bg-gradient-to-br from-pink-100 to-purple-100 flex items-center justify-center p-4">
                            <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md fade-in text-center">
                                <div class="text-6xl mb-4">üìß</div>
                                <h1 class="text-3xl font-bold text-gray-800 mb-2">Email Enviado!</h1>
                                <p class="text-gray-600 mb-6">
                                    Verifique sua caixa de entrada${this.pendingVerificationEmail ? ` (${this.pendingVerificationEmail})` : ''} 
                                    e clique no link para verificar sua conta.
                                </p>
                                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
                                    <p class="text-sm text-yellow-800">
                                        üí° <strong>Dica:</strong> N√£o encontrou o email? Verifique a pasta de spam.
                                    </p>
                                </div>
                                <button
                                    id="back-to-login-email"
                                    class="bg-pink-500 text-white px-6 py-3 rounded-lg hover:bg-pink-600 transition duration-300 transform hover:scale-105"
                                >
                                    Voltar ao Login
                                </button>
                            </div>
                        </div>
                    `;
                }
                
                renderBusinessDashboard() {
                    return `
                        <div class="min-h-screen bg-gray-50">
                            <!-- Header -->
                            <header class="bg-white shadow-sm border-b">
                                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                                    <div class="flex justify-between items-center py-4">
                                        <div class="flex items-center gap-3">
                                            <div class="w-10 h-10 bg-gradient-to-r from-pink-500 to-purple-600 rounded-lg flex items-center justify-center">
                                                <span class="text-white font-bold">üíÑ</span>
                                            </div>
                                            <div>
                                                <h1 class="text-2xl font-bold text-gray-900">Dashboard - ${this.currentUser?.name || 'Empresa'}</h1>
                                                <p class="text-sm text-gray-500">Gerencie seus servi√ßos e agendamentos</p>
                                            </div>
                                        </div>
                                        <div class="flex items-center gap-3">
                                            <button
                                                id="customize-btn"
                                                class="bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition duration-300 flex items-center gap-2"
                                            >
                                                üé® Personalizar
                                            </button>
                                            <button
                                                id="logout-btn"
                                                class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition duration-300"
                                            >
                                                Sair
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </header>

                            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                                <!-- Cards de Status -->
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                                    <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg shadow p-6 text-white">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <p class="text-blue-100">Estabelecimentos</p>
                                                <p class="text-3xl font-bold">${this.businesses.length}</p>
                                            </div>
                                            <div class="text-4xl opacity-80">üè¢</div>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-lg shadow p-6 text-white">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <p class="text-green-100">Servi√ßos</p>
                                                <p class="text-3xl font-bold">${this.services.length}</p>
                                            </div>
                                            <div class="text-4xl opacity-80">üíº</div>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-lg shadow p-6 text-white">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <p class="text-purple-100">Agendamentos</p>
                                                <p class="text-3xl font-bold">${this.appointments.length}</p>
                                            </div>
                                            <div class="text-4xl opacity-80">üìÖ</div>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-gradient-to-r from-yellow-500 to-orange-500 rounded-lg shadow p-6 text-white">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <p class="text-yellow-100">Receita</p>
                                                <p class="text-3xl font-bold">R$ 0</p>
                                            </div>
                                            <div class="text-4xl opacity-80">üí∞</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Se√ß√£o Principal -->
                                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                                    <!-- Gerenciamento de Servi√ßos -->
                                    <div class="lg:col-span-2">
                                        <div class="bg-white rounded-lg shadow">
                                            <div class="p-6 border-b border-gray-200">
                                                <div class="flex items-center justify-between">
                                                    <h2 class="text-xl font-semibold text-gray-900">üíº Meus Servi√ßos</h2>
                                                    <button
                                                        id="add-service-btn"
                                                        class="bg-gradient-to-r from-pink-500 to-purple-600 text-white px-4 py-2 rounded-lg hover:from-pink-600 hover:to-purple-700 transition duration-300 flex items-center gap-2"
                                                    >
                                                        ‚ûï Adicionar Servi√ßo
                                                    </button>
                                                </div>
                                            </div>
                                            
                                            <div class="p-6">
                                                ${this.services.length > 0 ? `
                                                    <div class="space-y-4">
                                                        ${this.services.map(service => `
                                                            <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition duration-200">
                                                                <div class="flex items-center justify-between">
                                                                    <div class="flex-1">
                                                                        <h3 class="text-lg font-medium text-gray-900">${service.name}</h3>
                                                                        <p class="text-gray-600 text-sm mt-1">${service.description || 'Sem descri√ß√£o'}</p>
                                                                        <div class="flex items-center gap-4 mt-2">
                                                                            <span class="text-sm text-gray-500">‚è±Ô∏è ${service.duration_minutes} min</span>
                                                                            <span class="text-lg font-semibold text-green-600">R$ ${service.price}</span>
                                                                            <span class="text-xs px-2 py-1 bg-green-100 text-green-800 rounded-full">
                                                                                ${service.active ? 'Ativo' : 'Inativo'}
                                                                            </span>
                                                                        </div>
                                                                    </div>
                                                                    <div class="flex items-center gap-2">
                                                                        <button
                                                                            onclick="app.editService('${service.id}')"
                                                                            class="text-blue-600 hover:text-blue-800 p-2 rounded-lg hover:bg-blue-50 transition duration-200"
                                                                            title="Editar"
                                                                        >
                                                                            ‚úèÔ∏è
                                                                        </button>
                                                                        <button
                                                                            onclick="app.toggleServiceStatus('${service.id}')"
                                                                            class="text-gray-600 hover:text-gray-800 p-2 rounded-lg hover:bg-gray-50 transition duration-200"
                                                                            title="${service.active ? 'Desativar' : 'Ativar'}"
                                                                        >
                                                                            ${service.active ? 'üö´' : '‚úÖ'}
                                                                        </button>
                                                                        <button
                                                                            onclick="app.deleteService('${service.id}')"
                                                                            class="text-red-600 hover:text-red-800 p-2 rounded-lg hover:bg-red-50 transition duration-200"
                                                                            title="Excluir"
                                                                        >
                                                                            üóëÔ∏è
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        `).join('')}
                                                    </div>
                                                ` : `
                                                    <div class="text-center py-12">
                                                        <div class="text-6xl mb-4">üíº</div>
                                                        <h3 class="text-lg font-medium text-gray-900 mb-2">Nenhum servi√ßo cadastrado</h3>
                                                        <p class="text-gray-600 mb-6">Comece adicionando seus primeiros servi√ßos para que os clientes possam agendar.</p>
                                                        <button
                                                            id="add-first-service-btn"
                                                            class="bg-gradient-to-r from-pink-500 to-purple-600 text-white px-6 py-3 rounded-lg hover:from-pink-600 hover:to-purple-700 transition duration-300"
                                                        >
                                                            ‚ûï Adicionar Primeiro Servi√ßo
                                                        </button>
                                                    </div>
                                                `}
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Sidebar -->
                                    <div class="space-y-6">
                                        <!-- Agendamentos Recentes -->
                                        <div class="bg-white rounded-lg shadow">
                                            <div class="p-6 border-b border-gray-200">
                                                <h3 class="text-lg font-semibold text-gray-900">üìÖ Pr√≥ximos Agendamentos</h3>
                                            </div>
                                            <div class="p-6">
                                                ${this.appointments.length > 0 ? `
                                                    <div class="space-y-3">
                                                        ${this.appointments.slice(0, 3).map(appointment => `
                                                            <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                                                                <div class="w-2 h-8 bg-blue-500 rounded"></div>
                                                                <div class="flex-1">
                                                                    <p class="font-medium text-gray-900">${appointment.client?.name || 'Cliente'}</p>
                                                                    <p class="text-sm text-gray-600">${appointment.service?.name || 'Servi√ßo'}</p>
                                                                    <p class="text-xs text-gray-500">${appointment.appointment_date} √†s ${appointment.appointment_time}</p>
                                                                </div>
                                                            </div>
                                                        `).join('')}
                                                    </div>
                                                ` : `
                                                    <p class="text-gray-600 text-center py-4">Nenhum agendamento hoje</p>
                                                `}
                                            </div>
                                        </div>

                                        <!-- Estat√≠sticas R√°pidas -->
                                        <div class="bg-white rounded-lg shadow">
                                            <div class="p-6 border-b border-gray-200">
                                                <h3 class="text-lg font-semibold text-gray-900">üìä Status do Sistema</h3>
                                            </div>
                                            <div class="p-6 space-y-4">
                                                <div class="flex items-center justify-between">
                                                    <span class="text-gray-600">Banco de Dados</span>
                                                    <span class="text-green-600 font-medium">‚úÖ Online</span>
                                                </div>
                                                <div class="flex items-center justify-between">
                                                    <span class="text-gray-600">Autentica√ß√£o</span>
                                                    <span class="text-green-600 font-medium">‚úÖ Ativo</span>
                                                </div>
                                                <div class="flex items-center justify-between">
                                                    <span class="text-gray-600">Seguran√ßa</span>
                                                    <span class="text-green-600 font-medium">üîí RLS Ativo</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Modal para Adicionar/Editar Servi√ßo -->
                            <div id="service-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
                                <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md mx-4">
                                    <div class="flex items-center justify-between mb-6">
                                        <h2 id="service-modal-title" class="text-2xl font-bold text-gray-900">‚ûï Adicionar Servi√ßo</h2>
                                        <button id="close-service-modal" class="text-gray-500 hover:text-gray-700">
                                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                            </svg>
                                        </button>
                                    </div>

                                    <form id="service-form" class="space-y-6">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Nome do Servi√ßo</label>
                                            <input
                                                id="service-name"
                                                type="text"
                                                required
                                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                                placeholder="Ex: Corte Feminino"
                                            />
                                        </div>

                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Descri√ß√£o</label>
                                            <textarea
                                                id="service-description"
                                                rows="3"
                                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                                placeholder="Ex: Corte moderno com finaliza√ß√£o profissional"
                                            ></textarea>
                                        </div>

                                        <div class="grid grid-cols-2 gap-4">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-2">Dura√ß√£o (min)</label>
                                                <input
                                                    id="service-duration"
                                                    type="number"
                                                    required
                                                    min="15"
                                                    step="15"
                                                    value="60"
                                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                                />
                                            </div>

                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-2">Pre√ßo (R$)</label>
                                                <input
                                                    id="service-price"
                                                    type="number"
                                                    required
                                                    min="0"
                                                    step="0.01"
                                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                                    placeholder="0.00"
                                                />
                                            </div>
                                        </div>

                                        <div class="flex items-center gap-4 pt-4">
                                            <button
                                                type="submit"
                                                id="save-service-btn"
                                                class="flex-1 bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition duration-300"
                                            >
                                                üíæ Salvar Servi√ßo
                                            </button>
                                            <button
                                                type="button"
                                                id="cancel-service-btn"
                                                class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition duration-300"
                                            >
                                                Cancelar
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>

                            <!-- Modal de Personaliza√ß√£o -->
                            <div id="customize-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
                                <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-lg mx-4">
                                    <div class="flex items-center justify-between mb-6">
                                        <h2 class="text-2xl font-bold text-gray-900">üé® Personalizar Empresa</h2>
                                        <button id="close-customize-modal" class="text-gray-500 hover:text-gray-700">
                                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                            </svg>
                                        </button>
                                    </div>

                                    <div class="space-y-6">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Logo da Empresa</label>
                                            <div class="flex items-center gap-4">
                                                <div class="w-16 h-16 bg-gradient-to-r from-pink-500 to-purple-600 rounded-lg flex items-center justify-center">
                                                    <span class="text-white text-2xl">üíÑ</span>
                                                </div>
                                                <button class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition duration-300">
                                                    üì∏ Alterar Logo
                                                </button>
                                            </div>
                                        </div>

                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Cor Principal</label>
                                            <div class="grid grid-cols-6 gap-3">
                                                <button class="w-10 h-10 bg-pink-500 rounded-lg ring-2 ring-pink-300"></button>
                                                <button class="w-10 h-10 bg-purple-500 rounded-lg"></button>
                                                <button class="w-10 h-10 bg-blue-500 rounded-lg"></button>
                                                <button class="w-10 h-10 bg-green-500 rounded-lg"></button>
                                                <button class="w-10 h-10 bg-red-500 rounded-lg"></button>
                                                <button class="w-10 h-10 bg-yellow-500 rounded-lg"></button>
                                            </div>
                                        </div>

                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Tema</label>
                                            <div class="grid grid-cols-2 gap-4">
                                                <button class="p-4 border-2 border-pink-300 rounded-lg text-left">
                                                    <div class="font-medium">üå∏ Feminino</div>
                                                    <div class="text-sm text-gray-600">Rosa e roxo</div>
                                                </button>
                                                <button class="p-4 border-2 border-gray-200 rounded-lg text-left">
                                                    <div class="font-medium">‚ö´ Moderno</div>
                                                    <div class="text-sm text-gray-600">Preto e branco</div>
                                                </button>
                                            </div>
                                        </div>

                                        <div class="flex gap-4 pt-4">
                                            <button class="flex-1 bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition duration-300">
                                                üíæ Salvar Personaliza√ß√£o
                                            </button>
                                            <button id="cancel-customize-btn" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition duration-300">
                                                Cancelar
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                renderClientDashboard() {
                    return `
                        <div class="min-h-screen bg-gray-50">
                            <header class="bg-white shadow-sm border-b">
                                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                                    <div class="flex justify-between items-center py-4">
                                        <div class="flex items-center gap-3">
                                            <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                                                <span class="text-white font-bold">üë§</span>
                                            </div>
                                            <div>
                                                <h1 class="text-2xl font-bold text-gray-900">Ol√°, ${this.currentUser?.name || 'Cliente'}!</h1>
                                                <p class="text-sm text-gray-500">Encontre e agende seus servi√ßos de beleza</p>
                                            </div>
                                        </div>
                                        <button
                                            id="logout-btn"
                                            class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition duration-300"
                                        >
                                            Sair
                                        </button>
                                    </div>
                                </div>
                            </header>

                            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                                <!-- Barra de Busca -->
                                <div class="mb-8">
                                    <div class="bg-white rounded-lg shadow p-6">
                                        <h2 class="text-xl font-semibold text-gray-900 mb-4">üîç Encontre servi√ßos de beleza</h2>
                                        <div class="flex gap-4">
                                            <input
                                                id="search-services"
                                                type="text"
                                                placeholder="Buscar por servi√ßo ou estabelecimento..."
                                                class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            />
                                            <button
                                                id="search-btn"
                                                class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition duration-300"
                                            >
                                                Buscar
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                                    <!-- Lista de Estabelecimentos e Servi√ßos -->
                                    <div class="lg:col-span-2">
                                        <div class="bg-white rounded-lg shadow">
                                            <div class="p-6 border-b border-gray-200">
                                                <h2 class="text-xl font-semibold text-gray-900">üè¢ Estabelecimentos Dispon√≠veis</h2>
                                            </div>
                                            
                                            <div class="p-6">
                                                ${this.businesses.length > 0 ? `
                                                    <div class="space-y-6">
                                                        ${this.businesses.map(business => {
                                                            const businessServices = this.services.filter(s => s.business_id === business.id && s.active);
                                                            return `
                                                                <div data-business-card class="border border-gray-200 rounded-lg p-6">
                                                                    <div class="flex items-start justify-between mb-4">
                                                                        <div>
                                                                            <h3 class="text-lg font-semibold text-gray-900">${business.name}</h3>
                                                                            <p class="text-gray-600">${business.address || 'Endere√ßo n√£o informado'}</p>
                                                                            ${business.phone ? `<p class="text-sm text-gray-500">üìû ${business.phone}</p>` : ''}
                                                                        </div>
                                                                        <div class="text-right">
                                                                            <span class="inline-block px-3 py-1 bg-green-100 text-green-800 text-xs rounded-full">
                                                                                ${businessServices.length} servi√ßos
                                                                            </span>
                                                                        </div>
                                                                    </div>
                                                                    
                                                                    ${businessServices.length > 0 ? `
                                                                        <div class="space-y-3">
                                                                            <h4 class="font-medium text-gray-900">Servi√ßos dispon√≠veis:</h4>
                                                                            <div class="grid grid-cols-1 gap-3">
                                                                                ${businessServices.map(service => `
                                                                                    <div class="bg-gray-50 rounded-lg p-4 flex items-center justify-between">
                                                                                        <div class="flex-1">
                                                                                            <h5 class="font-medium text-gray-900">${service.name}</h5>
                                                                                            ${service.description ? `<p class="text-sm text-gray-600 mt-1">${service.description}</p>` : ''}
                                                                                            <div class="flex items-center gap-4 mt-2">
                                                                                                <span class="text-sm text-gray-500">‚è±Ô∏è ${service.duration_minutes} min</span>
                                                                                                <span class="text-lg font-semibold text-green-600">R$ ${service.price}</span>
                                                                                            </div>
                                                                                        </div>
                                                                                        <button
                                                                                            onclick="app.openBookingModal('${service.id}', '${business.id}')"
                                                                                            class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition duration-300 ml-4"
                                                                                        >
                                                                                            üìÖ Agendar
                                                                                        </button>
                                                                                    </div>
                                                                                `).join('')}
                                                                            </div>
                                                                        </div>
                                                                    ` : `
                                                                        <p class="text-gray-500">Nenhum servi√ßo dispon√≠vel no momento</p>
                                                                    `}
                                                                </div>
                                                            `;
                                                        }).join('')}
                                                    </div>
                                                ` : `
                                                    <div class="text-center py-12">
                                                        <div class="text-6xl mb-4">üè¢</div>
                                                        <h3 class="text-lg font-medium text-gray-900 mb-2">Nenhum estabelecimento dispon√≠vel</h3>
                                                        <p class="text-gray-600">Ainda n√£o h√° sal√µes cadastrados na plataforma.</p>
                                                    </div>
                                                `}
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Sidebar -->
                                    <div class="space-y-6">
                                        <!-- Meus Agendamentos -->
                                        <div class="bg-white rounded-lg shadow">
                                            <div class="p-6 border-b border-gray-200">
                                                <h3 class="text-lg font-semibold text-gray-900">üìÖ Meus Agendamentos</h3>
                                            </div>
                                            <div class="p-6">
                                                ${this.appointments.length > 0 ? `
                                                    <div class="space-y-4">
                                                        ${this.appointments.slice(0, 5).map(appointment => `
                                                            <div class="border border-gray-200 rounded-lg p-4">
                                                                <div class="flex items-start justify-between mb-3">
                                                                    <div class="flex-1">
                                                                        <h4 class="font-medium text-gray-900">${appointment.service?.name || 'Servi√ßo n√£o especificado'}</h4>
                                                                        <p class="text-sm text-gray-600">${appointment.business?.name || 'Estabelecimento n√£o especificado'}</p>
                                                                        ${appointment.business?.address ? `<p class="text-xs text-gray-500">üìç ${appointment.business.address}</p>` : ''}
                                                                    </div>
                                                                    <span class="inline-block px-2 py-1 text-xs rounded-full ${
                                                                        appointment.status === 'confirmed' ? 'bg-green-100 text-green-800' :
                                                                        appointment.status === 'pending' ? 'bg-yellow-100 text-yellow-800' :
                                                                        appointment.status === 'cancelled' ? 'bg-red-100 text-red-800' :
                                                                        'bg-gray-100 text-gray-800'
                                                                    }">
                                                                        ${appointment.status === 'confirmed' ? 'Confirmado' :
                                                                        appointment.status === 'pending' ? 'Pendente' :
                                                                        appointment.status === 'cancelled' ? 'Cancelado' : 'Conclu√≠do'}
                                                                    </span>
                                                                </div>
                                                                
                                                                <div class="bg-gray-50 rounded-lg p-3">
                                                                    <div class="grid grid-cols-2 gap-4 text-sm">
                                                                        <div>
                                                                            <span class="text-gray-500">üìÖ Data:</span>
                                                                            <span class="font-medium ml-1">${new Date(appointment.appointment_date).toLocaleDateString('pt-BR')}</span>
                                                                        </div>
                                                                        <div>
                                                                            <span class="text-gray-500">‚è∞ Hor√°rio:</span>
                                                                            <span class="font-medium ml-1">${appointment.appointment_time}</span>
                                                                        </div>
                                                                        ${appointment.service?.duration_minutes ? `
                                                                            <div>
                                                                                <span class="text-gray-500">‚è±Ô∏è Dura√ß√£o:</span>
                                                                                <span class="font-medium ml-1">${appointment.service.duration_minutes} min</span>
                                                                            </div>
                                                                        ` : ''}
                                                                        ${appointment.service?.price ? `
                                                                            <div>
                                                                                <span class="text-gray-500">üí∞ Valor:</span>
                                                                                <span class="font-medium ml-1 text-green-600">R$ ${appointment.service.price}</span>
                                                                            </div>
                                                                        ` : ''}
                                                                    </div>
                                                                    
                                                                    ${appointment.notes ? `
                                                                        <div class="mt-3 pt-3 border-t border-gray-200">
                                                                            <span class="text-xs text-gray-500">üìù Observa√ß√µes:</span>
                                                                            <p class="text-sm text-gray-700 mt-1">${appointment.notes}</p>
                                                                        </div>
                                                                    ` : ''}
                                                                </div>
                                                                
                                                                ${appointment.status === 'pending' ? `
                                                                    <div class="mt-3 flex gap-2">
                                                                        <button
                                                                            onclick="app.cancelAppointment('${appointment.id}')"
                                                                            class="text-xs bg-red-100 text-red-700 px-3 py-1 rounded-lg hover:bg-red-200 transition duration-200"
                                                                        >
                                                                            Cancelar
                                                                        </button>
                                                                    </div>
                                                                ` : ''}
                                                            </div>
                                                        `).join('')}
                                                        
                                                        ${this.appointments.length > 5 ? `
                                                            <button
                                                                onclick="app.showAllAppointments()"
                                                                class="w-full text-blue-600 hover:text-blue-700 text-sm py-2 border border-blue-200 rounded-lg hover:bg-blue-50 transition duration-200"
                                                            >
                                                                Ver todos os agendamentos (${this.appointments.length})
                                                            </button>
                                                        ` : ''}
                                                    </div>
                                                ` : `
                                                    <div class="text-center py-8">
                                                        <div class="text-4xl mb-3">üìÖ</div>
                                                        <p class="text-gray-600">Nenhum agendamento ainda</p>
                                                        <p class="text-sm text-gray-500 mt-1">Que tal agendar seu primeiro servi√ßo?</p>
                                                    </div>
                                                `}
                                            </div>
                                        </div>

                                        <!-- Estat√≠sticas -->
                                        <div class="bg-white rounded-lg shadow">
                                            <div class="p-6 border-b border-gray-200">
                                                <h3 class="text-lg font-semibold text-gray-900">üìä Resumo</h3>
                                            </div>
                                            <div class="p-6 space-y-4">
                                                <div class="flex items-center justify-between">
                                                    <span class="text-gray-600">Estabelecimentos</span>
                                                    <span class="font-semibold text-blue-600">${this.businesses.length}</span>
                                                </div>
                                                <div class="flex items-center justify-between">
                                                    <span class="text-gray-600">Servi√ßos Dispon√≠veis</span>
                                                    <span class="font-semibold text-green-600">${this.services.filter(s => s.active).length}</span>
                                                </div>
                                                <div class="flex items-center justify-between">
                                                    <span class="text-gray-600">Meus Agendamentos</span>
                                                    <span class="font-semibold text-purple-600">${this.appointments.length}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Modal de Agendamento -->
                            <div id="booking-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
                                <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md mx-4">
                                    <div class="flex items-center justify-between mb-6">
                                        <h2 class="text-2xl font-bold text-gray-900">üìÖ Agendar Servi√ßo</h2>
                                        <button id="close-booking-modal" class="text-gray-500 hover:text-gray-700">
                                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                            </svg>
                                        </button>
                                    </div>

                                    <form id="booking-form" class="space-y-6">
                                        <div id="service-info" class="bg-gray-50 rounded-lg p-4">
                                            <!-- Informa√ß√µes do servi√ßo ser√£o inseridas aqui -->
                                        </div>

                                        <div class="grid grid-cols-2 gap-4">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-2">Data</label>
                                                <input
                                                    id="booking-date"
                                                    type="date"
                                                    required
                                                    min="${new Date().toISOString().split('T')[0]}"
                                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                />
                                            </div>

                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-2">Hor√°rio</label>
                                                <select
                                                    id="booking-time"
                                                    required
                                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                >
                                                    <option value="">Selecione</option>
                                                    <option value="08:00">08:00</option>
                                                    <option value="08:30">08:30</option>
                                                    <option value="09:00">09:00</option>
                                                    <option value="09:30">09:30</option>
                                                    <option value="10:00">10:00</option>
                                                    <option value="10:30">10:30</option>
                                                    <option value="11:00">11:00</option>
                                                    <option value="11:30">11:30</option>
                                                    <option value="14:00">14:00</option>
                                                    <option value="14:30">14:30</option>
                                                    <option value="15:00">15:00</option>
                                                    <option value="15:30">15:30</option>
                                                    <option value="16:00">16:00</option>
                                                    <option value="16:30">16:30</option>
                                                    <option value="17:00">17:00</option>
                                                    <option value="17:30">17:30</option>
                                                    <option value="18:00">18:00</option>
                                                </select>
                                            </div>
                                        </div>

                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Observa√ß√µes (opcional)</label>
                                            <textarea
                                                id="booking-notes"
                                                rows="3"
                                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                placeholder="Alguma observa√ß√£o especial..."
                                            ></textarea>
                                        </div>

                                        <div class="flex gap-4 pt-4">
                                            <button
                                                type="submit"
                                                id="confirm-booking-btn"
                                                class="flex-1 bg-blue-500 text-white py-3 rounded-lg font-semibold hover:bg-blue-600 transition duration-300"
                                            >
                                                ‚úÖ Confirmar Agendamento
                                            </button>
                                            <button
                                                type="button"
                                                id="cancel-booking-btn"
                                                class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition duration-300"
                                            >
                                                Cancelar
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                attachEvents() {
                    // Login
                    const loginBtn = document.getElementById('login-btn');
                    if (loginBtn) {
                        loginBtn.addEventListener('click', () => this.handleLogin());
                    }

                    // Admin Login
                    const adminLoginBtn = document.getElementById('admin-login-btn');
                    if (adminLoginBtn) {
                        adminLoginBtn.addEventListener('click', () => this.handleAdminLogin());
                    }

                    const adminLoginConfirm = document.getElementById('admin-login-confirm');
                    if (adminLoginConfirm) {
                        adminLoginConfirm.addEventListener('click', () => this.confirmAdminLogin());
                    }

                    const adminLoginCancel = document.getElementById('admin-login-cancel');
                    if (adminLoginCancel) {
                        adminLoginCancel.addEventListener('click', () => this.closeAdminModal());
                    }

                    // Admin Setup (primeira configura√ß√£o)
                    const adminSetupConfirm = document.getElementById('admin-setup-confirm');
                    if (adminSetupConfirm) {
                        adminSetupConfirm.addEventListener('click', () => this.confirmAdminSetup());
                    }

                    const adminSetupCancel = document.getElementById('admin-setup-cancel');
                    if (adminSetupCancel) {
                        adminSetupCancel.addEventListener('click', () => this.closeAdminModal());
                    }

                    // Admin Change Password
                    const adminChangePasswordBtn = document.getElementById('admin-change-password-btn');
                    if (adminChangePasswordBtn) {
                        adminChangePasswordBtn.addEventListener('click', () => this.showAdminChangePassword());
                    }

                    const adminPasswordChangeConfirm = document.getElementById('admin-password-change-confirm');
                    if (adminPasswordChangeConfirm) {
                        adminPasswordChangeConfirm.addEventListener('click', () => this.confirmAdminPasswordChange());
                    }

                    const adminPasswordChangeCancel = document.getElementById('admin-password-change-cancel');
                    if (adminPasswordChangeCancel) {
                        adminPasswordChangeCancel.addEventListener('click', () => this.showAdminLogin());
                    }

                    // Admin Settings Button
                    const adminSettingsBtn = document.getElementById('admin-settings-btn');
                    if (adminSettingsBtn) {
                        adminSettingsBtn.addEventListener('click', () => this.showAdminSettings());
                    }

                    // Tabs do Admin
                    document.querySelectorAll('.tab-button').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const tabName = e.target.id.replace('tab-', '');
                            this.switchAdminTab(tabName);
                        });
                    });
                    
                    // Register navigation
                    const registerClientBtn = document.getElementById('register-client-btn');
                    if (registerClientBtn) {
                        registerClientBtn.addEventListener('click', () => {
                            this.userType = 'client';
                            this.currentView = 'register';
                            this.render();
                        });
                    }
                    
                    const registerBusinessBtn = document.getElementById('register-business-btn');
                    if (registerBusinessBtn) {
                        registerBusinessBtn.addEventListener('click', () => {
                            this.userType = 'business';
                            this.currentView = 'register';
                            this.render();
                        });
                    }
                    
                    // Register
                    const registerBtn = document.getElementById('register-btn');
                    if (registerBtn) {
                        registerBtn.addEventListener('click', () => this.handleRegister());
                    }
                    
                    // Back to login
                    const backToLogin = document.getElementById('back-to-login');
                    if (backToLogin) {
                        backToLogin.addEventListener('click', () => {
                            this.currentView = 'login';
                            this.render();
                        });
                    }
                    
                    const backToLoginForgot = document.getElementById('back-to-login-forgot');
                    if (backToLoginForgot) {
                        backToLoginForgot.addEventListener('click', () => {
                            this.currentView = 'login';
                            this.render();
                        });
                    }
                    
                    const backToLoginEmail = document.getElementById('back-to-login-email');
                    if (backToLoginEmail) {
                        backToLoginEmail.addEventListener('click', () => {
                            this.currentView = 'login';
                            this.render();
                        });
                    }
                    
                    // Forgot password
                    const forgotPasswordBtn = document.getElementById('forgot-password-btn');
                    if (forgotPasswordBtn) {
                        forgotPasswordBtn.addEventListener('click', () => {
                            this.currentView = 'forgot-password';
                            this.render();
                        });
                    }
                    
                    const sendResetBtn = document.getElementById('send-reset-btn');
                    if (sendResetBtn) {
                        sendResetBtn.addEventListener('click', () => this.handleForgotPassword());
                    }
                    
                    // Logout
                    const logoutBtn = document.getElementById('logout-btn');
                    if (logoutBtn) {
                        logoutBtn.addEventListener('click', () => this.handleLogout());
                    }

                    // Bot√µes de Servi√ßos
                    const addServiceBtn = document.getElementById('add-service-btn');
                    const addFirstServiceBtn = document.getElementById('add-first-service-btn');
                    if (addServiceBtn) {
                        addServiceBtn.addEventListener('click', () => this.openServiceModal());
                    }
                    if (addFirstServiceBtn) {
                        addFirstServiceBtn.addEventListener('click', () => this.openServiceModal());
                    }

                    // Modal de Servi√ßos
                    const serviceModal = document.getElementById('service-modal');
                    const closeServiceModal = document.getElementById('close-service-modal');
                    const cancelServiceBtn = document.getElementById('cancel-service-btn');
                    const serviceForm = document.getElementById('service-form');

                    if (closeServiceModal) {
                        closeServiceModal.addEventListener('click', () => this.closeServiceModal());
                    }
                    if (cancelServiceBtn) {
                        cancelServiceBtn.addEventListener('click', () => this.closeServiceModal());
                    }
                    if (serviceForm) {
                        serviceForm.addEventListener('submit', (e) => this.handleSaveService(e));
                    }
                    if (serviceModal) {
                        serviceModal.addEventListener('click', (e) => {
                            if (e.target === serviceModal) {
                                this.closeServiceModal();
                            }
                        });
                    }

                    // Bot√£o de Personaliza√ß√£o
                    const customizeBtn = document.getElementById('customize-btn');
                    if (customizeBtn) {
                        customizeBtn.addEventListener('click', () => this.openCustomizeModal());
                    }

                    // Modal de Personaliza√ß√£o
                    const customizeModal = document.getElementById('customize-modal');
                    const closeCustomizeModal = document.getElementById('close-customize-modal');
                    const cancelCustomizeBtn = document.getElementById('cancel-customize-btn');

                    if (closeCustomizeModal) {
                        closeCustomizeModal.addEventListener('click', () => this.closeCustomizeModal());
                    }
                    if (cancelCustomizeBtn) {
                        cancelCustomizeBtn.addEventListener('click', () => this.closeCustomizeModal());
                    }
                    if (customizeModal) {
                        customizeModal.addEventListener('click', (e) => {
                            if (e.target === customizeModal) {
                                this.closeCustomizeModal();
                            }
                        });
                    }

                    // Modal de Agendamento (Clientes)
                    const bookingModal = document.getElementById('booking-modal');
                    const closeBookingModal = document.getElementById('close-booking-modal');
                    const cancelBookingBtn = document.getElementById('cancel-booking-btn');
                    const bookingForm = document.getElementById('booking-form');

                    if (closeBookingModal) {
                        closeBookingModal.addEventListener('click', () => this.closeBookingModal());
                    }
                    if (cancelBookingBtn) {
                        cancelBookingBtn.addEventListener('click', () => this.closeBookingModal());
                    }
                    if (bookingForm) {
                        bookingForm.addEventListener('submit', (e) => this.handleBooking(e));
                    }
                    if (bookingModal) {
                        bookingModal.addEventListener('click', (e) => {
                            if (e.target === bookingModal) {
                                this.closeBookingModal();
                            }
                        });
                    }

                    // Modal Admin Login
                    const adminLoginModal = document.getElementById('admin-login-modal');
                    if (adminLoginModal) {
                        adminLoginModal.addEventListener('click', (e) => {
                            if (e.target === adminLoginModal) {
                                this.closeAdminModal();
                            }
                        });
                    }
                    
                    // Enter key support
                    document.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter' && !this.loading) {
                            if (this.currentView === 'login') {
                                this.handleLogin();
                            } else if (this.currentView === 'register') {
                                this.handleRegister();
                            } else if (this.currentView === 'forgot-password') {
                                this.handleForgotPassword();
                            }
                            
                            // Enter no modal admin
                            if (document.getElementById('admin-login-modal') && !document.getElementById('admin-login-modal').classList.contains('hidden')) {
                                this.confirmAdminLogin();
                            }
                        }
                    });

                    // ESC key support para modals
                    document.addEventListener('keydown', (e) => {
                        if (e.key === 'Escape') {
                            this.closeServiceModal();
                            this.closeCustomizeModal();
                            this.closeBookingModal();
                            this.closeAdminModal();
                        }
                    });
                }

                showAdminSettings() {
                    // Criar modal de configura√ß√µes administrativas
                    const modal = document.createElement('div');
                    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                    modal.innerHTML = `
                        <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md mx-4">
                            <div class="flex items-center justify-between mb-6">
                                <h2 class="text-2xl font-bold text-gray-900">‚öôÔ∏è Configura√ß√µes Administrativas</h2>
                                <button id="close-admin-settings" class="text-gray-500 hover:text-gray-700">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            
                            <div class="space-y-6">
                                <!-- Informa√ß√µes Atuais -->
                                <div class="bg-gray-50 rounded-lg p-4">
                                    <h3 class="font-medium text-gray-900 mb-3">üìä Informa√ß√µes do Administrador</h3>
                                    <div class="space-y-2 text-sm">
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Email:</span>
                                            <span class="font-medium">${this.adminConfig.email || 'N√£o configurado'}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">√öltima altera√ß√£o:</span>
                                            <span class="font-medium">${new Date().toLocaleDateString('pt-BR')}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Status:</span>
                                            <span class="font-medium text-green-600">‚úÖ Ativo</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- A√ß√µes -->
                                <div class="space-y-3">
                                    <button
                                        id="change-admin-email"
                                        class="w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 transition duration-300 flex items-center justify-center gap-2"
                                    >
                                        üìß Alterar Email
                                    </button>
                                    
                                    <button
                                        id="change-admin-password-settings"
                                        class="w-full bg-yellow-500 text-white py-3 rounded-lg hover:bg-yellow-600 transition duration-300 flex items-center justify-center gap-2"
                                    >
                                        üîê Alterar Senha
                                    </button>
                                    
                                    <button
                                        id="reset-admin-config"
                                        class="w-full bg-red-500 text-white py-3 rounded-lg hover:bg-red-600 transition duration-300 flex items-center justify-center gap-2"
                                    >
                                        üîÑ Resetar Configura√ß√µes
                                    </button>
                                </div>
                                
                                <!-- Estat√≠sticas do Sistema -->
                                <div class="bg-green-50 rounded-lg p-4">
                                    <h3 class="font-medium text-gray-900 mb-3">üìä Estat√≠sticas do Sistema</h3>
                                    <div class="grid grid-cols-2 gap-4 text-sm">
                                        <div class="text-center">
                                            <div class="text-2xl font-bold text-blue-600">${this.allUsers?.length || 0}</div>
                                            <div class="text-gray-600">Usu√°rios</div>
                                        </div>
                                        <div class="text-center">
                                            <div class="text-2xl font-bold text-green-600">${this.businesses?.length || 0}</div>
                                            <div class="text-gray-600">Estabelecimentos</div>
                                        </div>
                                        <div class="text-center">
                                            <div class="text-2xl font-bold text-purple-600">${this.allServices?.length || 0}</div>
                                            <div class="text-gray-600">Servi√ßos</div>
                                        </div>
                                        <div class="text-center">
                                            <div class="text-2xl font-bold text-orange-600">${this.allAppointments?.length || 0}</div>
                                            <div class="text-gray-600">Agendamentos</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-6 text-center">
                                <button id="close-admin-settings-btn" class="bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700 transition duration-300">
                                    Fechar
                                </button>
                            </div>
                        </div>
                    `;
                    
                    document.body.appendChild(modal);
                    
                    // Event listeners
                    modal.querySelector('#close-admin-settings').addEventListener('click', () => modal.remove());
                    modal.querySelector('#close-admin-settings-btn').addEventListener('click', () => modal.remove());
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) modal.remove();
                    });
                    
                    // Funcionalidades espec√≠ficas
                    modal.querySelector('#change-admin-email').addEventListener('click', () => {
                        modal.remove();
                        this.changeAdminEmail();
                    });
                    
                    modal.querySelector('#change-admin-password-settings').addEventListener('click', () => {
                        modal.remove();
                        this.handleAdminLogin();
                        setTimeout(() => this.showAdminChangePassword(), 200);
                    });
                    
                    modal.querySelector('#reset-admin-config').addEventListener('click', () => {
                        if (confirm('‚ö†Ô∏è ATEN√á√ÉO: Isso resetar√° todas as configura√ß√µes administrativas e voc√™ precisar√° configurar tudo novamente.\n\nTem certeza que deseja continuar?')) {
                            localStorage.removeItem('admin_password');
                            localStorage.removeItem('admin_email');
                            localStorage.removeItem('admin_first_login');
                            this.adminConfig = {
                                password: 'admin123',
                                email: '',
                                firstLogin: true
                            };
                            modal.remove();
                            this.showMessage('Configura√ß√µes administrativas resetadas!', 'success');
                        }
                    });
                }

                changeAdminEmail() {
                    const newEmail = prompt('Digite o novo email do administrador:', this.adminConfig.email);
                    if (newEmail && newEmail.trim()) {
                        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                        if (emailRegex.test(newEmail.trim())) {
                            this.adminConfig.email = newEmail.trim();
                            localStorage.setItem('admin_email', newEmail.trim());
                            this.currentUser.email = newEmail.trim();
                            this.showMessage('Email do administrador alterado com sucesso!', 'success');
                            this.render(); // Re-renderizar para atualizar o header
                        } else {
                            this.showMessage('Por favor, digite um email v√°lido', 'error');
                        }
                    }
                
                async handleLogin() {
                    const email = document.getElementById('email').value.trim();
                    const password = document.getElementById('password').value;
                    const loginBtn = document.getElementById('login-btn');
                    
                    if (!email || !password) {
                        this.showMessage('Por favor, preencha email e senha', 'error');
                        return;
                    }
                    
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(email)) {
                        this.showMessage('Por favor, digite um email v√°lido', 'error');
                        return;
                    }
                    
                    try {
                        loginBtn.textContent = 'Entrando...';
                        loginBtn.disabled = true;
                        
                        console.log('üîê Tentando login para:', email);
                        const { data, error } = await supabase.auth.signInWithPassword({
                            email: email,
                            password: password
                        });
                        
                        if (error) throw error;
                        
                        console.log('‚úÖ Login realizado:', data);
                        this.showMessage('Login realizado com sucesso!', 'success');
                        
                    } catch (error) {
                        console.error('‚ùå Erro no login:', error);
                        
                        let errorMessage = 'Erro no login: ';
                        if (error.message.includes('Invalid login credentials')) {
                            errorMessage = 'Email ou senha incorretos';
                        } else if (error.message.includes('Email not confirmed')) {
                            errorMessage = 'Por favor, confirme seu email antes de fazer login';
                        } else {
                            errorMessage = 'Erro no login: ' + error.message;
                        }
                        
                        this.showMessage(errorMessage, 'error');
                    } finally {
                        loginBtn.textContent = 'Entrar';
                        loginBtn.disabled = false;
                    }
                }
                
                async handleRegister() {
                    const name = document.getElementById('reg-name').value.trim();
                    const email = document.getElementById('reg-email').value.trim();
                    const phone = document.getElementById('reg-phone').value.trim();
                    const password = document.getElementById('reg-password').value;
                    const confirmPassword = document.getElementById('reg-confirm-password').value;
                    const address = document.getElementById('reg-address')?.value.trim() || '';
                    const registerBtn = document.getElementById('register-btn');
                    
                    if (!name || !email || !phone || !password || !confirmPassword) {
                        this.showMessage('Por favor, preencha todos os campos obrigat√≥rios', 'error');
                        return;
                    }
                    
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(email)) {
                        this.showMessage('Por favor, digite um email v√°lido', 'error');
                        return;
                    }
                    
                    if (password.length < 6) {
                        this.showMessage('A senha deve ter pelo menos 6 caracteres', 'error');
                        return;
                    }
                    
                    if (password !== confirmPassword) {
                        this.showMessage('As senhas n√£o coincidem!', 'error');
                        return;
                    }
                    
                    if (this.userType === 'business' && !address) {
                        this.showMessage('O endere√ßo √© obrigat√≥rio para empresas', 'error');
                        return;
                    }
                    
                    try {
                        registerBtn.textContent = 'Cadastrando...';
                        registerBtn.disabled = true;
                        
                        console.log('üìù Registrando usu√°rio:', this.userType);
                        const { data, error } = await supabase.auth.signUp({
                            email: email,
                            password: password,
                            options: {
                                data: {
                                    name: name,
                                    user_type: this.userType,
                                    phone: phone,
                                    address: address
                                }
                            }
                        });
                        
                        if (error) throw error;
                        
                        console.log('‚úÖ Usu√°rio registrado:', data);
                        this.pendingVerificationEmail = email;
                        this.currentView = 'email-sent';
                        this.render();
                        this.showMessage('Cadastro realizado! Verifique seu email.', 'success');
                        
                    } catch (error) {
                        console.error('‚ùå Erro no cadastro:', error);
                        
                        let errorMessage = 'Erro no cadastro: ';
                        if (error.message.includes('already registered')) {
                            errorMessage = 'Este email j√° est√° cadastrado';
                        } else {
                            errorMessage = 'Erro no cadastro: ' + error.message;
                        }
                        
                        this.showMessage(errorMessage, 'error');
                    } finally {
                        registerBtn.textContent = 'Cadastrar';
                        registerBtn.disabled = false;
                    }
                }
                
                async handleForgotPassword() {
                    const email = document.getElementById('forgot-email').value.trim();
                    const sendResetBtn = document.getElementById('send-reset-btn');
                    
                    if (!email) {
                        this.showMessage('Por favor, digite seu email', 'error');
                        return;
                    }
                    
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(email)) {
                        this.showMessage('Por favor, digite um email v√°lido', 'error');
                        return;
                    }
                    
                    try {
                        sendResetBtn.textContent = 'Enviando...';
                        sendResetBtn.disabled = true;
                        
                        console.log('üîÑ Enviando email de recupera√ß√£o para:', email);
                        const { error } = await supabase.auth.resetPasswordForEmail(email, {
                            redirectTo: window.location.origin + window.location.pathname
                        });
                        
                        if (error) throw error;
                        
                        this.pendingVerificationEmail = email;
                        this.currentView = 'email-sent';
                        this.render();
                        this.showMessage('Email de recupera√ß√£o enviado!', 'success');
                    } catch (error) {
                        console.error('‚ùå Erro ao enviar email:', error);
                        this.showMessage('Erro ao enviar email: ' + error.message, 'error');
                    } finally {
                        sendResetBtn.textContent = 'Enviar Instru√ß√µes';
                        sendResetBtn.disabled = false;
                    }
                }
                
                async handleLogout() {
                    try {
                        if (this.isAdmin) {
                            // Logout administrativo
                            this.isAdmin = false;
                            this.currentUser = null;
                            this.allUsers = [];
                            this.allServices = [];
                            this.allAppointments = [];
                            this.currentView = 'login';
                            this.render();
                            this.showMessage('Logout administrativo realizado com sucesso!', 'success');
                        } else {
                            // Logout normal via Supabase
                            const { error } = await supabase.auth.signOut();
                            if (error) throw error;
                            
                            this.currentUser = null;
                            this.currentView = 'login';
                            this.render();
                            this.showMessage('Logout realizado com sucesso!', 'success');
                        }
                    } catch (error) {
                        console.error('‚ùå Erro no logout:', error);
                        this.showMessage('Erro no logout: ' + error.message, 'error');
                    }
                }

                // ========================================
                // GERENCIAMENTO DE SERVI√áOS
                // ========================================

                openServiceModal(serviceId = null) {
                    this.editingService = serviceId;
                    const modal = document.getElementById('service-modal');
                    const title = document.getElementById('service-modal-title');
                    const form = document.getElementById('service-form');
                    
                    if (serviceId) {
                        // Editando servi√ßo existente
                        const service = this.services.find(s => s.id === serviceId);
                        if (service) {
                            title.textContent = '‚úèÔ∏è Editar Servi√ßo';
                            document.getElementById('service-name').value = service.name;
                            document.getElementById('service-description').value = service.description || '';
                            document.getElementById('service-duration').value = service.duration_minutes;
                            document.getElementById('service-price').value = service.price;
                        }
                    } else {
                        // Adicionando novo servi√ßo
                        title.textContent = '‚ûï Adicionar Servi√ßo';
                        form.reset();
                        document.getElementById('service-duration').value = 60;
                        document.getElementById('service-description').value = ''; // Limpar descri√ß√£o
                    }
                    
                    modal.classList.remove('hidden');
                    modal.classList.add('flex');
                    
                    // Focar no campo nome ap√≥s um pequeno delay para garantir que o modal esteja vis√≠vel
                    setTimeout(() => {
                        document.getElementById('service-name').focus();
                    }, 100);
                }

                closeServiceModal() {
                    const modal = document.getElementById('service-modal');
                    modal.classList.add('hidden');
                    modal.classList.remove('flex');
                    this.editingService = null;
                }

                async handleSaveService(e) {
                    e.preventDefault();
                    
                    const name = document.getElementById('service-name').value.trim();
                    const description = document.getElementById('service-description').value.trim();
                    const duration = parseInt(document.getElementById('service-duration').value);
                    const price = parseFloat(document.getElementById('service-price').value);
                    const saveBtn = document.getElementById('save-service-btn');
                    
                    if (!name || !duration || !price) {
                        this.showMessage('Por favor, preencha todos os campos obrigat√≥rios', 'error');
                        return;
                    }

                    if (duration < 15) {
                        this.showMessage('A dura√ß√£o m√≠nima √© de 15 minutos', 'error');
                        return;
                    }

                    if (price <= 0) {
                        this.showMessage('O pre√ßo deve ser maior que zero', 'error');
                        return;
                    }

                    try {
                        saveBtn.textContent = 'Salvando...';
                        saveBtn.disabled = true;

                        // Garantir que o estabelecimento existe
                        const businessData = await this.ensureBusinessExists();

                        const serviceData = {
                            business_id: businessData.id,
                            name: name,
                            description: description,
                            duration_minutes: duration,
                            price: price,
                            active: true
                        };

                        if (this.editingService) {
                            // Atualizar servi√ßo existente
                            const { error } = await supabase
                                .from('services')
                                .update(serviceData)
                                .eq('id', this.editingService);

                            if (error) throw error;
                            this.showMessage('Servi√ßo atualizado com sucesso!', 'success');
                        } else {
                            // Criar novo servi√ßo
                            const { error } = await supabase
                                .from('services')
                                .insert([serviceData]);

                            if (error) throw error;
                            this.showMessage('Servi√ßo adicionado com sucesso!', 'success');
                        }

                        this.closeServiceModal();
                        await this.loadData();
                        this.render();

                    } catch (error) {
                        console.error('‚ùå Erro ao salvar servi√ßo:', error);
                        this.showMessage('Erro ao salvar servi√ßo: ' + error.message, 'error');
                    } finally {
                        saveBtn.textContent = 'üíæ Salvar Servi√ßo';
                        saveBtn.disabled = false;
                    }
                }

                editService(serviceId) {
                    this.openServiceModal(serviceId);
                }

                async toggleServiceStatus(serviceId) {
                    try {
                        const service = this.services.find(s => s.id === serviceId);
                        if (!service) return;

                        const { error } = await supabase
                            .from('services')
                            .update({ active: !service.active })
                            .eq('id', serviceId);

                        if (error) throw error;

                        this.showMessage(
                            `Servi√ßo ${service.active ? 'desativado' : 'ativado'} com sucesso!`, 
                            'success'
                        );

                        await this.loadData();
                        this.render();

                    } catch (error) {
                        console.error('‚ùå Erro ao alterar status do servi√ßo:', error);
                        this.showMessage('Erro ao alterar status: ' + error.message, 'error');
                    }
                }

                async deleteService(serviceId) {
                    const service = this.services.find(s => s.id === serviceId);
                    if (!service) return;

                    if (!confirm(`Tem certeza que deseja excluir o servi√ßo "${service.name}"?\n\nEsta a√ß√£o n√£o pode ser desfeita.`)) {
                        return;
                    }

                    try {
                        const { error } = await supabase
                            .from('services')
                            .delete()
                            .eq('id', serviceId);

                        if (error) throw error;

                        this.showMessage('Servi√ßo exclu√≠do com sucesso!', 'success');
                        await this.loadData();
                        this.render();

                    } catch (error) {
                        console.error('‚ùå Erro ao excluir servi√ßo:', error);
                        this.showMessage('Erro ao excluir servi√ßo: ' + error.message, 'error');
                    }
                }

                // ========================================
                // FUN√á√ÉO AUXILIAR PARA GARANTIR BUSINESS
                // ========================================

                async ensureBusinessExists() {
                    try {
                        // Verificar se o estabelecimento j√° existe
                        let { data: businessData } = await supabase
                            .from('businesses')
                            .select('id')
                            .eq('user_id', this.currentUser.id)
                            .single();

                        // Se n√£o existir, criar
                        if (!businessData) {
                            console.log('üè¢ Criando estabelecimento automaticamente...');
                            
                            const { data: newBusiness, error } = await supabase
                                .from('businesses')
                                .insert([{
                                    user_id: this.currentUser.id,
                                    name: this.currentUser.name || 'Minha Empresa',
                                    address: this.currentUser.address || '',
                                    phone: this.currentUser.phone || '',
                                    email: this.currentUser.email,
                                    active: true
                                }])
                                .select()
                                .single();

                            if (error) throw error;
                            businessData = newBusiness;
                            
                            // Atualizar cache
                            await this.loadData();
                        }

                        return businessData;
                    } catch (error) {
                        console.error('‚ùå Erro ao garantir estabelecimento:', error);
                        throw new Error(`N√£o foi poss√≠vel criar/encontrar estabelecimento: ${error.message}`);
                    }
                }

                // ========================================
                // PERSONALIZA√á√ÉO
                // ========================================

                openCustomizeModal() {
                    const modal = document.getElementById('customize-modal');
                    modal.classList.remove('hidden');
                    modal.classList.add('flex');
                }

                closeCustomizeModal() {
                    const modal = document.getElementById('customize-modal');
                    modal.classList.add('hidden');
                    modal.classList.remove('flex');
                }

                // ========================================
                // SISTEMA ADMINISTRATIVO
                // ========================================

                handleAdminLogin() {
                    const modal = document.getElementById('admin-login-modal');
                    
                    // Verificar se √© primeira configura√ß√£o
                    if (this.adminConfig.firstLogin) {
                        this.showAdminSetup();
                    } else {
                        this.showAdminLogin();
                    }
                    
                    modal.classList.remove('hidden');
                    modal.classList.add('flex');
                }

                showAdminSetup() {
                    document.getElementById('admin-modal-title').textContent = '‚öôÔ∏è Configura√ß√£o Inicial';
                    document.getElementById('admin-modal-subtitle').textContent = 'Configure suas credenciais de administrador';
                    document.getElementById('admin-info-text').textContent = 'Primeira configura√ß√£o do sistema';
                    
                    document.getElementById('admin-first-setup').style.display = 'block';
                    document.getElementById('admin-normal-login').style.display = 'none';
                    document.getElementById('admin-change-password').style.display = 'none';
                    
                    setTimeout(() => {
                        document.getElementById('admin-email-setup').focus();
                    }, 100);
                }

                showAdminLogin() {
                    document.getElementById('admin-modal-title').textContent = 'üëë Login Administrativo';
                    document.getElementById('admin-modal-subtitle').textContent = 'Acesso completo ao sistema';
                    document.getElementById('admin-info-text').textContent = `Admin configurado: ${this.adminConfig.email || 'Email n√£o configurado'}`;
                    
                    document.getElementById('admin-first-setup').style.display = 'none';
                    document.getElementById('admin-normal-login').style.display = 'block';
                    document.getElementById('admin-change-password').style.display = 'none';
                    
                    setTimeout(() => {
                        document.getElementById('admin-password').focus();
                    }, 100);
                }

                showAdminChangePassword() {
                    document.getElementById('admin-modal-title').textContent = 'üîê Alterar Senha';
                    document.getElementById('admin-modal-subtitle').textContent = 'Defina uma nova senha de administrador';
                    document.getElementById('admin-info-text').textContent = 'Altera√ß√£o de credenciais administrativas';
                    
                    document.getElementById('admin-first-setup').style.display = 'none';
                    document.getElementById('admin-normal-login').style.display = 'none';
                    document.getElementById('admin-change-password').style.display = 'block';
                    
                    setTimeout(() => {
                        document.getElementById('admin-current-password').focus();
                    }, 100);
                }

                closeAdminModal() {
                    const modal = document.getElementById('admin-login-modal');
                    modal.classList.add('hidden');
                    modal.classList.remove('flex');
                    
                    // Limpar todos os campos
                    document.getElementById('admin-password').value = '';
                    document.getElementById('admin-email-setup').value = '';
                    document.getElementById('admin-new-password').value = '';
                    document.getElementById('admin-confirm-password').value = '';
                    document.getElementById('admin-current-password').value = '';
                    document.getElementById('admin-new-password-change').value = '';
                    document.getElementById('admin-confirm-new-password').value = '';
                }

                async confirmAdminSetup() {
                    const email = document.getElementById('admin-email-setup').value.trim();
                    const newPassword = document.getElementById('admin-new-password').value;
                    const confirmPassword = document.getElementById('admin-confirm-password').value;
                    
                    if (!email || !newPassword || !confirmPassword) {
                        this.showMessage('Por favor, preencha todos os campos', 'error');
                        return;
                    }
                    
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(email)) {
                        this.showMessage('Por favor, digite um email v√°lido', 'error');
                        return;
                    }
                    
                    if (newPassword.length < 6) {
                        this.showMessage('A senha deve ter pelo menos 6 caracteres', 'error');
                        return;
                    }
                    
                    if (newPassword !== confirmPassword) {
                        this.showMessage('As senhas n√£o coincidem', 'error');
                        return;
                    }
                    
                    // Salvar configura√ß√µes
                    this.adminConfig.email = email;
                    this.adminConfig.password = newPassword;
                    this.adminConfig.firstLogin = false;
                    
                    localStorage.setItem('admin_email', email);
                    localStorage.setItem('admin_password', newPassword);
                    localStorage.setItem('admin_first_login', 'false');
                    
                    // Fazer login automaticamente
                    this.isAdmin = true;
                    this.currentUser = { name: 'Administrador', user_type: 'admin', email: email };
                    this.currentView = 'admin-dashboard';
                    this.closeAdminModal();
                    
                    await this.loadAdminData();
                    this.render();
                    this.showMessage('Administrador configurado e logado com sucesso!', 'success');
                }

                async confirmAdminLogin() {
                    const password = document.getElementById('admin-password').value;
                    
                    if (password === this.adminConfig.password) {
                        this.isAdmin = true;
                        this.currentUser = { 
                            name: 'Administrador', 
                            user_type: 'admin', 
                            email: this.adminConfig.email 
                        };
                        this.currentView = 'admin-dashboard';
                        this.closeAdminModal();
                        
                        await this.loadAdminData();
                        this.render();
                        this.showMessage('Login administrativo realizado com sucesso!', 'success');
                    } else {
                        this.showMessage('Senha de administrador incorreta!', 'error');
                        document.getElementById('admin-password').value = '';
                        document.getElementById('admin-password').focus();
                    }
                }

                async confirmAdminPasswordChange() {
                    const currentPassword = document.getElementById('admin-current-password').value;
                    const newPassword = document.getElementById('admin-new-password-change').value;
                    const confirmPassword = document.getElementById('admin-confirm-new-password').value;
                    
                    if (!currentPassword || !newPassword || !confirmPassword) {
                        this.showMessage('Por favor, preencha todos os campos', 'error');
                        return;
                    }
                    
                    if (currentPassword !== this.adminConfig.password) {
                        this.showMessage('Senha atual incorreta', 'error');
                        document.getElementById('admin-current-password').value = '';
                        document.getElementById('admin-current-password').focus();
                        return;
                    }
                    
                    if (newPassword.length < 6) {
                        this.showMessage('A nova senha deve ter pelo menos 6 caracteres', 'error');
                        return;
                    }
                    
                    if (newPassword !== confirmPassword) {
                        this.showMessage('As novas senhas n√£o coincidem', 'error');
                        return;
                    }
                    
                    if (newPassword === currentPassword) {
                        this.showMessage('A nova senha deve ser diferente da atual', 'error');
                        return;
                    }
                    
                    // Atualizar senha
                    this.adminConfig.password = newPassword;
                    localStorage.setItem('admin_password', newPassword);
                    
                    this.closeAdminModal();
                    this.showMessage('Senha de administrador alterada com sucesso!', 'success');
                }

                async loadAdminData() {
                    try {
                        console.log('üëë Carregando dados administrativos...');
                        
                        // Carregar todos os usu√°rios
                        const { data: allUsers } = await supabase
                            .from('users')
                            .select('*')
                            .order('created_at', { ascending: false });
                        this.allUsers = allUsers || [];
                        
                        // Carregar todos os estabelecimentos
                        const { data: allBusinesses } = await supabase
                            .from('businesses')
                            .select('*')
                            .order('created_at', { ascending: false });
                        this.businesses = allBusinesses || [];
                        
                        // Carregar todos os servi√ßos
                        const { data: allServices } = await supabase
                            .from('services')
                            .select('*')
                            .order('created_at', { ascending: false });
                        this.allServices = allServices || [];
                        
                        // Carregar todos os agendamentos
                        const { data: allAppointments } = await supabase
                            .from('appointments')
                            .select('*')
                            .order('created_at', { ascending: false });
                        this.allAppointments = allAppointments || [];
                        
                        console.log(`üëë Dados carregados: ${this.allUsers.length} usu√°rios, ${this.businesses.length} estabelecimentos, ${this.allServices.length} servi√ßos, ${this.allAppointments.length} agendamentos`);
                        
                    } catch (error) {
                        console.error('‚ùå Erro ao carregar dados administrativos:', error);
                        this.showMessage('Erro ao carregar dados administrativos: ' + error.message, 'error');
                    }
                }

                async toggleBusinessStatus(businessId) {
                    try {
                        const business = this.businesses.find(b => b.id === businessId);
                        if (!business) return;

                        const { error } = await supabase
                            .from('businesses')
                            .update({ active: !business.active })
                            .eq('id', businessId);

                        if (error) throw error;

                        this.showMessage(
                            `Estabelecimento ${business.active ? 'desativado' : 'ativado'} com sucesso!`, 
                            'success'
                        );

                        await this.loadAdminData();
                        this.render();

                    } catch (error) {
                        console.error('‚ùå Erro ao alterar status do estabelecimento:', error);
                        this.showMessage('Erro ao alterar status: ' + error.message, 'error');
                    }
                }

                viewBusinessDetails(businessId) {
                    const business = this.businesses.find(b => b.id === businessId);
                    const owner = this.allUsers.find(u => u.id === business?.user_id);
                    const businessServices = this.allServices.filter(s => s.business_id === businessId);
                    
                    if (!business) return;
                    
                    alert(`Detalhes do Estabelecimento:
                    
Nome: ${business.name}
Propriet√°rio: ${owner?.name || 'N/A'} (${owner?.email || 'N/A'})
Endere√ßo: ${business.address || 'N√£o informado'}
Telefone: ${business.phone || 'N√£o informado'}
Servi√ßos: ${businessServices.length}
Status: ${business.active ? 'Ativo' : 'Inativo'}
Criado em: ${new Date(business.created_at).toLocaleDateString('pt-BR')}`);
                }

                switchAdminTab(tabName) {
                    // Remover estado ativo de todas as abas
                    document.querySelectorAll('.tab-button').forEach(btn => {
                        btn.classList.remove('border-blue-500', 'text-blue-600');
                        btn.classList.add('text-gray-500');
                    });
                    
                    // Ocultar todo conte√∫do
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.add('hidden');
                    });
                    
                    // Ativar aba selecionada
                    const activeTab = document.getElementById(`tab-${tabName}`);
                    const activeContent = document.getElementById(`content-${tabName}`);
                    
                    if (activeTab && activeContent) {
                        activeTab.classList.add('border-blue-500', 'text-blue-600');
                        activeTab.classList.remove('text-gray-500');
                        activeContent.classList.remove('hidden');
                    }
                }

                // ========================================
                // SISTEMA DE AGENDAMENTO (CLIENTES)
                // ========================================

                openBookingModal(serviceId, businessId) {
                    this.selectedServiceId = serviceId;
                    this.selectedBusinessId = businessId;
                    
                    const service = this.services.find(s => s.id === serviceId);
                    const business = this.businesses.find(b => b.id === businessId);
                    
                    if (!service || !business) {
                        this.showMessage('Servi√ßo ou estabelecimento n√£o encontrado', 'error');
                        return;
                    }
                    
                    // Preencher informa√ß√µes do servi√ßo
                    const serviceInfo = document.getElementById('service-info');
                    serviceInfo.innerHTML = `
                        <h4 class="font-medium text-gray-900 mb-2">${service.name}</h4>
                        <p class="text-sm text-gray-600 mb-2">${business.name}</p>
                        <div class="flex items-center gap-4 text-sm text-gray-500">
                            <span>‚è±Ô∏è ${service.duration_minutes} min</span>
                            <span class="font-semibold text-green-600">R$ ${service.price}</span>
                        </div>
                        ${service.description ? `<p class="text-sm text-gray-600 mt-2">${service.description}</p>` : ''}
                    `;
                    
                    // Definir data m√≠nima como hoje
                    const today = new Date().toISOString().split('T')[0];
                    document.getElementById('booking-date').value = today;
                    document.getElementById('booking-date').min = today;
                    
                    const modal = document.getElementById('booking-modal');
                    modal.classList.remove('hidden');
                    modal.classList.add('flex');
                }

                closeBookingModal() {
                    const modal = document.getElementById('booking-modal');
                    modal.classList.add('hidden');
                    modal.classList.remove('flex');
                    
                    // Limpar formul√°rio
                    document.getElementById('booking-form').reset();
                    this.selectedServiceId = null;
                    this.selectedBusinessId = null;
                }

                async handleBooking(e) {
                    e.preventDefault();
                    
                    const date = document.getElementById('booking-date').value;
                    const time = document.getElementById('booking-time').value;
                    const notes = document.getElementById('booking-notes').value.trim();
                    const confirmBtn = document.getElementById('confirm-booking-btn');
                    
                    if (!date || !time) {
                        this.showMessage('Por favor, selecione data e hor√°rio', 'error');
                        return;
                    }
                    
                    if (!this.selectedServiceId || !this.selectedBusinessId) {
                        this.showMessage('Servi√ßo n√£o selecionado corretamente', 'error');
                        return;
                    }
                    
                    try {
                        confirmBtn.textContent = 'Agendando...';
                        confirmBtn.disabled = true;
                        
                        // Verificar se j√° existe agendamento no mesmo hor√°rio
                        const { data: existingAppointment } = await supabase
                            .from('appointments')
                            .select('*')
                            .eq('business_id', this.selectedBusinessId)
                            .eq('appointment_date', date)
                            .eq('appointment_time', time)
                            .neq('status', 'cancelled')
                            .single();
                        
                        if (existingAppointment) {
                            this.showMessage('Este hor√°rio j√° est√° ocupado. Escolha outro hor√°rio.', 'error');
                            return;
                        }
                        
                        // Criar agendamento
                        const { error } = await supabase
                            .from('appointments')
                            .insert([{
                                client_id: this.currentUser.id,
                                business_id: this.selectedBusinessId,
                                service_id: this.selectedServiceId,
                                appointment_date: date,
                                appointment_time: time,
                                status: 'pending',
                                notes: notes || null
                            }]);
                        
                        if (error) throw error;
                        
                        this.showMessage('Agendamento realizado com sucesso!', 'success');
                        this.closeBookingModal();
                        
                        // Recarregar dados
                        await this.loadData();
                        this.render();
                        
                    } catch (error) {
                        console.error('‚ùå Erro ao criar agendamento:', error);
                        this.showMessage('Erro ao criar agendamento: ' + error.message, 'error');
                    } finally {
                        confirmBtn.textContent = '‚úÖ Confirmar Agendamento';
                        confirmBtn.disabled = false;
                    }
                }

                async cancelAppointment(appointmentId) {
                    if (!confirm('Tem certeza que deseja cancelar este agendamento?')) {
                        return;
                    }
                    
                    try {
                        const { error } = await supabase
                            .from('appointments')
                            .update({ status: 'cancelled' })
                            .eq('id', appointmentId)
                            .eq('client_id', this.currentUser.id); // Seguran√ßa: s√≥ o dono pode cancelar
                        
                        if (error) throw error;
                        
                        this.showMessage('Agendamento cancelado com sucesso!', 'success');
                        
                        // Recarregar dados
                        await this.loadData();
                        this.render();
                        
                    } catch (error) {
                        console.error('‚ùå Erro ao cancelar agendamento:', error);
                        this.showMessage('Erro ao cancelar agendamento: ' + error.message, 'error');
                    }
                }

                showAllAppointments() {
                    // Modal simples para mostrar todos os agendamentos
                    const modal = document.createElement('div');
                    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                    modal.innerHTML = `
                        <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto">
                            <div class="flex items-center justify-between mb-6">
                                <h2 class="text-2xl font-bold text-gray-900">üìÖ Todos os Meus Agendamentos</h2>
                                <button id="close-all-appointments" class="text-gray-500 hover:text-gray-700">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            
                            <div class="space-y-4">
                                ${this.appointments.map(appointment => `
                                    <div class="border border-gray-200 rounded-lg p-4">
                                        <div class="flex items-start justify-between mb-3">
                                            <div class="flex-1">
                                                <h4 class="font-medium text-gray-900">${appointment.service?.name || 'Servi√ßo n√£o especificado'}</h4>
                                                <p class="text-sm text-gray-600">${appointment.business?.name || 'Estabelecimento n√£o especificado'}</p>
                                                ${appointment.business?.address ? `<p class="text-xs text-gray-500">üìç ${appointment.business.address}</p>` : ''}
                                            </div>
                                            <span class="inline-block px-2 py-1 text-xs rounded-full ${
                                                appointment.status === 'confirmed' ? 'bg-green-100 text-green-800' :
                                                appointment.status === 'pending' ? 'bg-yellow-100 text-yellow-800' :
                                                appointment.status === 'cancelled' ? 'bg-red-100 text-red-800' :
                                                'bg-gray-100 text-gray-800'
                                            }">
                                                ${appointment.status === 'confirmed' ? 'Confirmado' :
                                                appointment.status === 'pending' ? 'Pendente' :
                                                appointment.status === 'cancelled' ? 'Cancelado' : 'Conclu√≠do'}
                                            </span>
                                        </div>
                                        
                                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                                            <div>
                                                <span class="text-gray-500">üìÖ Data:</span>
                                                <span class="font-medium ml-1">${new Date(appointment.appointment_date).toLocaleDateString('pt-BR')}</span>
                                            </div>
                                            <div>
                                                <span class="text-gray-500">‚è∞ Hor√°rio:</span>
                                                <span class="font-medium ml-1">${appointment.appointment_time}</span>
                                            </div>
                                            ${appointment.service?.duration_minutes ? `
                                                <div>
                                                    <span class="text-gray-500">‚è±Ô∏è Dura√ß√£o:</span>
                                                    <span class="font-medium ml-1">${appointment.service.duration_minutes} min</span>
                                                </div>
                                            ` : ''}
                                            ${appointment.service?.price ? `
                                                <div>
                                                    <span class="text-gray-500">üí∞ Valor:</span>
                                                    <span class="font-medium ml-1 text-green-600">R$ ${appointment.service.price}</span>
                                                </div>
                                            ` : ''}
                                        </div>
                                        
                                        ${appointment.notes ? `
                                            <div class="mt-3 pt-3 border-t border-gray-200">
                                                <span class="text-xs text-gray-500">üìù Observa√ß√µes:</span>
                                                <p class="text-sm text-gray-700 mt-1">${appointment.notes}</p>
                                            </div>
                                        ` : ''}
                                        
                                        ${appointment.status === 'pending' ? `
                                            <div class="mt-3">
                                                <button
                                                    onclick="app.cancelAppointment('${appointment.id}'); this.closest('.fixed').remove();"
                                                    class="text-xs bg-red-100 text-red-700 px-3 py-1 rounded-lg hover:bg-red-200 transition duration-200"
                                                >
                                                    Cancelar Agendamento
                                                </button>
                                            </div>
                                        ` : ''}
                                    </div>
                                `).join('')}
                            </div>
                            
                            <div class="mt-6 text-center">
                                <button id="close-all-appointments-btn" class="bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700 transition duration-300">
                                    Fechar
                                </button>
                            </div>
                        </div>
                    `;
                    
                    document.body.appendChild(modal);
                    
                    // Event listeners para fechar
                    modal.querySelector('#close-all-appointments').addEventListener('click', () => modal.remove());
                    modal.querySelector('#close-all-appointments-btn').addEventListener('click', () => modal.remove());
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) modal.remove();
                    });
                }
            }
            
            // Inicializar aplica√ß√£o
            console.log('üöÄ Iniciando Beauty App...');
            window.app = new BeautyApp();
            
            // Tornar m√©todos dispon√≠veis globalmente para os bot√µes inline
            window.app.editService = window.app.editService.bind(window.app);
            window.app.toggleServiceStatus = window.app.toggleServiceStatus.bind(window.app);
            window.app.deleteService = window.app.deleteService.bind(window.app);
            window.app.openBookingModal = window.app.openBookingModal.bind(window.app);
            window.app.toggleBusinessStatus = window.app.toggleBusinessStatus.bind(window.app);
            window.app.viewBusinessDetails = window.app.viewBusinessDetails.bind(window.app);
            window.app.cancelAppointment = window.app.cancelAppointment.bind(window.app);
            window.app.showAllAppointments = window.app.showAllAppointments.bind(window.app);
        }
    </script>
</body>
</html>

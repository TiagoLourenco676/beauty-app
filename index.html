<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beauty App - Sistema de Agendamento</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        body { 
            margin: 0; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; 
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .error-details {
            background: #fee;
            border: 1px solid #fcc;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            font-family: monospace;
            font-size: 0.8rem;
            color: #c33;
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="min-h-screen bg-gradient-to-br from-pink-100 to-purple-100 flex items-center justify-center">
            <div class="text-center">
                <div class="loading mb-4"></div>
                <p>Carregando Beauty App...</p>
            </div>
        </div>
    </div>
    
    <script>
        console.log('üöÄ Iniciando Beauty App...');
        
        // ========================================
        // CONFIGURA√á√ÉO DO SUPABASE
        // ========================================
        
        // ‚úÖ CREDENCIAIS CONFIGURADAS
        const SUPABASE_URL = 'https://ueonkhdbuzujdfyhookt.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVlb25raGRidXp1amRmeWhvb2t0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk0MzI3ODQsImV4cCI6MjA2NTAwODc4NH0.3zX18Z-Gz3tZ4YQti0wuhtStxPIc8jN8m_lrz_W2ikE';
        
        // Verificar se as credenciais foram configuradas
        if (SUPABASE_ANON_KEY === 'SUA_CHAVE_ANON_CORRETA_AQUI') {
            showConfigurationError();
        } else if (typeof window.supabase === 'undefined') {
            console.error('‚ùå Supabase n√£o foi carregado!');
            showLibraryError();
        } else {
            initializeSupabase();
        }
        
        function showConfigurationError() {
            document.getElementById('root').innerHTML = `
                <div class="min-h-screen bg-orange-50 flex items-center justify-center p-4">
                    <div class="bg-white rounded-lg shadow-xl p-8 max-w-2xl">
                        <div class="text-6xl mb-4 text-center">‚öôÔ∏è</div>
                        <h1 class="text-2xl font-bold text-orange-600 mb-4 text-center">Configura√ß√£o Necess√°ria</h1>
                        <div class="space-y-4 text-sm">
                            <p class="text-gray-600">Para usar o Beauty App, voc√™ precisa:</p>
                            <div class="bg-gray-100 p-4 rounded-lg">
                                <h3 class="font-semibold mb-2">1. Criar as tabelas no Supabase:</h3>
                                <p>Execute o script SQL fornecido no SQL Editor do Supabase</p>
                            </div>
                            <div class="bg-gray-100 p-4 rounded-lg">
                                <h3 class="font-semibold mb-2">2. Configurar a chave API:</h3>
                                <p>Substitua <code>SUA_CHAVE_ANON_CORRETA_AQUI</code> pela sua chave anon do Supabase</p>
                            </div>
                            <div class="bg-gray-100 p-4 rounded-lg">
                                <h3 class="font-semibold mb-2">3. Configurar autentica√ß√£o:</h3>
                                <p>No painel do Supabase, v√° em Authentication > Settings e configure o email</p>
                            </div>
                        </div>
                        <button onclick="location.reload()" class="w-full mt-6 bg-orange-500 text-white px-4 py-2 rounded">
                            Recarregar ap√≥s configurar
                        </button>
                    </div>
                </div>
            `;
        }
        
        function showLibraryError() {
            document.getElementById('root').innerHTML = `
                <div class="min-h-screen bg-red-50 flex items-center justify-center p-4">
                    <div class="bg-white rounded-lg shadow-xl p-8 max-w-md text-center">
                        <div class="text-6xl mb-4">üìö</div>
                        <h1 class="text-2xl font-bold text-red-600 mb-4">Erro de Biblioteca</h1>
                        <p class="text-gray-600 mb-4">O Supabase n√£o foi carregado corretamente.</p>
                        <p class="text-sm text-gray-500 mb-4">Verifique sua conex√£o com a internet.</p>
                        <button onclick="location.reload()" class="bg-red-500 text-white px-4 py-2 rounded">
                            Tentar Novamente
                        </button>
                    </div>
                </div>
            `;
        }
        
        function showConnectionError(error) {
            document.getElementById('root').innerHTML = `
                <div class="min-h-screen bg-red-50 flex items-center justify-center p-4">
                    <div class="bg-white rounded-lg shadow-xl p-8 max-w-2xl">
                        <div class="text-6xl mb-4 text-center">‚ö†Ô∏è</div>
                        <h1 class="text-2xl font-bold text-red-600 mb-4 text-center">Erro de Conex√£o</h1>
                        <p class="text-gray-600 mb-4">N√£o foi poss√≠vel conectar ao banco de dados.</p>
                        
                        <div class="error-details">
                            <strong>Detalhes do erro:</strong><br>
                            ${error.message || 'Erro desconhecido'}
                        </div>
                        
                        <div class="space-y-2 text-sm text-gray-600 mb-4">
                            <p><strong>Poss√≠veis causas:</strong></p>
                            <ul class="list-disc list-inside space-y-1">
                                <li>URL do Supabase incorreta</li>
                                <li>Chave anon inv√°lida ou expirada</li>
                                <li>Projeto Supabase pausado</li>
                                <li>Problemas de rede</li>
                            </ul>
                        </div>
                        
                        <button onclick="location.reload()" class="bg-red-500 text-white px-4 py-2 rounded">
                            Tentar Novamente
                        </button>
                    </div>
                </div>
            `;
        }
        
        function initializeSupabase() {
            try {
                window.supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                console.log('‚úÖ Supabase conectado com sucesso!');
                testConnection();
            } catch (error) {
                console.error('‚ùå Erro ao inicializar Supabase:', error);
                showConnectionError(error);
            }
        }
        
        async function testConnection() {
            try {
                const { data, error } = await window.supabaseClient.auth.getSession();
                if (error) {
                    console.warn('‚ö†Ô∏è Aviso na sess√£o:', error.message);
                }
                console.log('üîó Teste de conex√£o OK');
                initApp();
            } catch (error) {
                console.error('‚ùå Erro no teste de conex√£o:', error);
                showConnectionError(error);
            }
        }

        // ========================================
        // BEAUTY APP
        // ========================================
        
        function initApp() {
            const supabase = window.supabaseClient;
            
            class BeautyApp {
                constructor() {
                    this.currentView = 'login';
                    this.currentUser = null;
                    this.userType = '';
                    this.loading = false;
                    this.pendingVerificationEmail = null;
                    
                    // Cache de dados
                    this.businesses = [];
                    this.services = [];
                    this.appointments = [];
                    
                    this.init();
                }
                
                async init() {
                    console.log('üöÄ Inicializando Beauty App...');
                    
                    try {
                        // Verificar se usu√°rio j√° est√° logado
                        const { data: { session }, error } = await supabase.auth.getSession();
                        if (error) {
                            console.error('Erro ao verificar sess√£o:', error);
                        }
                        
                        if (session?.user) {
                            console.log('üë§ Usu√°rio j√° logado:', session.user.email);
                            await this.loadUserData(session.user);
                            this.currentView = this.currentUser?.user_type === 'business' ? 'business-dashboard' : 'client-dashboard';
                        }
                        
                        // Escutar mudan√ßas de autentica√ß√£o
                        supabase.auth.onAuthStateChange(async (event, session) => {
                            console.log('üîÑ Auth state changed:', event);
                            if (event === 'SIGNED_IN') {
                                await this.loadUserData(session.user);
                                this.currentView = this.currentUser?.user_type === 'business' ? 'business-dashboard' : 'client-dashboard';
                                this.render();
                            } else if (event === 'SIGNED_OUT') {
                                this.currentUser = null;
                                this.currentView = 'login';
                                this.render();
                            }
                        });
                        
                        await this.loadData();
                        this.render();
                        
                    } catch (error) {
                        console.error('‚ùå Erro na inicializa√ß√£o:', error);
                        this.showMessage('Erro ao inicializar aplica√ß√£o: ' + error.message, 'error');
                        this.renderError(error);
                    }
                }
                
                renderError(error) {
                    const root = document.getElementById('root');
                    root.innerHTML = `
                        <div class="min-h-screen bg-red-50 flex items-center justify-center p-4">
                            <div class="bg-white rounded-lg shadow-xl p-8 max-w-2xl">
                                <div class="text-6xl mb-4 text-center">üí•</div>
                                <h1 class="text-2xl font-bold text-red-600 mb-4 text-center">Erro na Aplica√ß√£o</h1>
                                
                                <div class="error-details">
                                    <strong>Erro:</strong> ${error.message}<br>
                                    <strong>C√≥digo:</strong> ${error.code || 'N/A'}
                                </div>
                                
                                <button onclick="location.reload()" class="bg-red-500 text-white px-4 py-2 rounded">
                                    Recarregar
                                </button>
                            </div>
                        </div>
                    `;
                }
                
                async loadUserData(authUser) {
                    try {
                        const { data, error } = await supabase
                            .from('users')
                            .select('*')
                            .eq('id', authUser.id)
                            .single();
                        
                        if (error) {
                            if (error.code === 'PGRST116') {
                                console.log('üìù Criando registro de usu√°rio...');
                                await this.createUserRecord(authUser);
                                return;
                            }
                            throw error;
                        }
                        this.currentUser = data;
                        console.log('üë§ Usu√°rio carregado:', data);
                    } catch (error) {
                        console.error('‚ùå Erro ao carregar dados do usu√°rio:', error);
                        this.showMessage('Erro ao carregar perfil: ' + error.message, 'error');
                    }
                }
                
                async createUserRecord(authUser) {
                    try {
                        const userData = authUser.user_metadata || {};
                        const { data, error } = await supabase
                            .from('users')
                            .insert([{
                                id: authUser.id,
                                email: authUser.email,
                                user_type: userData.user_type || 'client',
                                name: userData.name || '',
                                phone: userData.phone || '',
                                address: userData.address || '',
                                email_verified: authUser.email_confirmed_at ? true : false
                            }])
                            .select()
                            .single();
                        
                        if (error) throw error;
                        this.currentUser = data;
                        console.log('üë§ Usu√°rio criado:', data);
                        
                        if (userData.user_type === 'business' && userData.name) {
                            await this.createBusinessRecord(data);
                        }
                        
                    } catch (error) {
                        console.error('‚ùå Erro ao criar registro do usu√°rio:', error);
                        this.showMessage('Erro ao criar perfil: ' + error.message, 'error');
                    }
                }
                
                async createBusinessRecord(user) {
                    try {
                        const { data, error } = await supabase
                            .from('businesses')
                            .insert([{
                                user_id: user.id,
                                name: user.name,
                                address: user.address || '',
                                phone: user.phone || '',
                                email: user.email
                            }])
                            .select()
                            .single();
                        
                        if (error) throw error;
                        console.log('üè¢ Estabelecimento criado:', data);
                    } catch (error) {
                        console.error('‚ùå Erro ao criar estabelecimento:', error);
                    }
                }
                
                async loadData() {
                    try {
                        const { data: businessData } = await supabase
                            .from('businesses')
                            .select('*')
                            .eq('active', true)
                            .order('name');
                        
                        this.businesses = businessData || [];
                        console.log(`üìç ${this.businesses.length} estabelecimentos carregados`);
                        
                        const { data: serviceData } = await supabase
                            .from('services')
                            .select('*')
                            .eq('active', true)
                            .order('name');
                        
                        this.services = serviceData || [];
                        console.log(`üíº ${this.services.length} servi√ßos carregados`);
                        
                        if (this.currentUser) {
                            await this.loadAppointments();
                        }
                    } catch (error) {
                        console.error('‚ùå Erro ao carregar dados:', error);
                        this.showMessage('Erro ao carregar dados: ' + error.message, 'warning');
                    }
                }
                
                async loadAppointments() {
                    try {
                        let query = supabase.from('appointments').select('*');
                        
                        if (this.currentUser.user_type === 'business') {
                            const { data: businessData } = await supabase
                                .from('businesses')
                                .select('id')
                                .eq('user_id', this.currentUser.id)
                                .single();
                            
                            if (businessData) {
                                query = query.eq('business_id', businessData.id);
                            }
                        } else {
                            query = query.eq('client_id', this.currentUser.id);
                        }
                        
                        const { data } = await query.order('appointment_date', { ascending: false });
                        this.appointments = data || [];
                        console.log(`üìÖ ${this.appointments.length} agendamentos carregados`);
                    } catch (error) {
                        console.error('‚ùå Erro ao carregar agendamentos:', error);
                    }
                }
                
                showMessage(message, type = 'info') {
                    const colors = {
                        success: 'bg-green-100 text-green-800 border-green-200',
                        error: 'bg-red-100 text-red-800 border-red-200',
                        info: 'bg-blue-100 text-blue-800 border-blue-200',
                        warning: 'bg-yellow-100 text-yellow-800 border-yellow-200'
                    };
                    
                    const messageDiv = document.createElement('div');
                    messageDiv.className = `fixed top-4 right-4 p-4 rounded-lg border ${colors[type]} z-50 fade-in max-w-md shadow-lg`;
                    messageDiv.innerHTML = `
                        <div class="flex items-start gap-2">
                            <span class="flex-1">${message}</span>
                            <button onclick="this.parentElement.parentElement.remove()" class="text-lg font-bold opacity-70 hover:opacity-100">√ó</button>
                        </div>
                    `;
                    document.body.appendChild(messageDiv);
                    
                    setTimeout(() => {
                        if (messageDiv.parentElement) {
                            messageDiv.remove();
                        }
                    }, 7000);
                }
                
                render() {
                    const root = document.getElementById('root');
                    
                    switch(this.currentView) {
                        case 'login':
                            root.innerHTML = this.renderLogin();
                            break;
                        case 'register':
                            root.innerHTML = this.renderRegister();
                            break;
                        case 'forgot-password':
                            root.innerHTML = this.renderForgotPassword();
                            break;
                        case 'email-sent':
                            root.innerHTML = this.renderEmailSent();
                            break;
                        case 'business-dashboard':
                            root.innerHTML = this.renderBusinessDashboard();
                            break;
                        case 'client-dashboard':
                            root.innerHTML = this.renderClientDashboard();
                            break;
                        default:
                            root.innerHTML = this.renderLogin();
                    }
                    
                    this.attachEvents();
                }
                
                renderLogin() {
                    return `
                        <div class="min-h-screen bg-gradient-to-br from-pink-100 to-purple-100 flex items-center justify-center p-4">
                            <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md fade-in">
                                <div class="text-center mb-8">
                                    <h1 class="text-3xl font-bold text-gray-800 mb-2">üíÑ Beauty App</h1>
                                    <p class="text-gray-600">Sistema de agendamento para sal√µes de beleza</p>
                                </div>

                                <div class="space-y-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                        <input
                                            id="email"
                                            type="email"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition duration-200"
                                            placeholder="seu@email.com"
                                        />
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                                        <input
                                            id="password"
                                            type="password"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition duration-200"
                                            placeholder="Sua senha"
                                        />
                                    </div>

                                    <button
                                        id="login-btn"
                                        class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition duration-300 transform hover:scale-105"
                                    >
                                        Entrar
                                    </button>
                                </div>

                                <div class="mt-6 text-center">
                                    <button
                                        id="forgot-password-btn"
                                        class="text-pink-600 hover:text-pink-700 font-medium text-sm transition duration-200"
                                    >
                                        Esqueceu sua senha?
                                    </button>
                                </div>

                                <div class="mt-6 text-center">
                                    <p class="text-gray-600 mb-4">N√£o tem uma conta?</p>
                                    <div class="space-y-3">
                                        <button
                                            id="register-client-btn"
                                            class="w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 transition duration-300 transform hover:scale-105"
                                        >
                                            üë§ Cadastrar como Cliente
                                        </button>
                                        <button
                                            id="register-business-btn"
                                            class="w-full bg-green-500 text-white py-2 rounded-lg hover:bg-green-600 transition duration-300 transform hover:scale-105"
                                        >
                                            üè¢ Cadastrar como Empresa
                                        </button>
                                    </div>
                                </div>

                                <div class="mt-6 text-center">
                                    <p class="text-xs text-gray-500">
                                        ‚úÖ Beauty App v3.0 - Gerenciamento Completo
                                    </p>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                renderRegister() {
                    return `
                        <div class="min-h-screen bg-gradient-to-br from-pink-100 to-purple-100 flex items-center justify-center p-4">
                            <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md fade-in">
                                <div class="text-center mb-8">
                                    <h1 class="text-3xl font-bold text-gray-800 mb-2">
                                        ${this.userType === 'business' ? 'üè¢ Cadastro de Empresa' : 'üë§ Cadastro de Cliente'}
                                    </h1>
                                    <p class="text-gray-600">Preencha os dados abaixo</p>
                                </div>

                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            ${this.userType === 'business' ? 'Nome da Empresa' : 'Nome Completo'}
                                        </label>
                                        <input
                                            id="reg-name"
                                            type="text"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition duration-200"
                                            placeholder="${this.userType === 'business' ? 'Sal√£o Beleza Total' : 'Jo√£o Silva'}"
                                        />
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                        <input
                                            id="reg-email"
                                            type="email"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition duration-200"
                                            placeholder="seu@email.com"
                                        />
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Telefone</label>
                                        <input
                                            id="reg-phone"
                                            type="tel"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition duration-200"
                                            placeholder="(48) 99999-9999"
                                        />
                                    </div>

                                    ${this.userType === 'business' ? `
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Endere√ßo</label>
                                        <input
                                            id="reg-address"
                                            type="text"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition duration-200"
                                            placeholder="Rua das Flores, 123"
                                        />
                                    </div>
                                    ` : ''}

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                                        <input
                                            id="reg-password"
                                            type="password"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition duration-200"
                                            minlength="6"
                                            placeholder="M√≠nimo 6 caracteres"
                                        />
                                        <p class="text-xs text-gray-500 mt-1">M√≠nimo 6 caracteres</p>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Confirmar Senha</label>
                                        <input
                                            id="reg-confirm-password"
                                            type="password"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition duration-200"
                                            placeholder="Digite a senha novamente"
                                        />
                                    </div>

                                    <button
                                        id="register-btn"
                                        class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition duration-300 transform hover:scale-105"
                                    >
                                        Cadastrar
                                    </button>
                                </div>

                                <div class="mt-6 text-center">
                                    <button
                                        id="back-to-login"
                                        class="text-pink-600 hover:text-pink-700 font-medium transition duration-200"
                                    >
                                        Voltar ao Login
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                renderForgotPassword() {
                    return `
                        <div class="min-h-screen bg-gradient-to-br from-pink-100 to-purple-100 flex items-center justify-center p-4">
                            <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md fade-in">
                                <div class="text-center mb-8">
                                    <h1 class="text-3xl font-bold text-gray-800 mb-2">üîë Recuperar Senha</h1>
                                    <p class="text-gray-600">Digite seu email para receber as instru√ß√µes</p>
                                </div>

                                <div class="space-y-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                        <input
                                            id="forgot-email"
                                            type="email"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition duration-200"
                                            placeholder="seu@email.com"
                                        />
                                    </div>

                                    <button
                                        id="send-reset-btn"
                                        class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition duration-300 transform hover:scale-105"
                                    >
                                        Enviar Instru√ß√µes
                                    </button>
                                </div>

                                <div class="mt-6 text-center">
                                    <button
                                        id="back-to-login-forgot"
                                        class="text-pink-600 hover:text-pink-700 font-medium transition duration-200"
                                    >
                                        Voltar ao Login
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                renderEmailSent() {
                    return `
                        <div class="min-h-screen bg-gradient-to-br from-pink-100 to-purple-100 flex items-center justify-center p-4">
                            <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md fade-in text-center">
                                <div class="text-6xl mb-4">üìß</div>
                                <h1 class="text-3xl font-bold text-gray-800 mb-2">Email Enviado!</h1>
                                <p class="text-gray-600 mb-6">
                                    Verifique sua caixa de entrada${this.pendingVerificationEmail ? ` (${this.pendingVerificationEmail})` : ''} 
                                    e clique no link para verificar sua conta.
                                </p>
                                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
                                    <p class="text-sm text-yellow-800">
                                        üí° <strong>Dica:</strong> N√£o encontrou o email? Verifique a pasta de spam.
                                    </p>
                                </div>
                                <button
                                    id="back-to-login-email"
                                    class="bg-pink-500 text-white px-6 py-3 rounded-lg hover:bg-pink-600 transition duration-300 transform hover:scale-105"
                                >
                                    Voltar ao Login
                                </button>
                            </div>
                        </div>
                    `;
                }
                
                renderBusinessDashboard() {
                    return `
                        <div class="min-h-screen bg-gray-50">
                            <!-- Header -->
                            <header class="bg-white shadow-sm border-b">
                                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                                    <div class="flex justify-between items-center py-4">
                                        <div class="flex items-center gap-3">
                                            <div class="w-10 h-10 bg-gradient-to-r from-pink-500 to-purple-600 rounded-lg flex items-center justify-center">
                                                <span class="text-white font-bold">üíÑ</span>
                                            </div>
                                            <div>
                                                <h1 class="text-2xl font-bold text-gray-900">Dashboard - ${this.currentUser?.name || 'Empresa'}</h1>
                                                <p class="text-sm text-gray-500">Gerencie seus servi√ßos e agendamentos</p>
                                            </div>
                                        </div>
                                        <div class="flex items-center gap-3">
                                            <button
                                                id="customize-btn"
                                                class="bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition duration-300 flex items-center gap-2"
                                            >
                                                üé® Personalizar
                                            </button>
                                            <button
                                                id="logout-btn"
                                                class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition duration-300"
                                            >
                                                Sair
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </header>

                            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                                <!-- Cards de Status -->
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                                    <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg shadow p-6 text-white">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <p class="text-blue-100">Estabelecimentos</p>
                                                <p class="text-3xl font-bold">${this.businesses.length}</p>
                                            </div>
                                            <div class="text-4xl opacity-80">üè¢</div>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-lg shadow p-6 text-white">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <p class="text-green-100">Servi√ßos</p>
                                                <p class="text-3xl font-bold">${this.services.length}</p>
                                            </div>
                                            <div class="text-4xl opacity-80">üíº</div>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-lg shadow p-6 text-white">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <p class="text-purple-100">Agendamentos</p>
                                                <p class="text-3xl font-bold">${this.appointments.length}</p>
                                            </div>
                                            <div class="text-4xl opacity-80">üìÖ</div>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-gradient-to-r from-yellow-500 to-orange-500 rounded-lg shadow p-6 text-white">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <p class="text-yellow-100">Receita</p>
                                                <p class="text-3xl font-bold">R$ 0</p>
                                            </div>
                                            <div class="text-4xl opacity-80">üí∞</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Se√ß√£o Principal -->
                                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                                    <!-- Gerenciamento de Servi√ßos -->
                                    <div class="lg:col-span-2">
                                        <div class="bg-white rounded-lg shadow">
                                            <div class="p-6 border-b border-gray-200">
                                                <div class="flex items-center justify-between">
                                                    <h2 class="text-xl font-semibold text-gray-900">üíº Meus Servi√ßos</h2>
                                                    <button
                                                        id="add-service-btn"
                                                        class="bg-gradient-to-r from-pink-500 to-purple-600 text-white px-4 py-2 rounded-lg hover:from-pink-600 hover:to-purple-700 transition duration-300 flex items-center gap-2"
                                                    >
                                                        ‚ûï Adicionar Servi√ßo
                                                    </button>
                                                </div>
                                            </div>
                                            
                                            <div class="p-6">
                                                ${this.services.length > 0 ? `
                                                    <div class="space-y-4">
                                                        ${this.services.map(service => `
                                                            <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition duration-200">
                                                                <div class="flex items-center justify-between">
                                                                    <div class="flex-1">
                                                                        <h3 class="text-lg font-medium text-gray-900">${service.name}</h3>
                                                                        <p class="text-gray-600 text-sm mt-1">${service.description || 'Sem descri√ß√£o'}</p>
                                                                        <div class="flex items-center gap-4 mt-2">
                                                                            <span class="text-sm text-gray-500">‚è±Ô∏è ${service.duration_minutes} min</span>
                                                                            <span class="text-lg font-semibold text-green-600">R$ ${service.price}</span>
                                                                            <span class="text-xs px-2 py-1 bg-green-100 text-green-800 rounded-full">
                                                                                ${service.active ? 'Ativo' : 'Inativo'}
                                                                            </span>
                                                                        </div>
                                                                    </div>
                                                                    <div class="flex items-center gap-2">
                                                                        <button
                                                                            onclick="app.editService('${service.id}')"
                                                                            class="text-blue-600 hover:text-blue-800 p-2 rounded-lg hover:bg-blue-50 transition duration-200"
                                                                            title="Editar"
                                                                        >
                                                                            ‚úèÔ∏è
                                                                        </button>
                                                                        <button
                                                                            onclick="app.toggleServiceStatus('${service.id}')"
                                                                            class="text-gray-600 hover:text-gray-800 p-2 rounded-lg hover:bg-gray-50 transition duration-200"
                                                                            title="${service.active ? 'Desativar' : 'Ativar'}"
                                                                        >
                                                                            ${service.active ? 'üö´' : '‚úÖ'}
                                                                        </button>
                                                                        <button
                                                                            onclick="app.deleteService('${service.id}')"
                                                                            class="text-red-600 hover:text-red-800 p-2 rounded-lg hover:bg-red-50 transition duration-200"
                                                                            title="Excluir"
                                                                        >
                                                                            üóëÔ∏è
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        `).join('')}
                                                    </div>
                                                ` : `
                                                    <div class="text-center py-12">
                                                        <div class="text-6xl mb-4">üíº</div>
                                                        <h3 class="text-lg font-medium text-gray-900 mb-2">Nenhum servi√ßo cadastrado</h3>
                                                        <p class="text-gray-600 mb-6">Comece adicionando seus primeiros servi√ßos para que os clientes possam agendar.</p>
                                                        <button
                                                            id="add-first-service-btn"
                                                            class="bg-gradient-to-r from-pink-500 to-purple-600 text-white px-6 py-3 rounded-lg hover:from-pink-600 hover:to-purple-700 transition duration-300"
                                                        >
                                                            ‚ûï Adicionar Primeiro Servi√ßo
                                                        </button>
                                                    </div>
                                                `}
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Sidebar -->
                                    <div class="space-y-6">
                                        <!-- Agendamentos Recentes -->
                                        <div class="bg-white rounded-lg shadow">
                                            <div class="p-6 border-b border-gray-200">
                                                <h3 class="text-lg font-semibold text-gray-900">üìÖ Pr√≥ximos Agendamentos</h3>
                                            </div>
                                            <div class="p-6">
                                                ${this.appointments.length > 0 ? `
                                                    <div class="space-y-3">
                                                        ${this.appointments.slice(0, 3).map(appointment => `
                                                            <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                                                                <div class="w-2 h-8 bg-blue-500 rounded"></div>
                                                                <div class="flex-1">
                                                                    <p class="font-medium text-gray-900">${appointment.client?.name || 'Cliente'}</p>
                                                                    <p class="text-sm text-gray-600">${appointment.service?.name || 'Servi√ßo'}</p>
                                                                    <p class="text-xs text-gray-500">${appointment.appointment_date} √†s ${appointment.appointment_time}</p>
                                                                </div>
                                                            </div>
                                                        `).join('')}
                                                    </div>
                                                ` : `
                                                    <p class="text-gray-600 text-center py-4">Nenhum agendamento hoje</p>
                                                `}
                                            </div>
                                        </div>

                                        <!-- Estat√≠sticas R√°pidas -->
                                        <div class="bg-white rounded-lg shadow">
                                            <div class="p-6 border-b border-gray-200">
                                                <h3 class="text-lg font-semibold text-gray-900">üìä Status do Sistema</h3>
                                            </div>
                                            <div class="p-6 space-y-4">
                                                <div class="flex items-center justify-between">
                                                    <span class="text-gray-600">Banco de Dados</span>
                                                    <span class="text-green-600 font-medium">‚úÖ Online</span>
                                                </div>
                                                <div class="flex items-center justify-between">
                                                    <span class="text-gray-600">Autentica√ß√£o</span>
                                                    <span class="text-green-600 font-medium">‚úÖ Ativo</span>
                                                </div>
                                                <div class="flex items-center justify-between">
                                                    <span class="text-gray-600">Seguran√ßa</span>
                                                    <span class="text-green-600 font-medium">üîí RLS Ativo</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Modal para Adicionar/Editar Servi√ßo -->
                            <div id="service-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
                                <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md mx-4">
                                    <div class="flex items-center justify-between mb-6">
                                        <h2 id="service-modal-title" class="text-2xl font-bold text-gray-900">‚ûï Adicionar Servi√ßo</h2>
                                        <button id="close-service-modal" class="text-gray-500 hover:text-gray-700">
                                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                            </svg>
                                        </button>
                                    </div>

                                    <form id="service-form" class="space-y-6">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Nome do Servi√ßo</label>
                                            <input
                                                id="service-name"
                                                type="text"
                                                required
                                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                                placeholder="Ex: Corte Feminino"
                                            />
                                        </div>

                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Descri√ß√£o</label>
                                            <textarea
                                                id="service-description"
                                                rows="3"
                                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                                placeholder="Descreva o servi√ßo..."
                                            ></textarea>
                                        </div>

                                        <div class="grid grid-cols-2 gap-4">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-2">Dura√ß√£o (min)</label>
                                                <input
                                                    id="service-duration"
                                                    type="number"
                                                    required
                                                    min="15"
                                                    step="15"
                                                    value="60"
                                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                                />
                                            </div>

                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-2">Pre√ßo (R$)</label>
                                                <input
                                                    id="service-price"
                                                    type="number"
                                                    required
                                                    min="0"
                                                    step="0.01"
                                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                                    placeholder="0.00"
                                                />
                                            </div>
                                        </div>

                                        <div class="flex items-center gap-4 pt-4">
                                            <button
                                                type="submit"
                                                id="save-service-btn"
                                                class="flex-1 bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition duration-300"
                                            >
                                                üíæ Salvar Servi√ßo
                                            </button>
                                            <button
                                                type="button"
                                                id="cancel-service-btn"
                                                class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition duration-300"
                                            >
                                                Cancelar
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>

                            <!-- Modal de Personaliza√ß√£o -->
                            <div id="customize-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
                                <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-lg mx-4">
                                    <div class="flex items-center justify-between mb-6">
                                        <h2 class="text-2xl font-bold text-gray-900">üé® Personalizar Empresa</h2>
                                        <button id="close-customize-modal" class="text-gray-500 hover:text-gray-700">
                                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                            </svg>
                                        </button>
                                    </div>

                                    <div class="space-y-6">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Logo da Empresa</label>
                                            <div class="flex items-center gap-4">
                                                <div class="w-16 h-16 bg-gradient-to-r from-pink-500 to-purple-600 rounded-lg flex items-center justify-center">
                                                    <span class="text-white text-2xl">üíÑ</span>
                                                </div>
                                                <button class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition duration-300">
                                                    üì∏ Alterar Logo
                                                </button>
                                            </div>
                                        </div>

                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Cor Principal</label>
                                            <div class="grid grid-cols-6 gap-3">
                                                <button class="w-10 h-10 bg-pink-500 rounded-lg ring-2 ring-pink-300"></button>
                                                <button class="w-10 h-10 bg-purple-500 rounded-lg"></button>
                                                <button class="w-10 h-10 bg-blue-500 rounded-lg"></button>
                                                <button class="w-10 h-10 bg-green-500 rounded-lg"></button>
                                                <button class="w-10 h-10 bg-red-500 rounded-lg"></button>
                                                <button class="w-10 h-10 bg-yellow-500 rounded-lg"></button>
                                            </div>
                                        </div>

                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Tema</label>
                                            <div class="grid grid-cols-2 gap-4">
                                                <button class="p-4 border-2 border-pink-300 rounded-lg text-left">
                                                    <div class="font-medium">üå∏ Feminino</div>
                                                    <div class="text-sm text-gray-600">Rosa e roxo</div>
                                                </button>
                                                <button class="p-4 border-2 border-gray-200 rounded-lg text-left">
                                                    <div class="font-medium">‚ö´ Moderno</div>
                                                    <div class="text-sm text-gray-600">Preto e branco</div>
                                                </button>
                                            </div>
                                        </div>

                                        <div class="flex gap-4 pt-4">
                                            <button class="flex-1 bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition duration-300">
                                                üíæ Salvar Personaliza√ß√£o
                                            </button>
                                            <button id="cancel-customize-btn" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition duration-300">
                                                Cancelar
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                renderClientDashboard() {
                    return `
                        <div class="min-h-screen bg-gray-50">
                            <header class="bg-white shadow-sm border-b">
                                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                                    <div class="flex justify-between items-center py-4">
                                        <h1 class="text-2xl font-bold text-gray-900">üë§ Ol√°, ${this.currentUser?.name || 'Cliente'}!</h1>
                                        <button
                                            id="logout-btn"
                                            class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition duration-300"
                                        >
                                            Sair
                                        </button>
                                    </div>
                                </div>
                            </header>

                            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    <div class="bg-white rounded-lg shadow p-6">
                                        <h2 class="text-xl font-semibold text-gray-900 mb-4">üéâ Bem-vindo!</h2>
                                        <p class="text-gray-600 mb-4">
                                            Seu cadastro foi realizado com sucesso no Beauty App.
                                        </p>
                                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                                            <p class="text-green-800">
                                                ‚úÖ Conta verificada e ativa
                                            </p>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-white rounded-lg shadow p-6">
                                        <h2 class="text-xl font-semibold text-gray-900 mb-4">üìç Estabelecimentos Dispon√≠veis</h2>
                                        ${this.businesses.length > 0 ? `
                                            <div class="space-y-3">
                                                ${this.businesses.slice(0, 3).map(business => `
                                                    <div class="border border-gray-200 rounded-lg p-3">
                                                        <h3 class="font-medium text-gray-800">${business.name}</h3>
                                                        <p class="text-sm text-gray-600">${business.address}</p>
                                                    </div>
                                                `).join('')}
                                            </div>
                                        ` : `
                                            <div class="text-center py-8 text-gray-500">
                                                <p>Ainda n√£o h√° estabelecimentos cadastrados</p>
                                            </div>
                                        `}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                attachEvents() {
                    // Login
                    const loginBtn = document.getElementById('login-btn');
                    if (loginBtn) {
                        loginBtn.addEventListener('click', () => this.handleLogin());
                    }
                    
                    // Register navigation
                    const registerClientBtn = document.getElementById('register-client-btn');
                    if (registerClientBtn) {
                        registerClientBtn.addEventListener('click', () => {
                            this.userType = 'client';
                            this.currentView = 'register';
                            this.render();
                        });
                    }
                    
                    const registerBusinessBtn = document.getElementById('register-business-btn');
                    if (registerBusinessBtn) {
                        registerBusinessBtn.addEventListener('click', () => {
                            this.userType = 'business';
                            this.currentView = 'register';
                            this.render();
                        });
                    }
                    
                    // Register
                    const registerBtn = document.getElementById('register-btn');
                    if (registerBtn) {
                        registerBtn.addEventListener('click', () => this.handleRegister());
                    }
                    
                    // Back to login
                    const backToLogin = document.getElementById('back-to-login');
                    if (backToLogin) {
                        backToLogin.addEventListener('click', () => {
                            this.currentView = 'login';
                            this.render();
                        });
                    }
                    
                    const backToLoginForgot = document.getElementById('back-to-login-forgot');
                    if (backToLoginForgot) {
                        backToLoginForgot.addEventListener('click', () => {
                            this.currentView = 'login';
                            this.render();
                        });
                    }
                    
                    const backToLoginEmail = document.getElementById('back-to-login-email');
                    if (backToLoginEmail) {
                        backToLoginEmail.addEventListener('click', () => {
                            this.currentView = 'login';
                            this.render();
                        });
                    }
                    
                    // Forgot password
                    const forgotPasswordBtn = document.getElementById('forgot-password-btn');
                    if (forgotPasswordBtn) {
                        forgotPasswordBtn.addEventListener('click', () => {
                            this.currentView = 'forgot-password';
                            this.render();
                        });
                    }
                    
                    const sendResetBtn = document.getElementById('send-reset-btn');
                    if (sendResetBtn) {
                        sendResetBtn.addEventListener('click', () => this.handleForgotPassword());
                    }
                    
                    // Logout
                    const logoutBtn = document.getElementById('logout-btn');
                    if (logoutBtn) {
                        logoutBtn.addEventListener('click', () => this.handleLogout());
                    }

                    // Bot√µes de Servi√ßos
                    const addServiceBtn = document.getElementById('add-service-btn');
                    const addFirstServiceBtn = document.getElementById('add-first-service-btn');
                    if (addServiceBtn) {
                        addServiceBtn.addEventListener('click', () => this.openServiceModal());
                    }
                    if (addFirstServiceBtn) {
                        addFirstServiceBtn.addEventListener('click', () => this.openServiceModal());
                    }

                    // Modal de Servi√ßos
                    const serviceModal = document.getElementById('service-modal');
                    const closeServiceModal = document.getElementById('close-service-modal');
                    const cancelServiceBtn = document.getElementById('cancel-service-btn');
                    const serviceForm = document.getElementById('service-form');

                    if (closeServiceModal) {
                        closeServiceModal.addEventListener('click', () => this.closeServiceModal());
                    }
                    if (cancelServiceBtn) {
                        cancelServiceBtn.addEventListener('click', () => this.closeServiceModal());
                    }
                    if (serviceForm) {
                        serviceForm.addEventListener('submit', (e) => this.handleSaveService(e));
                    }
                    if (serviceModal) {
                        serviceModal.addEventListener('click', (e) => {
                            if (e.target === serviceModal) {
                                this.closeServiceModal();
                            }
                        });
                    }

                    // Bot√£o de Personaliza√ß√£o
                    const customizeBtn = document.getElementById('customize-btn');
                    if (customizeBtn) {
                        customizeBtn.addEventListener('click', () => this.openCustomizeModal());
                    }

                    // Modal de Personaliza√ß√£o
                    const customizeModal = document.getElementById('customize-modal');
                    const closeCustomizeModal = document.getElementById('close-customize-modal');
                    const cancelCustomizeBtn = document.getElementById('cancel-customize-btn');

                    if (closeCustomizeModal) {
                        closeCustomizeModal.addEventListener('click', () => this.closeCustomizeModal());
                    }
                    if (cancelCustomizeBtn) {
                        cancelCustomizeBtn.addEventListener('click', () => this.closeCustomizeModal());
                    }
                    if (customizeModal) {
                        customizeModal.addEventListener('click', (e) => {
                            if (e.target === customizeModal) {
                                this.closeCustomizeModal();
                            }
                        });
                    }
                    
                    // Enter key support
                    document.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter' && !this.loading) {
                            if (this.currentView === 'login') {
                                this.handleLogin();
                            } else if (this.currentView === 'register') {
                                this.handleRegister();
                            } else if (this.currentView === 'forgot-password') {
                                this.handleForgotPassword();
                            }
                        }
                    });

                    // ESC key support para modals
                    document.addEventListener('keydown', (e) => {
                        if (e.key === 'Escape') {
                            this.closeServiceModal();
                            this.closeCustomizeModal();
                        }
                    });
                }
                
                async handleLogin() {
                    const email = document.getElementById('email').value.trim();
                    const password = document.getElementById('password').value;
                    const loginBtn = document.getElementById('login-btn');
                    
                    if (!email || !password) {
                        this.showMessage('Por favor, preencha email e senha', 'error');
                        return;
                    }
                    
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(email)) {
                        this.showMessage('Por favor, digite um email v√°lido', 'error');
                        return;
                    }
                    
                    try {
                        loginBtn.textContent = 'Entrando...';
                        loginBtn.disabled = true;
                        
                        console.log('üîê Tentando login para:', email);
                        const { data, error } = await supabase.auth.signInWithPassword({
                            email: email,
                            password: password
                        });
                        
                        if (error) throw error;
                        
                        console.log('‚úÖ Login realizado:', data);
                        this.showMessage('Login realizado com sucesso!', 'success');
                        
                    } catch (error) {
                        console.error('‚ùå Erro no login:', error);
                        
                        let errorMessage = 'Erro no login: ';
                        if (error.message.includes('Invalid login credentials')) {
                            errorMessage = 'Email ou senha incorretos';
                        } else if (error.message.includes('Email not confirmed')) {
                            errorMessage = 'Por favor, confirme seu email antes de fazer login';
                        } else {
                            errorMessage = 'Erro no login: ' + error.message;
                        }
                        
                        this.showMessage(errorMessage, 'error');
                    } finally {
                        loginBtn.textContent = 'Entrar';
                        loginBtn.disabled = false;
                    }
                }
                
                async handleRegister() {
                    const name = document.getElementById('reg-name').value.trim();
                    const email = document.getElementById('reg-email').value.trim();
                    const phone = document.getElementById('reg-phone').value.trim();
                    const password = document.getElementById('reg-password').value;
                    const confirmPassword = document.getElementById('reg-confirm-password').value;
                    const address = document.getElementById('reg-address')?.value.trim() || '';
                    const registerBtn = document.getElementById('register-btn');
                    
                    if (!name || !email || !phone || !password || !confirmPassword) {
                        this.showMessage('Por favor, preencha todos os campos obrigat√≥rios', 'error');
                        return;
                    }
                    
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(email)) {
                        this.showMessage('Por favor, digite um email v√°lido', 'error');
                        return;
                    }
                    
                    if (password.length < 6) {
                        this.showMessage('A senha deve ter pelo menos 6 caracteres', 'error');
                        return;
                    }
                    
                    if (password !== confirmPassword) {
                        this.showMessage('As senhas n√£o coincidem!', 'error');
                        return;
                    }
                    
                    if (this.userType === 'business' && !address) {
                        this.showMessage('O endere√ßo √© obrigat√≥rio para empresas', 'error');
                        return;
                    }
                    
                    try {
                        registerBtn.textContent = 'Cadastrando...';
                        registerBtn.disabled = true;
                        
                        console.log('üìù Registrando usu√°rio:', this.userType);
                        const { data, error } = await supabase.auth.signUp({
                            email: email,
                            password: password,
                            options: {
                                data: {
                                    name: name,
                                    user_type: this.userType,
                                    phone: phone,
                                    address: address
                                }
                            }
                        });
                        
                        if (error) throw error;
                        
                        console.log('‚úÖ Usu√°rio registrado:', data);
                        this.pendingVerificationEmail = email;
                        this.currentView = 'email-sent';
                        this.render();
                        this.showMessage('Cadastro realizado! Verifique seu email.', 'success');
                        
                    } catch (error) {
                        console.error('‚ùå Erro no cadastro:', error);
                        
                        let errorMessage = 'Erro no cadastro: ';
                        if (error.message.includes('already registered')) {
                            errorMessage = 'Este email j√° est√° cadastrado';
                        } else {
                            errorMessage = 'Erro no cadastro: ' + error.message;
                        }
                        
                        this.showMessage(errorMessage, 'error');
                    } finally {
                        registerBtn.textContent = 'Cadastrar';
                        registerBtn.disabled = false;
                    }
                }
                
                async handleForgotPassword() {
                    const email = document.getElementById('forgot-email').value.trim();
                    const sendResetBtn = document.getElementById('send-reset-btn');
                    
                    if (!email) {
                        this.showMessage('Por favor, digite seu email', 'error');
                        return;
                    }
                    
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(email)) {
                        this.showMessage('Por favor, digite um email v√°lido', 'error');
                        return;
                    }
                    
                    try {
                        sendResetBtn.textContent = 'Enviando...';
                        sendResetBtn.disabled = true;
                        
                        console.log('üîÑ Enviando email de recupera√ß√£o para:', email);
                        const { error } = await supabase.auth.resetPasswordForEmail(email, {
                            redirectTo: window.location.origin + window.location.pathname
                        });
                        
                        if (error) throw error;
                        
                        this.pendingVerificationEmail = email;
                        this.currentView = 'email-sent';
                        this.render();
                        this.showMessage('Email de recupera√ß√£o enviado!', 'success');
                    } catch (error) {
                        console.error('‚ùå Erro ao enviar email:', error);
                        this.showMessage('Erro ao enviar email: ' + error.message, 'error');
                    } finally {
                        sendResetBtn.textContent = 'Enviar Instru√ß√µes';
                        sendResetBtn.disabled = false;
                    }
                }
                
                async handleLogout() {
                    try {
                        const { error } = await supabase.auth.signOut();
                        if (error) throw error;
                        
                        this.currentUser = null;
                        this.currentView = 'login';
                        this.render();
                        this.showMessage('Logout realizado com sucesso!', 'success');
                    } catch (error) {
                        console.error('‚ùå Erro no logout:', error);
                        this.showMessage('Erro no logout: ' + error.message, 'error');
                    }
                }

                // ========================================
                // GERENCIAMENTO DE SERVI√áOS
                // ========================================

                openServiceModal(serviceId = null) {
                    this.editingService = serviceId;
                    const modal = document.getElementById('service-modal');
                    const title = document.getElementById('service-modal-title');
                    const form = document.getElementById('service-form');
                    
                    if (serviceId) {
                        // Editando servi√ßo existente
                        const service = this.services.find(s => s.id === serviceId);
                        if (service) {
                            title.textContent = '‚úèÔ∏è Editar Servi√ßo';
                            document.getElementById('service-name').value = service.name;
                            document.getElementById('service-description').value = service.description || '';
                            document.getElementById('service-duration').value = service.duration_minutes;
                            document.getElementById('service-price').value = service.price;
                        }
                    } else {
                        // Adicionando novo servi√ßo
                        title.textContent = '‚ûï Adicionar Servi√ßo';
                        form.reset();
                        document.getElementById('service-duration').value = 60;
                    }
                    
                    modal.classList.remove('hidden');
                    modal.classList.add('flex');
                    document.getElementById('service-name').focus();
                }

                closeServiceModal() {
                    const modal = document.getElementById('service-modal');
                    modal.classList.add('hidden');
                    modal.classList.remove('flex');
                    this.editingService = null;
                }

                async handleSaveService(e) {
                    e.preventDefault();
                    
                    const name = document.getElementById('service-name').value.trim();
                    const description = document.getElementById('service-description').value.trim();
                    const duration = parseInt(document.getElementById('service-duration').value);
                    const price = parseFloat(document.getElementById('service-price').value);
                    const saveBtn = document.getElementById('save-service-btn');
                    
                    if (!name || !duration || !price) {
                        this.showMessage('Por favor, preencha todos os campos obrigat√≥rios', 'error');
                        return;
                    }

                    if (duration < 15) {
                        this.showMessage('A dura√ß√£o m√≠nima √© de 15 minutos', 'error');
                        return;
                    }

                    if (price <= 0) {
                        this.showMessage('O pre√ßo deve ser maior que zero', 'error');
                        return;
                    }

                    try {
                        saveBtn.textContent = 'Salvando...';
                        saveBtn.disabled = true;

                        // Buscar o business_id da empresa
                        const { data: businessData } = await supabase
                            .from('businesses')
                            .select('id')
                            .eq('user_id', this.currentUser.id)
                            .single();

                        if (!businessData) {
                            throw new Error('Estabelecimento n√£o encontrado');
                        }

                        const serviceData = {
                            business_id: businessData.id,
                            name: name,
                            description: description,
                            duration_minutes: duration,
                            price: price,
                            active: true
                        };

                        if (this.editingService) {
                            // Atualizar servi√ßo existente
                            const { error } = await supabase
                                .from('services')
                                .update(serviceData)
                                .eq('id', this.editingService);

                            if (error) throw error;
                            this.showMessage('Servi√ßo atualizado com sucesso!', 'success');
                        } else {
                            // Criar novo servi√ßo
                            const { error } = await supabase
                                .from('services')
                                .insert([serviceData]);

                            if (error) throw error;
                            this.showMessage('Servi√ßo adicionado com sucesso!', 'success');
                        }

                        this.closeServiceModal();
                        await this.loadData();
                        this.render();

                    } catch (error) {
                        console.error('‚ùå Erro ao salvar servi√ßo:', error);
                        this.showMessage('Erro ao salvar servi√ßo: ' + error.message, 'error');
                    } finally {
                        saveBtn.textContent = 'üíæ Salvar Servi√ßo';
                        saveBtn.disabled = false;
                    }
                }

                editService(serviceId) {
                    this.openServiceModal(serviceId);
                }

                async toggleServiceStatus(serviceId) {
                    try {
                        const service = this.services.find(s => s.id === serviceId);
                        if (!service) return;

                        const { error } = await supabase
                            .from('services')
                            .update({ active: !service.active })
                            .eq('id', serviceId);

                        if (error) throw error;

                        this.showMessage(
                            `Servi√ßo ${service.active ? 'desativado' : 'ativado'} com sucesso!`, 
                            'success'
                        );

                        await this.loadData();
                        this.render();

                    } catch (error) {
                        console.error('‚ùå Erro ao alterar status do servi√ßo:', error);
                        this.showMessage('Erro ao alterar status: ' + error.message, 'error');
                    }
                }

                async deleteService(serviceId) {
                    const service = this.services.find(s => s.id === serviceId);
                    if (!service) return;

                    if (!confirm(`Tem certeza que deseja excluir o servi√ßo "${service.name}"?`)) {
                        return;
                    }

                    try {
                        const { error } = await supabase
                            .from('services')
                            .delete()
                            .eq('id', serviceId);

                        if (error) throw error;

                        this.showMessage('Servi√ßo exclu√≠do com sucesso!', 'success');
                        await this.loadData();
                        this.render();

                    } catch (error) {
                        console.error('‚ùå Erro ao excluir servi√ßo:', error);
                        this.showMessage('Erro ao excluir servi√ßo: ' + error.message, 'error');
                    }
                }

                // ========================================
                // PERSONALIZA√á√ÉO
                // ========================================

                openCustomizeModal() {
                    const modal = document.getElementById('customize-modal');
                    modal.classList.remove('hidden');
                    modal.classList.add('flex');
                }

                closeCustomizeModal() {
                    const modal = document.getElementById('customize-modal');
                    modal.classList.add('hidden');
                    modal.classList.remove('flex');
                }
            }
            
            // Inicializar aplica√ß√£o
            console.log('üöÄ Iniciando Beauty App...');
            window.app = new BeautyApp();
            
            // Tornar m√©todos dispon√≠veis globalmente para os bot√µes inline
            window.app.editService = window.app.editService.bind(window.app);
            window.app.toggleServiceStatus = window.app.toggleServiceStatus.bind(window.app);
            window.app.deleteService = window.app.deleteService.bind(window.app);
        }
    </script>
</body>
</html>

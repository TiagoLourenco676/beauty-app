<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beauty App - Sistema de Agendamento</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        body { 
            margin: 0; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; 
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="min-h-screen bg-gradient-to-br from-pink-100 to-purple-100 flex items-center justify-center">
            <div class="text-center">
                <div class="loading mb-4"></div>
                <p>Carregando Beauty App...</p>
            </div>
        </div>
    </div>
    
    <script>
        // ========================================
        // CONFIGURA√á√ÉO DO SUPABASE
        // ========================================
        
        // Suas credenciais do Supabase
        const SUPABASE_URL = 'https://ueonkhdbuzujdfyhokt.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVlb25raGRidXp1amRmeWhvb2t0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk0MzI3ODQsImV4cCI6MjA2NTAwODc4NH0.3zX18Z-Gz3tZ4YQti0wuhtStxPIc8jN8m_lrz_W2ikE';
        
        // Verificar se o Supabase foi carregado
        if (typeof window.supabase === 'undefined') {
            console.error('‚ùå Supabase n√£o foi carregado!');
            document.getElementById('root').innerHTML = `
                <div class="min-h-screen bg-red-50 flex items-center justify-center p-4">
                    <div class="bg-white rounded-lg shadow-xl p-8 max-w-md text-center">
                        <div class="text-6xl mb-4">‚ùå</div>
                        <h1 class="text-2xl font-bold text-red-600 mb-4">Erro de Carregamento</h1>
                        <p class="text-gray-600 mb-4">O Supabase n√£o foi carregado corretamente.</p>
                        <button onclick="location.reload()" class="bg-red-500 text-white px-4 py-2 rounded">
                            Tentar Novamente
                        </button>
                    </div>
                </div>
            `;
        } else {
            // Inicializar Supabase e tornar global
            try {
                window.supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                console.log('‚úÖ Supabase conectado com sucesso!');
                
                // Testar conex√£o
                window.supabaseClient.auth.getSession().then(result => {
                    console.log('üîó Teste de conex√£o:', result);
                    initApp();
                }).catch(error => {
                    console.error('‚ùå Erro na conex√£o:', error);
                    showConnectionError();
                });
                
            } catch (error) {
                console.error('‚ùå Erro ao inicializar Supabase:', error);
                showConnectionError();
            }
        }
        
        function showConnectionError() {
            document.getElementById('root').innerHTML = `
                <div class="min-h-screen bg-red-50 flex items-center justify-center p-4">
                    <div class="bg-white rounded-lg shadow-xl p-8 max-w-md text-center">
                        <div class="text-6xl mb-4">‚ö†Ô∏è</div>
                        <h1 class="text-2xl font-bold text-red-600 mb-4">Erro de Conex√£o</h1>
                        <p class="text-gray-600 mb-4">N√£o foi poss√≠vel conectar ao banco de dados.</p>
                        <p class="text-sm text-gray-500 mb-4">Verifique suas credenciais do Supabase.</p>
                        <button onclick="location.reload()" class="bg-red-500 text-white px-4 py-2 rounded">
                            Tentar Novamente
                        </button>
                    </div>
                </div>
            `;
        }

        // ========================================
        // BEAUTY APP
        // ========================================
        
        function initApp() {
            // Definir supabase globalmente para facilitar acesso
            const supabase = window.supabaseClient;
            
            class BeautyApp {
                constructor() {
                    this.currentView = 'login';
                    this.currentUser = null;
                    this.userType = '';
                    this.showPassword = false;
                    this.selectedBusiness = null;
                    this.selectedService = null;
                    this.editingService = null;
                    this.currentDate = new Date().toISOString().split('T')[0];
                    this.loading = false;
                    this.pendingVerificationEmail = null;
                    
                    // Cache de dados
                    this.businesses = [];
                    this.services = [];
                    this.appointments = [];
                    
                    this.init();
                }
                
                async init() {
                    console.log('üöÄ Inicializando Beauty App...');
                    const supabase = window.supabaseClient;
                    
                    try {
                        // Verificar se usu√°rio j√° est√° logado
                        const { data: { session } } = await supabase.auth.getSession();
                        if (session) {
                            await this.loadUserData(session.user);
                            this.currentView = this.currentUser?.user_type === 'business' ? 'business-dashboard' : 'client-dashboard';
                        }
                        
                        // Escutar mudan√ßas de autentica√ß√£o
                        supabase.auth.onAuthStateChange(async (event, session) => {
                            console.log('üîÑ Auth state changed:', event);
                            if (event === 'SIGNED_IN') {
                                await this.loadUserData(session.user);
                                this.currentView = this.currentUser?.user_type === 'business' ? 'business-dashboard' : 'client-dashboard';
                                this.render();
                            } else if (event === 'SIGNED_OUT') {
                                this.currentUser = null;
                                this.currentView = 'login';
                                this.render();
                            }
                        });
                        
                        await this.loadData();
                        this.render();
                        
                    } catch (error) {
                        console.error('‚ùå Erro na inicializa√ß√£o:', error);
                        this.showMessage('Erro ao inicializar aplica√ß√£o: ' + error.message, 'error');
                    }
                }
                
                async loadUserData(authUser) {
                    const supabase = window.supabaseClient;
                    
                    try {
                        const { data, error } = await supabase
                            .from('users')
                            .select('*')
                            .eq('id', authUser.id)
                            .single();
                        
                        if (error) {
                            console.error('Erro ao carregar usu√°rio:', error);
                            // Se o usu√°rio n√£o existe na tabela users, criar
                            if (error.code === 'PGRST116') {
                                await this.createUserRecord(authUser);
                                return;
                            }
                            throw error;
                        }
                        this.currentUser = data;
                        console.log('üë§ Usu√°rio carregado:', data);
                    } catch (error) {
                        console.error('‚ùå Erro ao carregar dados do usu√°rio:', error);
                    }
                }
                
                async createUserRecord(authUser) {
                    const supabase = window.supabaseClient;
                    
                    try {
                        const userData = authUser.user_metadata || {};
                        const { data, error } = await supabase
                            .from('users')
                            .insert([{
                                id: authUser.id,
                                email: authUser.email,
                                user_type: userData.user_type || 'client',
                                name: userData.name || '',
                                phone: userData.phone || '',
                                address: userData.address || '',
                                email_verified: authUser.email_confirmed_at ? true : false
                            }])
                            .select()
                            .single();
                        
                        if (error) throw error;
                        this.currentUser = data;
                        console.log('üë§ Usu√°rio criado:', data);
                    } catch (error) {
                        console.error('‚ùå Erro ao criar registro do usu√°rio:', error);
                    }
                }
                
                async loadData() {
                    const supabase = window.supabaseClient;
                    
                    try {
                        // Carregar estabelecimentos
                        const { data: businessData, error: businessError } = await supabase
                            .from('businesses')
                            .select('*')
                            .order('name');
                        
                        if (businessError && businessError.code !== 'PGRST116') {
                            console.error('Erro ao carregar estabelecimentos:', businessError);
                        } else {
                            this.businesses = businessData || [];
                        }
                        
                        // Carregar servi√ßos
                        const { data: serviceData, error: serviceError } = await supabase
                            .from('services')
                            .select('*')
                            .eq('active', true)
                            .order('name');
                        
                        if (serviceError && serviceError.code !== 'PGRST116') {
                            console.error('Erro ao carregar servi√ßos:', serviceError);
                        } else {
                            this.services = serviceData || [];
                        }
                        
                        // Carregar agendamentos se usu√°rio logado
                        if (this.currentUser) {
                            await this.loadAppointments();
                        }
                    } catch (error) {
                        console.error('‚ùå Erro ao carregar dados:', error);
                    }
                }
                
                async loadAppointments() {
                    const supabase = window.supabaseClient;
                    
                    try {
                        let query = supabase.from('appointments').select(`
                            *,
                            client:users!appointments_client_id_fkey(name, phone),
                            business:businesses!appointments_business_id_fkey(name),
                            service:services!appointments_service_id_fkey(name)
                        `);
                        
                        if (this.currentUser.user_type === 'business') {
                            // Para empresas, buscar por business_id
                            const { data: businessData } = await supabase
                                .from('businesses')
                                .select('id')
                                .eq('user_id', this.currentUser.id)
                                .single();
                            
                            if (businessData) {
                                query = query.eq('business_id', businessData.id);
                            }
                        } else {
                            query = query.eq('client_id', this.currentUser.id);
                        }
                        
                        const { data, error } = await query.order('appointment_date', { ascending: false });
                        
                        if (error && error.code !== 'PGRST116') {
                            console.error('Erro ao carregar agendamentos:', error);
                        } else {
                            this.appointments = data || [];
                        }
                    } catch (error) {
                        console.error('‚ùå Erro ao carregar agendamentos:', error);
                    }
                }
                
                showMessage(message, type = 'info') {
                    const colors = {
                        success: 'bg-green-100 text-green-800 border-green-200',
                        error: 'bg-red-100 text-red-800 border-red-200',
                        info: 'bg-blue-100 text-blue-800 border-blue-200',
                        warning: 'bg-yellow-100 text-yellow-800 border-yellow-200'
                    };
                    
                    const messageDiv = document.createElement('div');
                    messageDiv.className = `fixed top-4 right-4 p-4 rounded-lg border ${colors[type]} z-50 fade-in max-w-md`;
                    messageDiv.innerHTML = `
                        <div class="flex items-start gap-2">
                            <span class="flex-1">${message}</span>
                            <button onclick="this.parentElement.parentElement.remove()" class="text-lg font-bold">√ó</button>
                        </div>
                    `;
                    document.body.appendChild(messageDiv);
                    
                    setTimeout(() => {
                        if (messageDiv.parentElement) {
                            messageDiv.remove();
                        }
                    }, 5000);
                }
                
                render() {
                    const root = document.getElementById('root');
                    
                    switch(this.currentView) {
                        case 'login':
                            root.innerHTML = this.renderLogin();
                            break;
                        case 'register':
                            root.innerHTML = this.renderRegister();
                            break;
                        case 'forgot-password':
                            root.innerHTML = this.renderForgotPassword();
                            break;
                        case 'email-sent':
                            root.innerHTML = this.renderEmailSent();
                            break;
                        case 'business-dashboard':
                            root.innerHTML = this.renderBusinessDashboard();
                            break;
                        case 'client-dashboard':
                            root.innerHTML = this.renderClientDashboard();
                            break;
                        default:
                            root.innerHTML = this.renderLogin();
                    }
                    
                    this.attachEvents();
                }
                
                renderLogin() {
                    return `
                        <div class="min-h-screen bg-gradient-to-br from-pink-100 to-purple-100 flex items-center justify-center p-4">
                            <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md fade-in">
                                <div class="text-center mb-8">
                                    <h1 class="text-3xl font-bold text-gray-800 mb-2">Beauty App</h1>
                                    <p class="text-gray-600">Sistema de agendamento para sal√µes de beleza</p>
                                </div>

                                <div class="space-y-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                        <input
                                            id="email"
                                            type="email"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                            placeholder="seu@email.com"
                                        />
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                                        <input
                                            id="password"
                                            type="password"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                            placeholder="Sua senha"
                                        />
                                    </div>

                                    <button
                                        id="login-btn"
                                        class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition duration-300"
                                    >
                                        Entrar
                                    </button>
                                </div>

                                <div class="mt-6 text-center">
                                    <button
                                        id="forgot-password-btn"
                                        class="text-pink-600 hover:text-pink-700 font-medium text-sm"
                                    >
                                        Esqueceu sua senha?
                                    </button>
                                </div>

                                <div class="mt-6 text-center">
                                    <p class="text-gray-600 mb-4">N√£o tem uma conta?</p>
                                    <div class="space-y-3">
                                        <button
                                            id="register-client-btn"
                                            class="w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 transition duration-300"
                                        >
                                            üë§ Cadastrar como Cliente
                                        </button>
                                        <button
                                            id="register-business-btn"
                                            class="w-full bg-green-500 text-white py-2 rounded-lg hover:bg-green-600 transition duration-300"
                                        >
                                            üè¢ Cadastrar como Empresa
                                        </button>
                                    </div>
                                </div>

                                <div class="mt-6 text-center">
                                    <p class="text-xs text-gray-500">
                                        Vers√£o de teste - Sistema conectado ao Supabase
                                    </p>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                renderRegister() {
                    return `
                        <div class="min-h-screen bg-gradient-to-br from-pink-100 to-purple-100 flex items-center justify-center p-4">
                            <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md fade-in">
                                <div class="text-center mb-8">
                                    <h1 class="text-3xl font-bold text-gray-800 mb-2">
                                        ${this.userType === 'business' ? 'Cadastro de Empresa' : 'Cadastro de Cliente'}
                                    </h1>
                                    <p class="text-gray-600">Preencha os dados abaixo</p>
                                </div>

                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            ${this.userType === 'business' ? 'Nome da Empresa' : 'Nome Completo'}
                                        </label>
                                        <input
                                            id="reg-name"
                                            type="text"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                        />
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                        <input
                                            id="reg-email"
                                            type="email"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                        />
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Telefone</label>
                                        <input
                                            id="reg-phone"
                                            type="tel"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                            placeholder="(48) 99999-9999"
                                        />
                                    </div>

                                    ${this.userType === 'business' ? `
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Endere√ßo</label>
                                        <input
                                            id="reg-address"
                                            type="text"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                        />
                                    </div>
                                    ` : ''}

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                                        <input
                                            id="reg-password"
                                            type="password"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                            minlength="6"
                                        />
                                        <p class="text-xs text-gray-500 mt-1">M√≠nimo 6 caracteres</p>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Confirmar Senha</label>
                                        <input
                                            id="reg-confirm-password"
                                            type="password"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                        />
                                    </div>

                                    <button
                                        id="register-btn"
                                        class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition duration-300"
                                    >
                                        Cadastrar
                                    </button>
                                </div>

                                <div class="mt-6 text-center">
                                    <button
                                        id="back-to-login"
                                        class="text-pink-600 hover:text-pink-700 font-medium"
                                    >
                                        Voltar ao Login
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                renderForgotPassword() {
                    return `
                        <div class="min-h-screen bg-gradient-to-br from-pink-100 to-purple-100 flex items-center justify-center p-4">
                            <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md fade-in">
                                <div class="text-center mb-8">
                                    <h1 class="text-3xl font-bold text-gray-800 mb-2">Recuperar Senha</h1>
                                    <p class="text-gray-600">Digite seu email para receber as instru√ß√µes</p>
                                </div>

                                <div class="space-y-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                        <input
                                            id="forgot-email"
                                            type="email"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                            placeholder="seu@email.com"
                                        />
                                    </div>

                                    <button
                                        id="send-reset-btn"
                                        class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition duration-300"
                                    >
                                        Enviar Instru√ß√µes
                                    </button>
                                </div>

                                <div class="mt-6 text-center">
                                    <button
                                        id="back-to-login-forgot"
                                        class="text-pink-600 hover:text-pink-700 font-medium"
                                    >
                                        Voltar ao Login
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                renderEmailSent() {
                    return `
                        <div class="min-h-screen bg-gradient-to-br from-pink-100 to-purple-100 flex items-center justify-center p-4">
                            <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md fade-in text-center">
                                <div class="text-6xl mb-4">üìß</div>
                                <h1 class="text-3xl font-bold text-gray-800 mb-2">Email Enviado!</h1>
                                <p class="text-gray-600 mb-6">
                                    Verifique sua caixa de entrada${this.pendingVerificationEmail ? ` (${this.pendingVerificationEmail})` : ''} 
                                    e clique no link para verificar sua conta.
                                </p>
                                <p class="text-sm text-gray-500 mb-6">
                                    N√£o encontrou o email? Verifique a pasta de spam.
                                </p>
                                <button
                                    id="back-to-login-email"
                                    class="bg-pink-500 text-white px-6 py-3 rounded-lg hover:bg-pink-600 transition duration-300"
                                >
                                    Voltar ao Login
                                </button>
                            </div>
                        </div>
                    `;
                }
                
                renderBusinessDashboard() {
                    return `
                        <div class="min-h-screen bg-gray-50">
                            <header class="bg-white shadow-sm border-b">
                                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                                    <div class="flex justify-between items-center py-4">
                                        <h1 class="text-2xl font-bold text-gray-900">Dashboard - ${this.currentUser?.name || 'Empresa'}</h1>
                                        <button
                                            id="logout-btn"
                                            class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition duration-300"
                                        >
                                            Sair
                                        </button>
                                    </div>
                                </div>
                            </header>

                            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                                <div class="bg-white rounded-lg shadow p-6">
                                    <h2 class="text-xl font-semibold text-gray-900 mb-4">üéâ Sistema Conectado!</h2>
                                    <p class="text-gray-600 mb-4">
                                        Parab√©ns! Seu Beauty App est√° funcionando com Supabase.
                                    </p>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div class="bg-green-50 p-4 rounded-lg">
                                            <h3 class="font-semibold text-green-800">‚úÖ Conectado</h3>
                                            <p class="text-sm text-green-600">Banco de dados Supabase ativo</p>
                                        </div>
                                        <div class="bg-blue-50 p-4 rounded-lg">
                                            <h3 class="font-semibold text-blue-800">üìß Emails</h3>
                                            <p class="text-sm text-blue-600">Sistema de verifica√ß√£o funcionando</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                renderClientDashboard() {
                    return `
                        <div class="min-h-screen bg-gray-50">
                            <header class="bg-white shadow-sm border-b">
                                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                                    <div class="flex justify-between items-center py-4">
                                        <h1 class="text-2xl font-bold text-gray-900">Ol√°, ${this.currentUser?.name || 'Cliente'}!</h1>
                                        <button
                                            id="logout-btn"
                                            class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition duration-300"
                                        >
                                            Sair
                                        </button>
                                    </div>
                                </div>
                            </header>

                            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                                <div class="bg-white rounded-lg shadow p-6">
                                    <h2 class="text-xl font-semibold text-gray-900 mb-4">üéâ Bem-vindo!</h2>
                                    <p class="text-gray-600">
                                        Seu cadastro foi realizado com sucesso no Beauty App.
                                    </p>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                // Event handlers
                attachEvents() {
                    // Login
                    const loginBtn = document.getElementById('login-btn');
                    if (loginBtn) {
                        loginBtn.addEventListener('click', () => this.handleLogin());
                    }
                    
                    // Register navigation
                    const registerClientBtn = document.getElementById('register-client-btn');
                    if (registerClientBtn) {
                        registerClientBtn.addEventListener('click', () => {
                            this.userType = 'client';
                            this.currentView = 'register';
                            this.render();
                        });
                    }
                    
                    const registerBusinessBtn = document.getElementById('register-business-btn');
                    if (registerBusinessBtn) {
                        registerBusinessBtn.addEventListener('click', () => {
                            this.userType = 'business';
                            this.currentView = 'register';
                            this.render();
                        });
                    }
                    
                    // Register
                    const registerBtn = document.getElementById('register-btn');
                    if (registerBtn) {
                        registerBtn.addEventListener('click', () => this.handleRegister());
                    }
                    
                    // Back to login
                    const backToLogin = document.getElementById('back-to-login');
                    if (backToLogin) {
                        backToLogin.addEventListener('click', () => {
                            this.currentView = 'login';
                            this.render();
                        });
                    }
                    
                    const backToLoginForgot = document.getElementById('back-to-login-forgot');
                    if (backToLoginForgot) {
                        backToLoginForgot.addEventListener('click', () => {
                            this.currentView = 'login';
                            this.render();
                        });
                    }
                    
                    const backToLoginEmail = document.getElementById('back-to-login-email');
                    if (backToLoginEmail) {
                        backToLoginEmail.addEventListener('click', () => {
                            this.currentView = 'login';
                            this.render();
                        });
                    }
                    
                    // Forgot password
                    const forgotPasswordBtn = document.getElementById('forgot-password-btn');
                    if (forgotPasswordBtn) {
                        forgotPasswordBtn.addEventListener('click', () => {
                            this.currentView = 'forgot-password';
                            this.render();
                        });
                    }
                    
                    const sendResetBtn = document.getElementById('send-reset-btn');
                    if (sendResetBtn) {
                        sendResetBtn.addEventListener('click', () => this.handleForgotPassword());
                    }
                    
                    // Logout
                    const logoutBtn = document.getElementById('logout-btn');
                    if (logoutBtn) {
                        logoutBtn.addEventListener('click', () => this.handleLogout());
                    }
                    
                    // Enter key support
                    document.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter' && !this.loading) {
                            if (this.currentView === 'login') {
                                this.handleLogin();
                            } else if (this.currentView === 'register') {
                                this.handleRegister();
                            } else if (this.currentView === 'forgot-password') {
                                this.handleForgotPassword();
                            }
                        }
                    });
                }
                
                // Authentication methods
                async handleLogin() {
                    const email = document.getElementById('email').value.trim();
                    const password = document.getElementById('password').value;
                    const supabase = window.supabaseClient;
                    
                    if (!email || !password) {
                        this.showMessage('Por favor, preencha email e senha', 'error');
                        return;
                    }
                    
                    try {
                        console.log('üîê Tentando login...');
                        const { data, error } = await supabase.auth.signInWithPassword({
                            email: email,
                            password: password
                        });
                        
                        if (error) throw error;
                        
                        console.log('‚úÖ Login realizado:', data);
                        this.showMessage('Login realizado com sucesso!', 'success');
                    } catch (error) {
                        console.error('‚ùå Erro no login:', error);
                        this.showMessage('Erro no login: ' + error.message, 'error');
                    }
                }
                
                async handleRegister() {
                    const name = document.getElementById('reg-name').value.trim();
                    const email = document.getElementById('reg-email').value.trim();
                    const phone = document.getElementById('reg-phone').value.trim();
                    const password = document.getElementById('reg-password').value;
                    const confirmPassword = document.getElementById('reg-confirm-password').value;
                    const address = document.getElementById('reg-address')?.value.trim() || '';
                    const supabase = window.supabaseClient;
                    
                    if (!name || !email || !phone || !password || !confirmPassword) {
                        this.showMessage('Por favor, preencha todos os campos obrigat√≥rios', 'error');
                        return;
                    }
                    
                    if (password.length < 6) {
                        this.showMessage('A senha deve ter pelo menos 6 caracteres', 'error');
                        return;
                    }
                    
                    if (password !== confirmPassword) {
                        this.showMessage('As senhas n√£o coincidem!', 'error');
                        return;
                    }
                    
                    try {
                        console.log('üìù Registrando usu√°rio...');
                        const { data, error } = await supabase.auth.signUp({
                            email: email,
                            password: password,
                            options: {
                                data: {
                                    name: name,
                                    user_type: this.userType,
                                    phone: phone,
                                    address: address
                                }
                            }
                        });
                        
                        if (error) throw error;
                        
                        console.log('‚úÖ Usu√°rio registrado:', data);
                        this.pendingVerificationEmail = email;
                        this.currentView = 'email-sent';
                        this.render();
                        this.showMessage('Cadastro realizado! Verifique seu email.', 'success');
                        
                    } catch (error) {
                        console.error('‚ùå Erro no cadastro:', error);
                        this.showMessage('Erro no cadastro: ' + error.message, 'error');
                    }
                }
                
                async handleForgotPassword() {
                    const email = document.getElementById('forgot-email').value.trim();
                    const supabase = window.supabaseClient;
                    
                    if (!email) {
                        this.showMessage('Por favor, digite seu email', 'error');
                        return;
                    }
                    
                    try {
                        console.log('üîÑ Enviando email de recupera√ß√£o...');
                        const { error } = await supabase.auth.resetPasswordForEmail(email, {
                            redirectTo: window.location.origin + window.location.pathname
                        });
                        
                        if (error) throw error;
                        
                        this.pendingVerificationEmail = email;
                        this.currentView = 'email-sent';
                        this.render();
                        this.showMessage('Email de recupera√ß√£o enviado!', 'success');
                    } catch (error) {
                        console.error('‚ùå Erro ao enviar email:', error);
                        this.showMessage('Erro ao enviar email: ' + error.message, 'error');
                    }
                }
                
                async handleLogout() {
                    const supabase = window.supabaseClient;
                    
                    try {
                        const { error } = await supabase.auth.signOut();
                        if (error) throw error;
                        
                        this.currentUser = null;
                        this.currentView = 'login';
                        this.render();
                        this.showMessage('Logout realizado com sucesso!', 'success');
                    } catch (error) {
                        console.error('‚ùå Erro no logout:', error);
                        this.showMessage('Erro no logout: ' + error.message, 'error');
                    }
                }
            }
            
            // Inicializar aplica√ß√£o
            window.app = new BeautyApp();
        }
    </script>
</body>
</html>

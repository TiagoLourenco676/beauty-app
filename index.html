<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beauty App - Sistema de Agendamento</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <style>
        body { 
            margin: 0; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; 
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script>
        // Sistema Beauty App - Vers√£o Completa e Funcional
        class BeautyApp {
            constructor() {
                this.currentView = 'login';
                this.currentUser = null;
                this.userType = '';
                this.showPassword = false;
                this.selectedBusiness = null;
                this.selectedService = null;
                this.editingService = null;
                this.currentDate = new Date().toISOString().split('T')[0];
                
                // Dados iniciais vazios (sem exemplos)
                this.users = [];
                this.businesses = [];
                this.services = [];
                this.appointments = [];
                this.emailVerifications = [];
                
                this.init();
            }
            
            init() {
                this.render();
            }
            
            // Fun√ß√£o para gerar ID √∫nico
            generateId() {
                return Date.now() + Math.random().toString(36).substr(2, 9);
            }
            
            // Fun√ß√£o para simular envio de email
            sendEmail(to, subject, message) {
                console.log(`üìß EMAIL ENVIADO:
To: ${to}
Subject: ${subject}
Message: ${message}`);
                
                // Simular verifica√ß√£o de email
                if (subject.includes('Verifica√ß√£o')) {
                    const verificationCode = Math.random().toString(36).substr(2, 8).toUpperCase();
                    this.emailVerifications.push({
                        email: to,
                        code: verificationCode,
                        verified: false,
                        createdAt: new Date()
                    });
                    
                    alert(`Email de verifica√ß√£o enviado para ${to}!\nC√≥digo: ${verificationCode}\n(Em produ√ß√£o, este c√≥digo seria enviado por email real)`);
                    return verificationCode;
                }
                
                if (subject.includes('Recupera√ß√£o')) {
                    const resetCode = Math.random().toString(36).substr(2, 8).toUpperCase();
                    alert(`Email de recupera√ß√£o enviado para ${to}!\nC√≥digo: ${resetCode}\n(Em produ√ß√£o, este c√≥digo seria enviado por email real)`);
                    return resetCode;
                }
                
                return true;
            }
            
            render() {
                const root = document.getElementById('root');
                
                switch(this.currentView) {
                    case 'login':
                        root.innerHTML = this.renderLogin();
                        break;
                    case 'register':
                        root.innerHTML = this.renderRegister();
                        break;
                    case 'forgot-password':
                        root.innerHTML = this.renderForgotPassword();
                        break;
                    case 'verify-email':
                        root.innerHTML = this.renderEmailVerification();
                        break;
                    case 'business-dashboard':
                        root.innerHTML = this.renderBusinessDashboard();
                        break;
                    case 'client-dashboard':
                        root.innerHTML = this.renderClientDashboard();
                        break;
                    case 'business-details':
                        root.innerHTML = this.renderBusinessDetails();
                        break;
                    case 'booking':
                        root.innerHTML = this.renderBookingFlow();
                        break;
                    default:
                        root.innerHTML = this.renderLogin();
                }
                
                this.attachEvents();
            }
            
            renderLogin() {
                return `
                    <div class="min-h-screen bg-gradient-to-br from-pink-100 to-purple-100 flex items-center justify-center p-4">
                        <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md fade-in">
                            <div class="text-center mb-8">
                                <h1 class="text-3xl font-bold text-gray-800 mb-2">Beauty App</h1>
                                <p class="text-gray-600">Sistema de agendamento para sal√µes de beleza</p>
                            </div>

                            <div class="space-y-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                    <input
                                        id="email"
                                        type="email"
                                        required
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                        placeholder="seu@email.com"
                                    />
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                                    <div class="relative">
                                        <input
                                            id="password"
                                            type="password"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent pr-12"
                                            placeholder="Sua senha"
                                        />
                                        <button
                                            id="toggle-password"
                                            type="button"
                                            class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500"
                                        >
                                            üëÅÔ∏è
                                        </button>
                                    </div>
                                </div>

                                <button
                                    id="login-btn"
                                    class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition duration-300"
                                >
                                    Entrar
                                </button>
                            </div>

                            <div class="mt-6 text-center">
                                <button
                                    id="forgot-password-btn"
                                    class="text-pink-600 hover:text-pink-700 font-medium text-sm"
                                >
                                    Esqueceu sua senha?
                                </button>
                            </div>

                            <div class="mt-6 text-center">
                                <p class="text-gray-600 mb-4">N√£o tem uma conta?</p>
                                <div class="space-y-3">
                                    <button
                                        id="register-client-btn"
                                        class="w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 transition duration-300"
                                    >
                                        üë§ Cadastrar como Cliente
                                    </button>
                                    <button
                                        id="register-business-btn"
                                        class="w-full bg-green-500 text-white py-2 rounded-lg hover:bg-green-600 transition duration-300"
                                    >
                                        üè¢ Cadastrar como Empresa
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            renderRegister() {
                return `
                    <div class="min-h-screen bg-gradient-to-br from-pink-100 to-purple-100 flex items-center justify-center p-4">
                        <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md fade-in">
                            <div class="text-center mb-8">
                                <h1 class="text-3xl font-bold text-gray-800 mb-2">
                                    ${this.userType === 'business' ? 'Cadastro de Empresa' : 'Cadastro de Cliente'}
                                </h1>
                                <p class="text-gray-600">Preencha os dados abaixo</p>
                            </div>

                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        ${this.userType === 'business' ? 'Nome da Empresa' : 'Nome Completo'}
                                    </label>
                                    <input
                                        id="reg-name"
                                        type="text"
                                        required
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                    />
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                    <input
                                        id="reg-email"
                                        type="email"
                                        required
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                    />
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Telefone</label>
                                    <input
                                        id="reg-phone"
                                        type="tel"
                                        required
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                        placeholder="(48) 99999-9999"
                                    />
                                </div>

                                ${this.userType === 'business' ? `
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Endere√ßo</label>
                                    <input
                                        id="reg-address"
                                        type="text"
                                        required
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                    />
                                </div>
                                ` : ''}

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                                    <input
                                        id="reg-password"
                                        type="password"
                                        required
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                        minlength="6"
                                    />
                                    <p class="text-xs text-gray-500 mt-1">M√≠nimo 6 caracteres</p>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Confirmar Senha</label>
                                    <input
                                        id="reg-confirm-password"
                                        type="password"
                                        required
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                    />
                                </div>

                                <button
                                    id="register-btn"
                                    class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition duration-300"
                                >
                                    Cadastrar
                                </button>
                            </div>

                            <div class="mt-6 text-center">
                                <button
                                    id="back-to-login"
                                    class="text-pink-600 hover:text-pink-700 font-medium"
                                >
                                    Voltar ao Login
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            renderForgotPassword() {
                return `
                    <div class="min-h-screen bg-gradient-to-br from-pink-100 to-purple-100 flex items-center justify-center p-4">
                        <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md fade-in">
                            <div class="text-center mb-8">
                                <h1 class="text-3xl font-bold text-gray-800 mb-2">Recuperar Senha</h1>
                                <p class="text-gray-600">Digite seu email para receber as instru√ß√µes</p>
                            </div>

                            <div class="space-y-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                    <input
                                        id="forgot-email"
                                        type="email"
                                        required
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                        placeholder="seu@email.com"
                                    />
                                </div>

                                <button
                                    id="send-reset-btn"
                                    class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition duration-300"
                                >
                                    Enviar Instru√ß√µes
                                </button>
                            </div>

                            <div class="mt-6 text-center">
                                <button
                                    id="back-to-login-forgot"
                                    class="text-pink-600 hover:text-pink-700 font-medium"
                                >
                                    Voltar ao Login
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            renderEmailVerification() {
                return `
                    <div class="min-h-screen bg-gradient-to-br from-pink-100 to-purple-100 flex items-center justify-center p-4">
                        <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md fade-in">
                            <div class="text-center mb-8">
                                <div class="text-6xl mb-4">üìß</div>
                                <h1 class="text-3xl font-bold text-gray-800 mb-2">Verificar Email</h1>
                                <p class="text-gray-600">Digite o c√≥digo enviado para seu email</p>
                            </div>

                            <div class="space-y-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">C√≥digo de Verifica√ß√£o</label>
                                    <input
                                        id="verification-code"
                                        type="text"
                                        required
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent text-center text-lg tracking-widest"
                                        placeholder="XXXXXXXX"
                                        maxlength="8"
                                    />
                                </div>

                                <button
                                    id="verify-btn"
                                    class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition duration-300"
                                >
                                    Verificar C√≥digo
                                </button>
                                
                                <button
                                    id="resend-code-btn"
                                    class="w-full bg-gray-500 text-white py-2 rounded-lg hover:bg-gray-600 transition duration-300"
                                >
                                    Reenviar C√≥digo
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            renderBusinessDashboard() {
                const userServices = this.services.filter(s => s.businessId === this.currentUser.id);
                const userAppointments = this.appointments.filter(a => a.businessId === this.currentUser.id);
                const todayAppointments = userAppointments.filter(a => a.date === this.currentDate);
                
                return `
                    <div class="min-h-screen bg-gray-50">
                        <!-- Header -->
                        <header class="bg-white shadow-sm border-b">
                            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                                <div class="flex justify-between items-center py-4">
                                    <h1 class="text-2xl font-bold text-gray-900">Dashboard - ${this.currentUser.name}</h1>
                                    <button
                                        id="logout-btn"
                                        class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition duration-300"
                                    >
                                        Sair
                                    </button>
                                </div>
                            </div>
                        </header>

                        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                            <!-- Stats -->
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                                <div class="bg-white p-6 rounded-lg shadow">
                                    <div class="flex items-center">
                                        <div class="text-3xl mr-4">üìÖ</div>
                                        <div>
                                            <p class="text-sm font-medium text-gray-500">Hoje</p>
                                            <p class="text-2xl font-semibold text-gray-900">${todayAppointments.length}</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-white p-6 rounded-lg shadow">
                                    <div class="flex items-center">
                                        <div class="text-3xl mr-4">üìã</div>
                                        <div>
                                            <p class="text-sm font-medium text-gray-500">Total</p>
                                            <p class="text-2xl font-semibold text-gray-900">${userAppointments.length}</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-white p-6 rounded-lg shadow">
                                    <div class="flex items-center">
                                        <div class="text-3xl mr-4">‚öôÔ∏è</div>
                                        <div>
                                            <p class="text-sm font-medium text-gray-500">Servi√ßos</p>
                                            <p class="text-2xl font-semibold text-gray-900">${userServices.length}</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-white p-6 rounded-lg shadow">
                                    <div class="flex items-center">
                                        <div class="text-3xl mr-4">üí∞</div>
                                        <div>
                                            <p class="text-sm font-medium text-gray-500">Faturamento</p>
                                            <p class="text-2xl font-semibold text-gray-900">R$ ${userAppointments.reduce((total, apt) => total + (apt.price || 0), 0).toFixed(2)}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                <!-- Gerenciar Servi√ßos -->
                                <div class="bg-white rounded-lg shadow p-6">
                                    <div class="flex justify-between items-center mb-6">
                                        <h2 class="text-xl font-semibold text-gray-900">Gerenciar Servi√ßos</h2>
                                        <button id="add-service-btn" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition duration-300">
                                            ‚ûï Novo Servi√ßo
                                        </button>
                                    </div>
                                    
                                    <!-- Formul√°rio para adicionar/editar servi√ßo -->
                                    <div id="service-form" class="mb-6 space-y-4 ${this.editingService || this.showServiceForm ? '' : 'hidden'}">
                                        <div class="grid grid-cols-2 gap-4">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">Nome do Servi√ßo</label>
                                                <input
                                                    id="service-name"
                                                    type="text"
                                                    required
                                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                                    placeholder="Ex: Corte feminino"
                                                />
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">Pre√ßo (R$)</label>
                                                <input
                                                    id="service-price"
                                                    type="number"
                                                    step="0.01"
                                                    min="0"
                                                    required
                                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                                    placeholder="0.00"
                                                />
                                            </div>
                                        </div>
                                        <div class="grid grid-cols-2 gap-4">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">Dura√ß√£o (min)</label>
                                                <input
                                                    id="service-duration"
                                                    type="number"
                                                    min="15"
                                                    step="15"
                                                    required
                                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                                    placeholder="60"
                                                />
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">Categoria</label>
                                                <select
                                                    id="service-category"
                                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                                >
                                                    <option value="cabelo">Cabelo</option>
                                                    <option value="unhas">Unhas</option>
                                                    <option value="estetica">Est√©tica</option>
                                                    <option value="depilacao">Depila√ß√£o</option>
                                                    <option value="massagem">Massagem</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Descri√ß√£o</label>
                                            <textarea
                                                id="service-description"
                                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                                rows="2"
                                                placeholder="Descri√ß√£o detalhada do servi√ßo"
                                            ></textarea>
                                        </div>
                                        <div class="flex gap-2">
                                            <button
                                                id="save-service-btn"
                                                class="flex-1 bg-pink-500 text-white py-2 rounded-lg hover:bg-pink-600 transition duration-300"
                                            >
                                                ${this.editingService ? 'Atualizar' : 'Salvar'} Servi√ßo
                                            </button>
                                            <button
                                                id="cancel-service-btn"
                                                class="px-4 bg-gray-500 text-white py-2 rounded-lg hover:bg-gray-600 transition duration-300"
                                            >
                                                Cancelar
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Lista de servi√ßos -->
                                    <div class="space-y-3">
                                        ${userServices.length === 0 ? 
                                            '<p class="text-gray-500 text-center py-8">Nenhum servi√ßo cadastrado ainda.<br>Clique em "Novo Servi√ßo" para come√ßar.</p>' 
                                            : 
                                            userServices.map(service => `
                                                <div class="border border-gray-200 rounded-lg p-4">
                                                    <div class="flex justify-between items-start">
                                                        <div class="flex-1">
                                                            <div class="flex items-center gap-2">
                                                                <h3 class="font-semibold text-gray-900">${service.name}</h3>
                                                                <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded">${service.category || 'cabelo'}</span>
                                                            </div>
                                                            <p class="text-sm text-gray-600 mt-1">${service.description || ''}</p>
                                                            <div class="flex items-center mt-2 text-sm text-gray-500">
                                                                <span class="font-semibold text-green-600">R$ ${service.price.toFixed(2)}</span>
                                                                <span class="mx-2">‚Ä¢</span>
                                                                <span>‚è±Ô∏è ${service.duration} min</span>
                                                            </div>
                                                        </div>
                                                        <div class="flex space-x-2">
                                                            <button
                                                                onclick="app.editService('${service.id}')"
                                                                class="text-blue-600 hover:text-blue-800 p-1"
                                                                title="Editar"
                                                            >
                                                                ‚úèÔ∏è
                                                            </button>
                                                            <button
                                                                onclick="app.deleteService('${service.id}')"
                                                                class="text-red-600 hover:text-red-800 p-1"
                                                                title="Excluir"
                                                            >
                                                                üóëÔ∏è
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            `).join('')
                                        }
                                    </div>
                                </div>

                                <!-- Agenda de Agendamentos -->
                                <div class="bg-white rounded-lg shadow p-6">
                                    <div class="flex justify-between items-center mb-6">
                                        <h2 class="text-xl font-semibold text-gray-900">Agenda</h2>
                                        <div class="flex items-center gap-2">
                                            <input
                                                id="date-filter"
                                                type="date"
                                                class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                                value="${this.currentDate}"
                                            />
                                        </div>
                                    </div>
                                    
                                    <div class="space-y-4">
                                        ${this.renderAppointmentList(userAppointments)}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            renderAppointmentList(appointments) {
                if (appointments.length === 0) {
                    return '<p class="text-gray-500 text-center py-8">Nenhum agendamento encontrado</p>';
                }
                
                const sortedAppointments = appointments.sort((a, b) => {
                    const dateA = new Date(a.date + ' ' + a.time);
                    const dateB = new Date(b.date + ' ' + b.time);
                    return dateA - dateB;
                });
                
                return sortedAppointments.map(appointment => {
                    const service = this.services.find(s => s.id === appointment.serviceId);
                    const isToday = appointment.date === this.currentDate;
                    const isPast = new Date(appointment.date + ' ' + appointment.time) < new Date();
                    
                    return `
                        <div class="border border-gray-200 rounded-lg p-4 ${isToday ? 'bg-blue-50 border-blue-200' : isPast ? 'bg-gray-50' : ''}">
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <div class="flex items-center gap-2">
                                        <h3 class="font-semibold text-gray-900">${appointment.clientName}</h3>
                                        ${isToday ? '<span class="text-xs bg-blue-500 text-white px-2 py-1 rounded">HOJE</span>' : ''}
                                        ${isPast ? '<span class="text-xs bg-gray-500 text-white px-2 py-1 rounded">FINALIZADO</span>' : ''}
                                    </div>
                                    <p class="text-sm text-gray-600">${service ? service.name : 'Servi√ßo removido'}</p>
                                    <div class="flex items-center mt-2 text-sm text-gray-500">
                                        <span>üìÖ ${this.formatDate(appointment.date)}</span>
                                        <span class="mx-2">‚Ä¢</span>
                                        <span>‚è∞ ${appointment.time}</span>
                                        <span class="mx-2">‚Ä¢</span>
                                        <span>üìû ${appointment.clientPhone || 'N/A'}</span>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <span class="text-lg font-semibold text-green-600">
                                        R$ ${appointment.price.toFixed(2)}
                                    </span>
                                    <div class="mt-1">
                                        <span class="inline-flex px-2 py-1 text-xs font-semibold ${
                                            appointment.status === 'confirmed' ? 'bg-green-100 text-green-800' :
                                            appointment.status === 'pending' ? 'bg-yellow-100 text-yellow-800' :
                                            'bg-red-100 text-red-800'
                                        } rounded-full">
                                            ${appointment.status === 'confirmed' ? 'Confirmado' : 
                                              appointment.status === 'pending' ? 'Pendente' : 'Cancelado'}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            renderClientDashboard() {
                const userAppointments = this.appointments.filter(a => a.clientId === this.currentUser.id);
                
                return `
                    <div class="min-h-screen bg-gray-50">
                        <header class="bg-white shadow-sm border-b">
                            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                                <div class="flex justify-between items-center py-4">
                                    <h1 class="text-2xl font-bold text-gray-900">Ol√°, ${this.currentUser.name}!</h1>
                                    <button
                                        id="logout-btn"
                                        class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition duration-300"
                                    >
                                        Sair
                                    </button>
                                </div>
                            </div>
                        </header>

                        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                                <!-- Estabelecimentos -->
                                <div class="lg:col-span-2">
                                    <div class="flex justify-between items-center mb-6">
                                        <h2 class="text-xl font-semibold text-gray-900">Estabelecimentos</h2>
                                        <div class="flex items-center gap-4">
                                            <input
                                                id="search-businesses"
                                                type="text"
                                                placeholder="Buscar sal√µes..."
                                                class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                            />
                                            <select
                                                id="filter-category"
                                                class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                            >
                                                <option value="">Todas categorias</option>
                                                <option value="cabelo">Cabelo</option>
                                                <option value="unhas">Unhas</option>
                                                <option value="estetica">Est√©tica</option>
                                                <option value="depilacao">Depila√ß√£o</option>
                                                <option value="massagem">Massagem</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        ${this.businesses.length === 0 ? 
                                            '<div class="col-span-2 text-center py-12"><p class="text-gray-500">Nenhuma empresa cadastrada ainda</p></div>' 
                                            :
                                            this.businesses.map(business => `
                                                <div class="bg-white rounded-lg shadow hover:shadow-lg transition-shadow cursor-pointer" onclick="app.selectBusiness('${business.id}')">
                                                    <img
                                                        src="${business.image || 'https://images.unsplash.com/photo-1560066984-138dadb4c035?w=300&h=200&fit=crop'}"
                                                        alt="${business.name}"
                                                        class="w-full h-48 object-cover rounded-t-lg"
                                                        onerror="this.src='https://images.unsplash.com/photo-1560066984-138dadb4c035?w=300&h=200&fit=crop'"
                                                    />
                                                    <div class="p-4">
                                                        <h3 class="font-semibold text-gray-900">${business.name}</h3>
                                                        <div class="flex items-center mt-2">
                                                            <span class="text-sm text-gray-600">üìç ${business.address}</span>
                                                        </div>
                                                        <div class="flex items-center mt-1">
                                                            <span class="text-sm text-gray-600">üìû ${business.phone}</span>
                                                        </div>
                                                        <div class="flex items-center justify-between mt-3">
                                                            <div class="flex items-center">
                                                                <span class="text-sm text-gray-600">‚≠ê ${business.rating || '5.0'}</span>
                                                                <span class="text-sm text-gray-500 ml-2">(${this.services.filter(s => s.businessId === business.id).length} servi√ßos)</span>
                                                            </div>
                                                            <span class="text-pink-600 text-sm font-medium hover:text-pink-700">Ver servi√ßos ‚Üí</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            `).join('')
                                        }
                                    </div>
                                </div>

                                <!-- Meus Agendamentos -->
                                <div>
                                    <h2 class="text-xl font-semibold text-gray-900 mb-6">Meus Agendamentos</h2>
                                    
                                    <div class="space-y-4">
                                        ${userAppointments.length === 0 ? 
                                            '<p class="text-gray-500 text-center py-8">Nenhum agendamento realizado</p>' 
                                            :
                                            userAppointments.map(appointment => {
                                                const business = this.businesses.find(b => b.id === appointment.businessId);
                                                const service = this.services.find(s => s.id === appointment.serviceId);
                                                
                                                return `
                                                    <div class="bg-white rounded-lg shadow p-4">
                                                        <h3 class="font-semibold text-gray-900">${service ? service.name : 'Servi√ßo removido'}</h3>
                                                        <p class="text-sm text-gray-600">${business ? business.name : 'Estabelecimento'}</p>
                                                        <div class="flex items-center mt-2 text-sm text-gray-500">
                                                            <span>üìÖ ${this.formatDate(appointment.date)}</span>
                                                        </div>
                                                        <div class="flex items-center mt-1 text-sm text-gray-500">
                                                            <span>‚è∞ ${appointment.time}</span>
                                                        </div>
                                                        <div class="flex items-center justify-between mt-3">
                                                            <span class="text-green-600 font-semibold">R$ ${appointment.price.toFixed(2)}</span>
                                                            <span class="inline-flex px-2 py-1 text-xs font-semibold ${
                                                                appointment.status === 'confirmed' ? 'bg-green-100 text-green-800' :
                                                                appointment.status === 'pending' ? 'bg-yellow-100 text-yellow-800' :
                                                                'bg-red-100 text-red-800'
                                                            } rounded-full">
                                                                ${appointment.status === 'confirmed' ? 'Confirmado' : 
                                                                  appointment.status === 'pending' ? 'Pendente' : 'Cancelado'}
                                                            </span>
                                                        </div>
                                                    </div>
                                                `;
                                            }).join('')
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            renderBusinessDetails() {
                if (!this.selectedBusiness) {
                    this.currentView = 'client-dashboard';
                    this.render();
                    return;
                }
                
                const businessServices = this.services.filter(s => s.businessId === this.selectedBusiness.id);
                
                return `
                    <div class="min-h-screen bg-gray-50">
                        <header class="bg-white shadow-sm border-b">
                            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                                <div class="flex justify-between items-center py-4">
                                    <div class="flex items-center gap-4">
                                        <button
                                            id="back-to-businesses"
                                            class="text-gray-600 hover:text-gray-800"
                                        >
                                            ‚Üê Voltar
                                        </button>
                                        <h1 class="text-2xl font-bold text-gray-900">${this.selectedBusiness.name}</h1>
                                    </div>
                                    <button
                                        id="logout-btn"
                                        class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition duration-300"
                                    >
                                        Sair
                                    </button>
                                </div>
                            </div>
                        </header>

                        <div class="max-w-4xl mx-auto px-4 py-8">
                            <!-- Info do estabelecimento -->
                            <div class="bg-white rounded-lg shadow p-6 mb-8">
                                <div class="flex items-start space-x-4">
                                    <img
                                        src="${this.selectedBusiness.image || 'https://images.unsplash.com/photo-1560066984-138dadb4c035?w=300&h=200&fit=crop'}"
                                        alt="${this.selectedBusiness.name}"
                                        class="w-20 h-20 rounded-lg object-cover"
                                        onerror="this.src='https://images.unsplash.com/photo-1560066984-138dadb4c035?w=300&h=200&fit=crop'"
                                    />
                                    <div class="flex-1">
                                        <h2 class="text-xl font-semibold text-gray-900">${this.selectedBusiness.name}</h2>
                                        <div class="flex items-center mt-2">
                                            <span class="text-gray-600">üìç ${this.selectedBusiness.address}</span>
                                        </div>
                                        <div class="flex items-center mt-1">
                                            <span class="text-gray-600">üìû ${this.selectedBusiness.phone}</span>
                                        </div>
                                        <div class="flex items-center mt-1">
                                            <span class="text-gray-600">‚≠ê ${this.selectedBusiness.rating || '5.0'}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Servi√ßos dispon√≠veis -->
                            <div class="bg-white rounded-lg shadow p-6">
                                <h3 class="text-lg font-semibold text-gray-900 mb-6">Servi√ßos Dispon√≠veis</h3>
                                
                                ${businessServices.length === 0 ? 
                                    '<p class="text-gray-500 text-center py-8">Este estabelecimento ainda n√£o cadastrou servi√ßos</p>' 
                                    :
                                    `<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        ${businessServices.map(service => `
                                            <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                                                <div class="flex items-center gap-2 mb-2">
                                                    <h4 class="font-semibold text-gray-900">${service.name}</h4>
                                                    <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded">${service.category || 'cabelo'}</span>
                                                </div>
                                                <p class="text-sm text-gray-600 mb-3">${service.description || ''}</p>
                                                <div class="flex items-center justify-between">
                                                    <div class="flex items-center text-sm text-gray-500">
                                                        <span class="font-semibold text-green-600">R$ ${service.price.toFixed(2)}</span>
                                                        <span class="mx-2">‚Ä¢</span>
                                                        <span>‚è±Ô∏è ${service.duration} min</span>
                                                    </div>
                                                    <button
                                                        onclick="app.selectService('${service.id}')"
                                                        class="bg-pink-500 text-white px-4 py-2 rounded-lg hover:bg-pink-600 transition duration-300 text-sm"
                                                    >
                                                        Agendar
                                                    </button>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>`
                                }
                            </div>
                        </div>
                    </div>
                `;
            }
            
            renderBookingFlow() {
                if (!this.selectedService) {
                    this.currentView = 'client-dashboard';
                    this.render();
                    return;
                }
                
                const service = this.services.find(s => s.id === this.selectedService);
                const business = this.businesses.find(b => b.id === service.businessId);
                
                return `
                    <div class="min-h-screen bg-gray-50">
                        <header class="bg-white shadow-sm border-b">
                            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                                <div class="flex justify-between items-center py-4">
                                    <div class="flex items-center gap-4">
                                        <button
                                            id="back-to-business"
                                            class="text-gray-600 hover:text-gray-800"
                                        >
                                            ‚Üê Voltar
                                        </button>
                                        <h1 class="text-2xl font-bold text-gray-900">Agendar Servi√ßo</h1>
                                    </div>
                                    <button
                                        id="logout-btn"
                                        class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition duration-300"
                                    >
                                        Sair
                                    </button>
                                </div>
                            </div>
                        </header>

                        <div class="max-w-2xl mx-auto px-4 py-8">
                            <div class="bg-white rounded-lg shadow p-6">
                                <h2 class="text-xl font-semibold text-gray-900 mb-6">Confirmar Agendamento</h2>
                                
                                <!-- Resumo do servi√ßo -->
                                <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                                    <h3 class="font-semibold text-gray-900">${service.name}</h3>
                                    <p class="text-gray-600">${service.description || ''}</p>
                                    <p class="text-sm text-gray-500 mt-1">${business.name}</p>
                                    <div class="flex items-center mt-2 text-sm text-gray-500">
                                        <span class="font-semibold text-green-600">R$ ${service.price.toFixed(2)}</span>
                                        <span class="mx-2">‚Ä¢</span>
                                        <span>‚è±Ô∏è ${service.duration} min</span>
                                    </div>
                                </div>

                                <!-- Formul√°rio de agendamento -->
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Data</label>
                                        <input
                                            id="booking-date"
                                            type="date"
                                            required
                                            min="${new Date().toISOString().split('T')[0]}"
                                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                        />
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Hor√°rio</label>
                                        <select
                                            id="booking-time"
                                            required
                                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                        >
                                            <option value="">Selecione um hor√°rio</option>
                                            <option value="08:00">08:00</option>
                                            <option value="08:30">08:30</option>
                                            <option value="09:00">09:00</option>
                                            <option value="09:30">09:30</option>
                                            <option value="10:00">10:00</option>
                                            <option value="10:30">10:30</option>
                                            <option value="11:00">11:00</option>
                                            <option value="11:30">11:30</option>
                                            <option value="14:00">14:00</option>
                                            <option value="14:30">14:30</option>
                                            <option value="15:00">15:00</option>
                                            <option value="15:30">15:30</option>
                                            <option value="16:00">16:00</option>
                                            <option value="16:30">16:30</option>
                                            <option value="17:00">17:00</option>
                                            <option value="17:30">17:30</option>
                                            <option value="18:00">18:00</option>
                                        </select>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Observa√ß√µes (opcional)</label>
                                        <textarea
                                            id="booking-notes"
                                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                            rows="3"
                                            placeholder="Alguma observa√ß√£o especial?"
                                        ></textarea>
                                    </div>

                                    <button
                                        id="confirm-booking-btn"
                                        class="w-full bg-pink-500 text-white py-3 rounded-lg hover:bg-pink-600 transition duration-300 font-semibold"
                                    >
                                        Confirmar Agendamento
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Fun√ß√µes utilit√°rias
            formatDate(dateString) {
                const date = new Date(dateString + 'T00:00:00');
                return date.toLocaleDateString('pt-BR');
            }
            
            // Event handlers
            attachEvents() {
                // Login events
                const loginBtn = document.getElementById('login-btn');
                if (loginBtn) {
                    loginBtn.addEventListener('click', () => this.handleLogin());
                }
                
                const togglePassword = document.getElementById('toggle-password');
                if (togglePassword) {
                    togglePassword.addEventListener('click', () => this.togglePassword());
                }
                
                const forgotPasswordBtn = document.getElementById('forgot-password-btn');
                if (forgotPasswordBtn) {
                    forgotPasswordBtn.addEventListener('click', () => {
                        this.currentView = 'forgot-password';
                        this.render();
                    });
                }
                
                const registerClientBtn = document.getElementById('register-client-btn');
                if (registerClientBtn) {
                    registerClientBtn.addEventListener('click', () => {
                        this.userType = 'client';
                        this.currentView = 'register';
                        this.render();
                    });
                }
                
                const registerBusinessBtn = document.getElementById('register-business-btn');
                if (registerBusinessBtn) {
                    registerBusinessBtn.addEventListener('click', () => {
                        this.userType = 'business';
                        this.currentView = 'register';
                        this.render();
                    });
                }
                
                // Register events
                const registerBtn = document.getElementById('register-btn');
                if (registerBtn) {
                    registerBtn.addEventListener('click', () => this.handleRegister());
                }
                
                const backToLogin = document.getElementById('back-to-login');
                if (backToLogin) {
                    backToLogin.addEventListener('click', () => {
                        this.currentView = 'login';
                        this.render();
                    });
                }
                
                const backToLoginForgot = document.getElementById('back-to-login-forgot');
                if (backToLoginForgot) {
                    backToLoginForgot.addEventListener('click', () => {
                        this.currentView = 'login';
                        this.render();
                    });
                }
                
                // Forgot password events
                const sendResetBtn = document.getElementById('send-reset-btn');
                if (sendResetBtn) {
                    sendResetBtn.addEventListener('click', () => this.handleForgotPassword());
                }
                
                // Email verification events
                const verifyBtn = document.getElementById('verify-btn');
                if (verifyBtn) {
                    verifyBtn.addEventListener('click', () => this.handleEmailVerification());
                }
                
                const resendCodeBtn = document.getElementById('resend-code-btn');
                if (resendCodeBtn) {
                    resendCodeBtn.addEventListener('click', () => this.resendVerificationCode());
                }
                
                // Logout events
                const logoutBtn = document.getElementById('logout-btn');
                if (logoutBtn) {
                    logoutBtn.addEventListener('click', () => this.handleLogout());
                }
                
                // Business dashboard events
                const addServiceBtn = document.getElementById('add-service-btn');
                if (addServiceBtn) {
                    addServiceBtn.addEventListener('click', () => this.showServiceForm());
                }
                
                const saveServiceBtn = document.getElementById('save-service-btn');
                if (saveServiceBtn) {
                    saveServiceBtn.addEventListener('click', () => this.handleSaveService());
                }
                
                const cancelServiceBtn = document.getElementById('cancel-service-btn');
                if (cancelServiceBtn) {
                    cancelServiceBtn.addEventListener('click', () => this.cancelServiceForm());
                }
                
                const dateFilter = document.getElementById('date-filter');
                if (dateFilter) {
                    dateFilter.addEventListener('change', (e) => {
                        this.currentDate = e.target.value;
                        this.render();
                    });
                }
                
                // Client dashboard events
                const backToBusinesses = document.getElementById('back-to-businesses');
                if (backToBusinesses) {
                    backToBusinesses.addEventListener('click', () => {
                        this.selectedBusiness = null;
                        this.currentView = 'client-dashboard';
                        this.render();
                    });
                }
                
                const backToBusiness = document.getElementById('back-to-business');
                if (backToBusiness) {
                    backToBusiness.addEventListener('click', () => {
                        this.selectedService = null;
                        this.currentView = 'business-details';
                        this.render();
                    });
                }
                
                // Booking events
                const confirmBookingBtn = document.getElementById('confirm-booking-btn');
                if (confirmBookingBtn) {
                    confirmBookingBtn.addEventListener('click', () => this.handleBooking());
                }
                
                // Search and filter events
                const searchBusinesses = document.getElementById('search-businesses');
                if (searchBusinesses) {
                    searchBusinesses.addEventListener('input', () => this.filterBusinesses());
                }
                
                const filterCategory = document.getElementById('filter-category');
                if (filterCategory) {
                    filterCategory.addEventListener('change', () => this.filterBusinesses());
                }
                
                // Enter key support
                document.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        if (this.currentView === 'login') {
                            this.handleLogin();
                        } else if (this.currentView === 'register') {
                            this.handleRegister();
                        } else if (this.currentView === 'forgot-password') {
                            this.handleForgotPassword();
                        } else if (this.currentView === 'verify-email') {
                            this.handleEmailVerification();
                        }
                    }
                });
            }
            
            // Business methods
            showServiceForm() {
                this.showServiceForm = true;
                const form = document.getElementById('service-form');
                if (form) {
                    form.classList.remove('hidden');
                }
            }
            
            cancelServiceForm() {
                this.showServiceForm = false;
                this.editingService = null;
                const form = document.getElementById('service-form');
                if (form) {
                    form.classList.add('hidden');
                    // Clear form
                    document.getElementById('service-name').value = '';
                    document.getElementById('service-price').value = '';
                    document.getElementById('service-duration').value = '';
                    document.getElementById('service-description').value = '';
                }
            }
            
            editService(serviceId) {
                const service = this.services.find(s => s.id === serviceId);
                if (service) {
                    this.editingService = service;
                    this.showServiceForm = true;
                    
                    // Fill form with service data
                    document.getElementById('service-name').value = service.name;
                    document.getElementById('service-price').value = service.price;
                    document.getElementById('service-duration').value = service.duration;
                    document.getElementById('service-category').value = service.category || 'cabelo';
                    document.getElementById('service-description').value = service.description || '';
                    
                    const form = document.getElementById('service-form');
                    if (form) {
                        form.classList.remove('hidden');
                    }
                }
            }
            
            deleteService(serviceId) {
                if (confirm('Tem certeza que deseja excluir este servi√ßo?')) {
                    this.services = this.services.filter(s => s.id !== serviceId);
                    this.render();
                }
            }
            
            handleSaveService() {
                const name = document.getElementById('service-name').value.trim();
                const price = parseFloat(document.getElementById('service-price').value);
                const duration = parseInt(document.getElementById('service-duration').value);
                const category = document.getElementById('service-category').value;
                const description = document.getElementById('service-description').value.trim();
                
                if (!name || !price || !duration) {
                    alert('Por favor, preencha todos os campos obrigat√≥rios');
                    return;
                }
                
                if (price <= 0) {
                    alert('O pre√ßo deve ser maior que zero');
                    return;
                }
                
                if (duration < 15) {
                    alert('A dura√ß√£o deve ser de pelo menos 15 minutos');
                    return;
                }
                
                if (this.editingService) {
                    // Update existing service
                    const index = this.services.findIndex(s => s.id === this.editingService.id);
                    this.services[index] = {
                        ...this.editingService,
                        name,
                        price,
                        duration,
                        category,
                        description
                    };
                    this.editingService = null;
                } else {
                    // Create new service
                    const newService = {
                        id: this.generateId(),
                        businessId: this.currentUser.id,
                        name,
                        price,
                        duration,
                        category,
                        description
                    };
                    this.services.push(newService);
                }
                
                this.cancelServiceForm();
                this.render();
            }
            
            // Client methods
            selectBusiness(businessId) {
                this.selectedBusiness = this.businesses.find(b => b.id === businessId);
                this.currentView = 'business-details';
                this.render();
            }
            
            selectService(serviceId) {
                this.selectedService = serviceId;
                this.currentView = 'booking';
                this.render();
            }
            
            handleBooking() {
                const date = document.getElementById('booking-date').value;
                const time = document.getElementById('booking-time').value;
                const notes = document.getElementById('booking-notes').value.trim();
                
                if (!date || !time) {
                    alert('Por favor, selecione data e hor√°rio');
                    return;
                }
                
                const service = this.services.find(s => s.id === this.selectedService);
                const business = this.businesses.find(b => b.id === service.businessId);
                
                // Check if time slot is available
                const existingBooking = this.appointments.find(a => 
                    a.businessId === business.id && 
                    a.date === date && 
                    a.time === time
                );
                
                if (existingBooking) {
                    alert('Este hor√°rio j√° est√° ocupado. Por favor, escolha outro hor√°rio.');
                    return;
                }
                
                const appointment = {
                    id: this.generateId(),
                    clientId: this.currentUser.id,
                    businessId: business.id,
                    serviceId: service.id,
                    date,
                    time,
                    notes,
                    status: 'confirmed',
                    clientName: this.currentUser.name,
                    clientPhone: this.currentUser.phone,
                    serviceName: service.name,
                    price: service.price,
                    createdAt: new Date()
                };
                
                this.appointments.push(appointment);
                
                // Send confirmation email
                this.sendEmail(
                    this.currentUser.email,
                    'Agendamento Confirmado - Beauty App',
                    `Seu agendamento foi confirmado!\n\nServi√ßo: ${service.name}\nData: ${this.formatDate(date)}\nHor√°rio: ${time}\nLocal: ${business.name}\nValor: R$ ${service.price.toFixed(2)}`
                );
                
                // Send notification to business
                const businessUser = this.users.find(u => u.id === business.id);
                if (businessUser) {
                    this.sendEmail(
                        businessUser.email,
                        'Novo Agendamento - Beauty App',
                        `Voc√™ tem um novo agendamento!\n\nCliente: ${this.currentUser.name}\nServi√ßo: ${service.name}\nData: ${this.formatDate(date)}\nHor√°rio: ${time}\nValor: R$ ${service.price.toFixed(2)}`
                    );
                }
                
                alert('Agendamento realizado com sucesso!');
                this.selectedService = null;
                this.selectedBusiness = null;
                this.currentView = 'client-dashboard';
                this.render();
            }
            
            filterBusinesses() {
                // This would be implemented to filter businesses based on search and category
                // For now, we'll just re-render
                this.render();
            }
            
            // Authentication methods
            handleLogin() {
                const email = document.getElementById('email').value.trim();
                const password = document.getElementById('password').value;
                
                if (!email || !password) {
                    alert('Por favor, preencha email e senha');
                    return;
                }
                
                const user = this.users.find(u => u.email === email && u.password === password);
                
                if (user) {
                    // Check if email is verified
                    const verification = this.emailVerifications.find(v => v.email === email && v.verified);
                    if (!verification) {
                        alert('Por favor, verifique seu email antes de fazer login');
                        return;
                    }
                    
                    this.currentUser = user;
                    this.currentView = user.type === 'business' ? 'business-dashboard' : 'client-dashboard';
                    this.render();
                } else {
                    alert('Email ou senha inv√°lidos!');
                }
            }
            
            handleRegister() {
                const name = document.getElementById('reg-name').value.trim();
                const email = document.getElementById('reg-email').value.trim();
                const phone = document.getElementById('reg-phone').value.trim();
                const password = document.getElementById('reg-password').value;
                const confirmPassword = document.getElementById('reg-confirm-password').value;
                const address = document.getElementById('reg-address')?.value.trim() || '';
                
                if (!name || !email || !phone || !password || !confirmPassword) {
                    alert('Por favor, preencha todos os campos obrigat√≥rios');
                    return;
                }
                
                if (password.length < 6) {
                    alert('A senha deve ter pelo menos 6 caracteres');
                    return;
                }
                
                if (password !== confirmPassword) {
                    alert('As senhas n√£o coincidem!');
                    return;
                }
                
                if (this.users.find(u => u.email === email)) {
                    alert('Email j√° cadastrado!');
                    return;
                }
                
                // Validate email format
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    alert('Por favor, digite um email v√°lido');
                    return;
                }
                
                const newUser = {
                    id: this.generateId(),
                    email,
                    password,
                    type: this.userType,
                    name,
                    phone,
                    address
                };
                
                this.users.push(newUser);
                
                if (this.userType === 'business') {
                    const newBusiness = {
                        id: newUser.id,
                        name,
                        email,
                        phone,
                        address,
                        rating: 5.0,
                        image: 'https://images.unsplash.com/photo-1560066984-138dadb4c035?w=300&h=200&fit=crop'
                    };
                    this.businesses.push(newBusiness);
                }
                
                // Send verification email
                this.pendingUser = newUser;
                this.sendEmail(
                    email,
                    'Verifica√ß√£o de Email - Beauty App',
                    `Bem-vindo ao Beauty App!\n\nPor favor, verifique seu email usando o c√≥digo abaixo.`
                );
                
                this.currentView = 'verify-email';
                this.render();
            }
            
            handleForgotPassword() {
                const email = document.getElementById('forgot-email').value.trim();
                
                if (!email) {
                    alert('Por favor, digite seu email');
                    return;
                }
                
                const user = this.users.find(u => u.email === email);
                if (!user) {
                    alert('Email n√£o encontrado');
                    return;
                }
                
                this.sendEmail(
                    email,
                    'Recupera√ß√£o de Senha - Beauty App',
                    `Use o c√≥digo abaixo para redefinir sua senha.`
                );
                
                alert('Instru√ß√µes enviadas para seu email!');
                this.currentView = 'login';
                this.render();
            }
            
            handleEmailVerification() {
                const code = document.getElementById('verification-code').value.trim().toUpperCase();
                
                if (!code) {
                    alert('Por favor, digite o c√≥digo de verifica√ß√£o');
                    return;
                }
                
                const verification = this.emailVerifications.find(v => 
                    v.email === this.pendingUser.email && 
                    v.code === code
                );
                
                if (verification) {
                    verification.verified = true;
                    alert('Email verificado com sucesso! Voc√™ j√° pode fazer login.');
                    this.pendingUser = null;
                    this.currentView = 'login';
                    this.render();
                } else {
                    alert('C√≥digo inv√°lido. Por favor, verifique e tente novamente.');
                }
            }
            
            resendVerificationCode() {
                if (this.pendingUser) {
                    this.sendEmail(
                        this.pendingUser.email,
                        'Verifica√ß√£o de Email - Beauty App',
                        `Novo c√≥digo de verifica√ß√£o para seu email.`
                    );
                }
            }
            
            handleLogout() {
                this.currentUser = null;
                this.selectedBusiness = null;
                this.selectedService = null;
                this.editingService = null;
                this.currentView = 'login';
                this.render();
            }
            
            togglePassword() {
                const passwordInput = document.getElementById('password');
                const toggleBtn = document.getElementById('toggle-password');
                
                if (passwordInput && toggleBtn) {
                    if (passwordInput.type === 'password') {
                        passwordInput.type = 'text';
                        toggleBtn.textContent = 'üôà';
                    } else {
                        passwordInput.type = 'password';
                        toggleBtn.textContent = 'üëÅÔ∏è';
                    }
                }
            }
        }
        
        // Criar inst√¢ncia global para acesso nas fun√ß√µes onclick
        let app;
        
        // Inicializar aplica√ß√£o quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', () => {
            app = new BeautyApp();
        });
        
        // Fallback caso DOMContentLoaded j√° tenha disparado
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                app = new BeautyApp();
            });
        } else {
            app = new BeautyApp();
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beauty App - Sistema de Agendamento</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        body { 
            margin: 0; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; 
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .error-details {
            background: #fee;
            border: 1px solid #fcc;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            font-family: monospace;
            font-size: 0.8rem;
            color: #c33;
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="min-h-screen bg-gradient-to-br from-pink-100 to-purple-100 flex items-center justify-center">
            <div class="text-center">
                <div class="loading mb-4"></div>
                <p>Carregando Beauty App...</p>
            </div>
        </div>
    </div>
    
    <script>
        console.log('üöÄ Iniciando Beauty App...');
        
        // ========================================
        // CONFIGURA√á√ÉO DO SUPABASE
        // ========================================
        
        // üö® IMPORTANTE: SUBSTITUA PELAS SUAS CREDENCIAIS CORRETAS
        const SUPABASE_URL = 'https://ueonkhdbuzujdfyhookt.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVlb25raGRidXp1amRmeWhvb2t0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk0MzI3ODQsImV4cCI6MjA2NTAwODc4NH0.3zX18Z-Gz3tZ4YQti0wuhtStxPIc8jN8m_lrz_W2ikE'; // ‚ö†Ô∏è SUBSTITUA PELA CHAVE CORRETA!
        
        // Verificar se as credenciais foram configuradas
        if (SUPABASE_ANON_KEY === 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVlb25raGRidXp1amRmeWhvb2t0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk0MzI3ODQsImV4cCI6MjA2NTAwODc4NH0.3zX18Z-Gz3tZ4YQti0wuhtStxPIc8jN8m_lrz_W2ikE') {
            showConfigurationError();
        } else if (typeof window.supabase === 'undefined') {
            console.error('‚ùå Supabase n√£o foi carregado!');
            showLibraryError();
        } else {
            initializeSupabase();
        }
        
        function showConfigurationError() {
            document.getElementById('root').innerHTML = `
                <div class="min-h-screen bg-orange-50 flex items-center justify-center p-4">
                    <div class="bg-white rounded-lg shadow-xl p-8 max-w-2xl">
                        <div class="text-6xl mb-4 text-center">‚öôÔ∏è</div>
                        <h1 class="text-2xl font-bold text-orange-600 mb-4 text-center">Configura√ß√£o Necess√°ria</h1>
                        <div class="space-y-4 text-sm">
                            <p class="text-gray-600">Para usar o Beauty App, voc√™ precisa:</p>
                            <div class="bg-gray-100 p-4 rounded-lg">
                                <h3 class="font-semibold mb-2">1. Criar as tabelas no Supabase:</h3>
                                <p>Execute o script SQL fornecido no SQL Editor do Supabase</p>
                            </div>
                            <div class="bg-gray-100 p-4 rounded-lg">
                                <h3 class="font-semibold mb-2">2. Configurar a chave API:</h3>
                                <p>Substitua <code>SUA_CHAVE_ANON_CORRETA_AQUI</code> pela sua chave anon do Supabase</p>
                            </div>
                            <div class="bg-gray-100 p-4 rounded-lg">
                                <h3 class="font-semibold mb-2">3. Configurar autentica√ß√£o:</h3>
                                <p>No painel do Supabase, v√° em Authentication > Settings e configure o email</p>
                            </div>
                        </div>
                        <button onclick="location.reload()" class="w-full mt-6 bg-orange-500 text-white px-4 py-2 rounded">
                            Recarregar ap√≥s configurar
                        </button>
                    </div>
                </div>
            `;
        }
        
        function showLibraryError() {
            document.getElementById('root').innerHTML = `
                <div class="min-h-screen bg-red-50 flex items-center justify-center p-4">
                    <div class="bg-white rounded-lg shadow-xl p-8 max-w-md text-center">
                        <div class="text-6xl mb-4">üìö</div>
                        <h1 class="text-2xl font-bold text-red-600 mb-4">Erro de Biblioteca</h1>
                        <p class="text-gray-600 mb-4">O Supabase n√£o foi carregado corretamente.</p>
                        <p class="text-sm text-gray-500 mb-4">Verifique sua conex√£o com a internet.</p>
                        <button onclick="location.reload()" class="bg-red-500 text-white px-4 py-2 rounded">
                            Tentar Novamente
                        </button>
                    </div>
                </div>
            `;
        }
        
        function showConnectionError(error) {
            document.getElementById('root').innerHTML = `
                <div class="min-h-screen bg-red-50 flex items-center justify-center p-4">
                    <div class="bg-white rounded-lg shadow-xl p-8 max-w-2xl">
                        <div class="text-6xl mb-4 text-center">‚ö†Ô∏è</div>
                        <h1 class="text-2xl font-bold text-red-600 mb-4 text-center">Erro de Conex√£o</h1>
                        <p class="text-gray-600 mb-4">N√£o foi poss√≠vel conectar ao banco de dados.</p>
                        
                        <div class="error-details">
                            <strong>Detalhes do erro:</strong><br>
                            ${error.message || 'Erro desconhecido'}
                        </div>
                        
                        <div class="space-y-2 text-sm text-gray-600 mb-4">
                            <p><strong>Poss√≠veis causas:</strong></p>
                            <ul class="list-disc list-inside space-y-1">
                                <li>URL do Supabase incorreta</li>
                                <li>Chave anon inv√°lida ou expirada</li>
                                <li>Projeto Supabase pausado</li>
                                <li>Problemas de rede</li>
                            </ul>
                        </div>
                        
                        <button onclick="location.reload()" class="bg-red-500 text-white px-4 py-2 rounded">
                            Tentar Novamente
                        </button>
                    </div>
                </div>
            `;
        }
        
        function initializeSupabase() {
            try {
                window.supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                console.log('‚úÖ Supabase conectado com sucesso!');
                testConnection();
            } catch (error) {
                console.error('‚ùå Erro ao inicializar Supabase:', error);
                showConnectionError(error);
            }
        }
        
        async function testConnection() {
            try {
                const { data, error } = await window.supabaseClient.auth.getSession();
                if (error) {
                    console.warn('‚ö†Ô∏è Aviso na sess√£o:', error.message);
                }
                console.log('üîó Teste de conex√£o OK');
                initApp();
            } catch (error) {
                console.error('‚ùå Erro no teste de conex√£o:', error);
                showConnectionError(error);
            }
        }

        // ========================================
        // BEAUTY APP
        // ========================================
        
        function initApp() {
            const supabase = window.supabaseClient;
            
            class BeautyApp {
                constructor() {
                    this.currentView = 'login';
                    this.currentUser = null;
                    this.userType = '';
                    this.loading = false;
                    this.pendingVerificationEmail = null;
                    
                    // Cache de dados
                    this.businesses = [];
                    this.services = [];
                    this.appointments = [];
                    
                    this.init();
                }
                
                async init() {
                    console.log('üöÄ Inicializando Beauty App...');
                    
                    try {
                        // Verificar se usu√°rio j√° est√° logado
                        const { data: { session }, error } = await supabase.auth.getSession();
                        if (error) {
                            console.error('Erro ao verificar sess√£o:', error);
                        }
                        
                        if (session?.user) {
                            console.log('üë§ Usu√°rio j√° logado:', session.user.email);
                            await this.loadUserData(session.user);
                            this.currentView = this.currentUser?.user_type === 'business' ? 'business-dashboard' : 'client-dashboard';
                        }
                        
                        // Escutar mudan√ßas de autentica√ß√£o
                        supabase.auth.onAuthStateChange(async (event, session) => {
                            console.log('üîÑ Auth state changed:', event);
                            if (event === 'SIGNED_IN') {
                                await this.loadUserData(session.user);
                                this.currentView = this.currentUser?.user_type === 'business' ? 'business-dashboard' : 'client-dashboard';
                                this.render();
                            } else if (event === 'SIGNED_OUT') {
                                this.currentUser = null;
                                this.currentView = 'login';
                                this.render();
                            }
                        });
                        
                        await this.loadData();
                        this.render();
                        
                    } catch (error) {
                        console.error('‚ùå Erro na inicializa√ß√£o:', error);
                        this.showMessage('Erro ao inicializar aplica√ß√£o: ' + error.message, 'error');
                        this.renderError(error);
                    }
                }
                
                renderError(error) {
                    const root = document.getElementById('root');
                    root.innerHTML = `
                        <div class="min-h-screen bg-red-50 flex items-center justify-center p-4">
                            <div class="bg-white rounded-lg shadow-xl p-8 max-w-2xl">
                                <div class="text-6xl mb-4 text-center">üí•</div>
                                <h1 class="text-2xl font-bold text-red-600 mb-4 text-center">Erro na Aplica√ß√£o</h1>
                                
                                <div class="error-details">
                                    <strong>Erro:</strong> ${error.message}<br>
                                    <strong>C√≥digo:</strong> ${error.code || 'N/A'}
                                </div>
                                
                                <button onclick="location.reload()" class="bg-red-500 text-white px-4 py-2 rounded">
                                    Recarregar
                                </button>
                            </div>
                        </div>
                    `;
                }
                
                async loadUserData(authUser) {
                    try {
                        const { data, error } = await supabase
                            .from('users')
                            .select('*')
                            .eq('id', authUser.id)
                            .single();
                        
                        if (error) {
                            if (error.code === 'PGRST116') {
                                console.log('üìù Criando registro de usu√°rio...');
                                await this.createUserRecord(authUser);
                                return;
                            }
                            throw error;
                        }
                        this.currentUser = data;
                        console.log('üë§ Usu√°rio carregado:', data);
                    } catch (error) {
                        console.error('‚ùå Erro ao carregar dados do usu√°rio:', error);
                        this.showMessage('Erro ao carregar perfil: ' + error.message, 'error');
                    }
                }
                
                async createUserRecord(authUser) {
                    try {
                        const userData = authUser.user_metadata || {};
                        const { data, error } = await supabase
                            .from('users')
                            .insert([{
                                id: authUser.id,
                                email: authUser.email,
                                user_type: userData.user_type || 'client',
                                name: userData.name || '',
                                phone: userData.phone || '',
                                address: userData.address || '',
                                email_verified: authUser.email_confirmed_at ? true : false
                            }])
                            .select()
                            .single();
                        
                        if (error) throw error;
                        this.currentUser = data;
                        console.log('üë§ Usu√°rio criado:', data);
                        
                        if (userData.user_type === 'business' && userData.name) {
                            await this.createBusinessRecord(data);
                        }
                        
                    } catch (error) {
                        console.error('‚ùå Erro ao criar registro do usu√°rio:', error);
                        this.showMessage('Erro ao criar perfil: ' + error.message, 'error');
                    }
                }
                
                async createBusinessRecord(user) {
                    try {
                        const { data, error } = await supabase
                            .from('businesses')
                            .insert([{
                                user_id: user.id,
                                name: user.name,
                                address: user.address || '',
                                phone: user.phone || '',
                                email: user.email
                            }])
                            .select()
                            .single();
                        
                        if (error) throw error;
                        console.log('üè¢ Estabelecimento criado:', data);
                    } catch (error) {
                        console.error('‚ùå Erro ao criar estabelecimento:', error);
                    }
                }
                
                async loadData() {
                    try {
                        const { data: businessData } = await supabase
                            .from('businesses')
                            .select('*')
                            .eq('active', true)
                            .order('name');
                        
                        this.businesses = businessData || [];
                        console.log(`üìç ${this.businesses.length} estabelecimentos carregados`);
                        
                        const { data: serviceData } = await supabase
                            .from('services')
                            .select('*')
                            .eq('active', true)
                            .order('name');
                        
                        this.services = serviceData || [];
                        console.log(`üíº ${this.services.length} servi√ßos carregados`);
                        
                        if (this.currentUser) {
                            await this.loadAppointments();
                        }
                    } catch (error) {
                        console.error('‚ùå Erro ao carregar dados:', error);
                        this.showMessage('Erro ao carregar dados: ' + error.message, 'warning');
                    }
                }
                
                async loadAppointments() {
                    try {
                        let query = supabase.from('appointments').select('*');
                        
                        if (this.currentUser.user_type === 'business') {
                            const { data: businessData } = await supabase
                                .from('businesses')
                                .select('id')
                                .eq('user_id', this.currentUser.id)
                                .single();
                            
                            if (businessData) {
                                query = query.eq('business_id', businessData.id);
                            }
                        } else {
                            query = query.eq('client_id', this.currentUser.id);
                        }
                        
                        const { data } = await query.order('appointment_date', { ascending: false });
                        this.appointments = data || [];
                        console.log(`üìÖ ${this.appointments.length} agendamentos carregados`);
                    } catch (error) {
                        console.error('‚ùå Erro ao carregar agendamentos:', error);
                    }
                }
                
                showMessage(message, type = 'info') {
                    const colors = {
                        success: 'bg-green-100 text-green-800 border-green-200',
                        error: 'bg-red-100 text-red-800 border-red-200',
                        info: 'bg-blue-100 text-blue-800 border-blue-200',
                        warning: 'bg-yellow-100 text-yellow-800 border-yellow-200'
                    };
                    
                    const messageDiv = document.createElement('div');
                    messageDiv.className = `fixed top-4 right-4 p-4 rounded-lg border ${colors[type]} z-50 fade-in max-w-md shadow-lg`;
                    messageDiv.innerHTML = `
                        <div class="flex items-start gap-2">
                            <span class="flex-1">${message}</span>
                            <button onclick="this.parentElement.parentElement.remove()" class="text-lg font-bold opacity-70 hover:opacity-100">√ó</button>
                        </div>
                    `;
                    document.body.appendChild(messageDiv);
                    
                    setTimeout(() => {
                        if (messageDiv.parentElement) {
                            messageDiv.remove();
                        }
                    }, 7000);
                }
                
                render() {
                    const root = document.getElementById('root');
                    
                    switch(this.currentView) {
                        case 'login':
                            root.innerHTML = this.renderLogin();
                            break;
                        case 'register':
                            root.innerHTML = this.renderRegister();
                            break;
                        case 'forgot-password':
                            root.innerHTML = this.renderForgotPassword();
                            break;
                        case 'email-sent':
                            root.innerHTML = this.renderEmailSent();
                            break;
                        case 'business-dashboard':
                            root.innerHTML = this.renderBusinessDashboard();
                            break;
                        case 'client-dashboard':
                            root.innerHTML = this.renderClientDashboard();
                            break;
                        default:
                            root.innerHTML = this.renderLogin();
                    }
                    
                    this.attachEvents();
                }
                
                renderLogin() {
                    return `
                        <div class="min-h-screen bg-gradient-to-br from-pink-100 to-purple-100 flex items-center justify-center p-4">
                            <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md fade-in">
                                <div class="text-center mb-8">
                                    <h1 class="text-3xl font-bold text-gray-800 mb-2">üíÑ Beauty App</h1>
                                    <p class="text-gray-600">Sistema de agendamento para sal√µes de beleza</p>
                                </div>

                                <div class="space-y-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                        <input
                                            id="email"
                                            type="email"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition duration-200"
                                            placeholder="seu@email.com"
                                        />
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                                        <input
                                            id="password"
                                            type="password"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition duration-200"
                                            placeholder="Sua senha"
                                        />
                                    </div>

                                    <button
                                        id="login-btn"
                                        class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition duration-300 transform hover:scale-105"
                                    >
                                        Entrar
                                    </button>
                                </div>

                                <div class="mt-6 text-center">
                                    <button
                                        id="forgot-password-btn"
                                        class="text-pink-600 hover:text-pink-700 font-medium text-sm transition duration-200"
                                    >
                                        Esqueceu sua senha?
                                    </button>
                                </div>

                                <div class="mt-6 text-center">
                                    <p class="text-gray-600 mb-4">N√£o tem uma conta?</p>
                                    <div class="space-y-3">
                                        <button
                                            id="register-client-btn"
                                            class="w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 transition duration-300 transform hover:scale-105"
                                        >
                                            üë§ Cadastrar como Cliente
                                        </button>
                                        <button
                                            id="register-business-btn"
                                            class="w-full bg-green-500 text-white py-2 rounded-lg hover:bg-green-600 transition duration-300 transform hover:scale-105"
                                        >
                                            üè¢ Cadastrar como Empresa
                                        </button>
                                    </div>
                                </div>

                                <div class="mt-6 text-center">
                                    <p class="text-xs text-gray-500">
                                        ‚úÖ Sistema conectado ao Supabase - v2.1
                                    </p>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                renderRegister() {
                    return `
                        <div class="min-h-screen bg-gradient-to-br from-pink-100 to-purple-100 flex items-center justify-center p-4">
                            <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md fade-in">
                                <div class="text-center mb-8">
                                    <h1 class="text-3xl font-bold text-gray-800 mb-2">
                                        ${this.userType === 'business' ? 'üè¢ Cadastro de Empresa' : 'üë§ Cadastro de Cliente'}
                                    </h1>
                                    <p class="text-gray-600">Preencha os dados abaixo</p>
                                </div>

                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            ${this.userType === 'business' ? 'Nome da Empresa' : 'Nome Completo'}
                                        </label>
                                        <input
                                            id="reg-name"
                                            type="text"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition duration-200"
                                            placeholder="${this.userType === 'business' ? 'Sal√£o Beleza Total' : 'Jo√£o Silva'}"
                                        />
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                        <input
                                            id="reg-email"
                                            type="email"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition duration-200"
                                            placeholder="seu@email.com"
                                        />
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Telefone</label>
                                        <input
                                            id="reg-phone"
                                            type="tel"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition duration-200"
                                            placeholder="(48) 99999-9999"
                                        />
                                    </div>

                                    ${this.userType === 'business' ? `
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Endere√ßo</label>
                                        <input
                                            id="reg-address"
                                            type="text"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition duration-200"
                                            placeholder="Rua das Flores, 123"
                                        />
                                    </div>
                                    ` : ''}

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                                        <input
                                            id="reg-password"
                                            type="password"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition duration-200"
                                            minlength="6"
                                            placeholder="M√≠nimo 6 caracteres"
                                        />
                                        <p class="text-xs text-gray-500 mt-1">M√≠nimo 6 caracteres</p>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Confirmar Senha</label>
                                        <input
                                            id="reg-confirm-password"
                                            type="password"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition duration-200"
                                            placeholder="Digite a senha novamente"
                                        />
                                    </div>

                                    <button
                                        id="register-btn"
                                        class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition duration-300 transform hover:scale-105"
                                    >
                                        Cadastrar
                                    </button>
                                </div>

                                <div class="mt-6 text-center">
                                    <button
                                        id="back-to-login"
                                        class="text-pink-600 hover:text-pink-700 font-medium transition duration-200"
                                    >
                                        Voltar ao Login
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                renderForgotPassword() {
                    return `
                        <div class="min-h-screen bg-gradient-to-br from-pink-100 to-purple-100 flex items-center justify-center p-4">
                            <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md fade-in">
                                <div class="text-center mb-8">
                                    <h1 class="text-3xl font-bold text-gray-800 mb-2">üîë Recuperar Senha</h1>
                                    <p class="text-gray-600">Digite seu email para receber as instru√ß√µes</p>
                                </div>

                                <div class="space-y-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                        <input
                                            id="forgot-email"
                                            type="email"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition duration-200"
                                            placeholder="seu@email.com"
                                        />
                                    </div>

                                    <button
                                        id="send-reset-btn"
                                        class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition duration-300 transform hover:scale-105"
                                    >
                                        Enviar Instru√ß√µes
                                    </button>
                                </div>

                                <div class="mt-6 text-center">
                                    <button
                                        id="back-to-login-forgot"
                                        class="text-pink-600 hover:text-pink-700 font-medium transition duration-200"
                                    >
                                        Voltar ao Login
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                renderEmailSent() {
                    return `
                        <div class="min-h-screen bg-gradient-to-br from-pink-100 to-purple-100 flex items-center justify-center p-4">
                            <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md fade-in text-center">
                                <div class="text-6xl mb-4">üìß</div>
                                <h1 class="text-3xl font-bold text-gray-800 mb-2">Email Enviado!</h1>
                                <p class="text-gray-600 mb-6">
                                    Verifique sua caixa de entrada${this.pendingVerificationEmail ? ` (${this.pendingVerificationEmail})` : ''} 
                                    e clique no link para verificar sua conta.
                                </p>
                                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
                                    <p class="text-sm text-yellow-800">
                                        üí° <strong>Dica:</strong> N√£o encontrou o email? Verifique a pasta de spam.
                                    </p>
                                </div>
                                <button
                                    id="back-to-login-email"
                                    class="bg-pink-500 text-white px-6 py-3 rounded-lg hover:bg-pink-600 transition duration-300 transform hover:scale-105"
                                >
                                    Voltar ao Login
                                </button>
                            </div>
                        </div>
                    `;
                }
                
                renderBusinessDashboard() {
                    return `
                        <div class="min-h-screen bg-gray-50">
                            <header class="bg-white shadow-sm border-b">
                                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                                    <div class="flex justify-between items-center py-4">
                                        <h1 class="text-2xl font-bold text-gray-900">üè¢ Dashboard - ${this.currentUser?.name || 'Empresa'}</h1>
                                        <button
                                            id="logout-btn"
                                            class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition duration-300"
                                        >
                                            Sair
                                        </button>
                                    </div>
                                </div>
                            </header>

                            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    <div class="bg-white rounded-lg shadow p-6">
                                        <h2 class="text-xl font-semibold text-gray-900 mb-4">üéâ Sistema Conectado!</h2>
                                        <p class="text-gray-600 mb-4">
                                            Parab√©ns! Seu Beauty App est√° funcionando com Supabase.
                                        </p>
                                        <div class="grid grid-cols-1 gap-4">
                                            <div class="bg-green-50 p-4 rounded-lg">
                                                <h3 class="font-semibold text-green-800">‚úÖ Banco de Dados</h3>
                                                <p class="text-sm text-green-600">Supabase conectado e funcionando</p>
                                            </div>
                                            <div class="bg-blue-50 p-4 rounded-lg">
                                                <h3 class="font-semibold text-blue-800">üìß Autentica√ß√£o</h3>
                                                <p class="text-sm text-blue-600">Sistema de login e verifica√ß√£o ativo</p>
                                            </div>
                                            <div class="bg-purple-50 p-4 rounded-lg">
                                                <h3 class="font-semibold text-purple-800">üîí Seguran√ßa</h3>
                                                <p class="text-sm text-purple-600">Pol√≠ticas RLS configuradas</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-white rounded-lg shadow p-6">
                                        <h2 class="text-xl font-semibold text-gray-900 mb-4">üìä Estat√≠sticas</h2>
                                        <div class="space-y-4">
                                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                                                <span class="text-gray-600">Estabelecimentos</span>
                                                <span class="font-semibold text-blue-600">${this.businesses.length}</span>
                                            </div>
                                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                                                <span class="text-gray-600">Servi√ßos</span>
                                                <span class="font-semibold text-green-600">${this.services.length}</span>
                                            </div>
                                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                                                <span class="text-gray-600">Agendamentos</span>
                                                <span class="font-semibold text-purple-600">${this.appointments.length}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                renderClientDashboard() {
                    return `
                        <div class="min-h-screen bg-gray-50">
                            <header class="bg-white shadow-sm border-b">
                                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                                    <div class="flex justify-between items-center py-4">
                                        <h1 class="text-2xl font-bold text-gray-900">üë§ Ol√°, ${this.currentUser?.name || 'Cliente'}!</h1>
                                        <button
                                            id="logout-btn"
                                            class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition duration-300"
                                        >
                                            Sair
                                        </button>
                                    </div>
                                </div>
                            </header>

                            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    <div class="bg-white rounded-lg shadow p-6">
                                        <h2 class="text-xl font-semibold text-gray-900 mb-4">üéâ Bem-vindo!</h2>
                                        <p class="text-gray-600 mb-4">
                                            Seu cadastro foi realizado com sucesso no Beauty App.
                                        </p>
                                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                                            <p class="text-green-800">
                                                ‚úÖ Conta verificada e ativa
                                            </p>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-white rounded-lg shadow p-6">
                                        <h2 class="text-xl font-semibold text-gray-900 mb-4">üìç Estabelecimentos Dispon√≠veis</h2>
                                        ${this.businesses.length > 0 ? `
                                            <div class="space-y-3">
                                                ${this.businesses.slice(0, 3).map(business => `
                                                    <div class="border border-gray-200 rounded-lg p-3">
                                                        <h3 class="font-medium text-gray-800">${business.name}</h3>
                                                        <p class="text-sm text-gray-600">${business.address}</p>
                                                    </div>
                                                `).join('')}
                                            </div>
                                        ` : `
                                            <div class="text-center py-8 text-gray-500">
                                                <p>Ainda n√£o h√° estabelecimentos cadastrados</p>
                                            </div>
                                        `}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                attachEvents() {
                    // Login
                    const loginBtn = document.getElementById('login-btn');
                    if (loginBtn) {
                        loginBtn.addEventListener('click', () => this.handleLogin());
                    }
                    
                    // Register navigation
                    const registerClientBtn = document.getElementById('register-client-btn');
                    if (registerClientBtn) {
                        registerClientBtn.addEventListener('click', () => {
                            this.userType = 'client';
                            this.currentView = 'register';
                            this.render();
                        });
                    }
                    
                    const registerBusinessBtn = document.getElementById('register-business-btn');
                    if (registerBusinessBtn) {
                        registerBusinessBtn.addEventListener('click', () => {
                            this.userType = 'business';
                            this.currentView = 'register';
                            this.render();
                        });
                    }
                    
                    // Register
                    const registerBtn = document.getElementById('register-btn');
                    if (registerBtn) {
                        registerBtn.addEventListener('click', () => this.handleRegister());
                    }
                    
                    // Back to login
                    const backToLogin = document.getElementById('back-to-login');
                    if (backToLogin) {
                        backToLogin.addEventListener('click', () => {
                            this.currentView = 'login';
                            this.render();
                        });
                    }
                    
                    const backToLoginForgot = document.getElementById('back-to-login-forgot');
                    if (backToLoginForgot) {
                        backToLoginForgot.addEventListener('click', () => {
                            this.currentView = 'login';
                            this.render();
                        });
                    }
                    
                    const backToLoginEmail = document.getElementById('back-to-login-email');
                    if (backToLoginEmail) {
                        backToLoginEmail.addEventListener('click', () => {
                            this.currentView = 'login';
                            this.render();
                        });
                    }
                    
                    // Forgot password
                    const forgotPasswordBtn = document.getElementById('forgot-password-btn');
                    if (forgotPasswordBtn) {
                        forgotPasswordBtn.addEventListener('click', () => {
                            this.currentView = 'forgot-password';
                            this.render();
                        });
                    }
                    
                    const sendResetBtn = document.getElementById('send-reset-btn');
                    if (sendResetBtn) {
                        sendResetBtn.addEventListener('click', () => this.handleForgotPassword());
                    }
                    
                    // Logout
                    const logoutBtn = document.getElementById('logout-btn');
                    if (logoutBtn) {
                        logoutBtn.addEventListener('click', () => this.handleLogout());
                    }
                    
                    // Enter key support
                    document.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter' && !this.loading) {
                            if (this.currentView === 'login') {
                                this.handleLogin();
                            } else if (this.currentView === 'register') {
                                this.handleRegister();
                            } else if (this.currentView === 'forgot-password') {
                                this.handleForgotPassword();
                            }
                        }
                    });
                }
                
                async handleLogin() {
                    const email = document.getElementById('email').value.trim();
                    const password = document.getElementById('password').value;
                    const loginBtn = document.getElementById('login-btn');
                    
                    if (!email || !password) {
                        this.showMessage('Por favor, preencha email e senha', 'error');
                        return;
                    }
                    
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(email)) {
                        this.showMessage('Por favor, digite um email v√°lido', 'error');
                        return;
                    }
                    
                    try {
                        loginBtn.textContent = 'Entrando...';
                        loginBtn.disabled = true;
                        
                        console.log('üîê Tentando login para:', email);
                        const { data, error } = await supabase.auth.signInWithPassword({
                            email: email,
                            password: password
                        });
                        
                        if (error) throw error;
                        
                        console.log('‚úÖ Login realizado:', data);
                        this.showMessage('Login realizado com sucesso!', 'success');
                        
                    } catch (error) {
                        console.error('‚ùå Erro no login:', error);
                        
                        let errorMessage = 'Erro no login: ';
                        if (error.message.includes('Invalid login credentials')) {
                            errorMessage = 'Email ou senha incorretos';
                        } else if (error.message.includes('Email not confirmed')) {
                            errorMessage = 'Por favor, confirme seu email antes de fazer login';
                        } else {
                            errorMessage = 'Erro no login: ' + error.message;
                        }
                        
                        this.showMessage(errorMessage, 'error');
                    } finally {
                        loginBtn.textContent = 'Entrar';
                        loginBtn.disabled = false;
                    }
                }
                
                async handleRegister() {
                    const name = document.getElementById('reg-name').value.trim();
                    const email = document.getElementById('reg-email').value.trim();
                    const phone = document.getElementById('reg-phone').value.trim();
                    const password = document.getElementById('reg-password').value;
                    const confirmPassword = document.getElementById('reg-confirm-password').value;
                    const address = document.getElementById('reg-address')?.value.trim() || '';
                    const registerBtn = document.getElementById('register-btn');
                    
                    if (!name || !email || !phone || !password || !confirmPassword) {
                        this.showMessage('Por favor, preencha todos os campos obrigat√≥rios', 'error');
                        return;
                    }
                    
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(email)) {
                        this.showMessage('Por favor, digite um email v√°lido', 'error');
                        return;
                    }
                    
                    if (password.length < 6) {
                        this.showMessage('A senha deve ter pelo menos 6 caracteres', 'error');
                        return;
                    }
                    
                    if (password !== confirmPassword) {
                        this.showMessage('As senhas n√£o coincidem!', 'error');
                        return;
                    }
                    
                    if (this.userType === 'business' && !address) {
                        this.showMessage('O endere√ßo √© obrigat√≥rio para empresas', 'error');
                        return;
                    }
                    
                    try {
                        registerBtn.textContent = 'Cadastrando...';
                        registerBtn.disabled = true;
                        
                        console.log('üìù Registrando usu√°rio:', this.userType);
                        const { data, error } = await supabase.auth.signUp({
                            email: email,
                            password: password,
                            options: {
                                data: {
                                    name: name,
                                    user_type: this.userType,
                                    phone: phone,
                                    address: address
                                }
                            }
                        });
                        
                        if (error) throw error;
                        
                        console.log('‚úÖ Usu√°rio registrado:', data);
                        this.pendingVerificationEmail = email;
                        this.currentView = 'email-sent';
                        this.render();
                        this.showMessage('Cadastro realizado! Verifique seu email.', 'success');
                        
                    } catch (error) {
                        console.error('‚ùå Erro no cadastro:', error);
                        
                        let errorMessage = 'Erro no cadastro: ';
                        if (error.message.includes('already registered')) {
                            errorMessage = 'Este email j√° est√° cadastrado';
                        } else {
                            errorMessage = 'Erro no cadastro: ' + error.message;
                        }
                        
                        this.showMessage(errorMessage, 'error');
                    } finally {
                        registerBtn.textContent = 'Cadastrar';
                        registerBtn.disabled = false;
                    }
                }
                
                async handleForgotPassword() {
                    const email = document.getElementById('forgot-email').value.trim();
                    const sendResetBtn = document.getElementById('send-reset-btn');
                    
                    if (!email) {
                        this.showMessage('Por favor, digite seu email', 'error');
                        return;
                    }
                    
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(email)) {
                        this.showMessage('Por favor, digite um email v√°lido', 'error');
                        return;
                    }
                    
                    try {
                        sendResetBtn.textContent = 'Enviando...';
                        sendResetBtn.disabled = true;
                        
                        console.log('üîÑ Enviando email de recupera√ß√£o para:', email);
                        const { error } = await supabase.auth.resetPasswordForEmail(email, {
                            redirectTo: window.location.origin + window.location.pathname
                        });
                        
                        if (error) throw error;
                        
                        this.pendingVerificationEmail = email;
                        this.currentView = 'email-sent';
                        this.render();
                        this.showMessage('Email de recupera√ß√£o enviado!', 'success');
                    } catch (error) {
                        console.error('‚ùå Erro ao enviar email:', error);
                        this.showMessage('Erro ao enviar email: ' + error.message, 'error');
                    } finally {
                        sendResetBtn.textContent = 'Enviar Instru√ß√µes';
                        sendResetBtn.disabled = false;
                    }
                }
                
                async handleLogout() {
                    try {
                        const { error } = await supabase.auth.signOut();
                        if (error) throw error;
                        
                        this.currentUser = null;
                        this.currentView = 'login';
                        this.render();
                        this.showMessage('Logout realizado com sucesso!', 'success');
                    } catch (error) {
                        console.error('‚ùå Erro no logout:', error);
                        this.showMessage('Erro no logout: ' + error.message, 'error');
                    }
                }
            }
            
            // Inicializar aplica√ß√£o
            console.log('üöÄ Iniciando Beauty App...');
            window.app = new BeautyApp();
        }
    </script>
</body>
</html>
